<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Jul 25, 2012 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20120725" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://www.waarp.it" id="bannerLeft">
                                                <img src="images/waarp.jpg" alt="Waarp Project" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                
                <div class="xleft">
        <span id="publishDate">Last Published: 2012-07-25</span>
                  &nbsp;| <span id="projectVersion">Version: 2.4.4</span>
                      </div>
            <div class="xright">                    <a href="http://www.waarp.it/" class="externalLink" title="Waarp">Waarp</a>
              
                
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                
                                <h5>Waarp OpenR66</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Overview of OpenR66">Overview of OpenR66</a>
            </li>
                  <li class="none">
                          <a href="configuration.html" title="Configuration of OpenR66 Server and Clients">Configuration of OpenR66 Server and Clients</a>
            </li>
                  <li class="none">
                          <a href="sslconfig.html" title="Configuration of OpenR66 SSL keys">Configuration of OpenR66 SSL keys</a>
            </li>
                  <li class="none">
                          <a href="commands.html" title="Commands for OpenR66 Server and Clients">Commands for OpenR66 Server and Clients</a>
            </li>
                  <li class="none">
                          <a href="protocol.html" title="Protocol for OpenR66 File Transfer">Protocol for OpenR66 File Transfer</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
                      <li class="none">
            <strong>CPD Report</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD Report">PMD Report</a>
            </li>
                      <li class="none">
                          <a href="changes-report.html" title="Changes Report">Changes Report</a>
            </li>
                      <li class="none">
                          <a href="dev-activity.html" title="Developer Activity">Developer Activity</a>
            </li>
                      <li class="none">
                          <a href="file-activity.html" title="File Activity">File Activity</a>
            </li>
                      <li class="none">
                          <a href="changelog.html" title="Change Log">Change Log</a>
            </li>
                      <li class="none">
                          <a href="taglist.html" title="Tag List">Tag List</a>
            </li>
                      <li class="none">
                          <a href="api/index.html" title="JavaDocs">JavaDocs</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>CPD Results<a name="CPD_Results"></a></h2><p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 4.3.</p></div><div class="section"><h2>Duplications<a name="Duplications"></a></h2><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#64">64</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#57">57</a></td></tr><tr class="b"><td colspan='2'><div><pre>		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Multiple Mode
		String action = createTableH2 + DbMultipleMonitor.table + &quot;(&quot;;
		DbMultipleMonitor.Columns[] mcolumns = DbMultipleMonitor.Columns
				.values();
		for (int i = 0; i &lt; mcolumns.length - 1; i++) {
			action += mcolumns[i].name() +
					DBType.getType(DbMultipleMonitor.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += mcolumns[mcolumns.length - 1].name() +
				DBType.getType(DbMultipleMonitor.dbTypes[mcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
		DbMultipleMonitor multipleMonitor = new DbMultipleMonitor(session,
				Configuration.configuration.HOST_ID, 0, 0, 0);
		try {
			if (!multipleMonitor.exist())
				multipleMonitor.insert();
		} catch (WaarpDatabaseException e1) {
			e1.printStackTrace();
		}

		// Configuration
		action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
		DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// hosts
		action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
		DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
		for (int i = 0; i &lt; hcolumns.length - 1; i++) {
			action += hcolumns[i].name() +
					DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
		}
		action += hcolumns[hcolumns.length - 1].name() +
				DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// rules
		action = createTableH2 + DbRule.table + &quot;(&quot;;
		DbRule.Columns[] rcolumns = DbRule.Columns.values();
		for (int i = 0; i &lt; rcolumns.length - 1; i++) {
			action += rcolumns[i].name() +
					DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
		}
		action += rcolumns[rcolumns.length - 1].name() +
				DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// runner
		action = createTableH2 + DbTaskRunner.table + &quot;(&quot;;
		DbTaskRunner.Columns[] acolumns = DbTaskRunner.Columns.values();
		for (int i = 0; i &lt; acolumns.length; i++) {
			action += acolumns[i].name() +
					DBType.getType(DbTaskRunner.dbTypes[i]) + notNull + &quot;, &quot;;
		}
		// Several columns for primary key
		action += &quot; CONSTRAINT runner_pk &quot; + primaryKey + &quot;(&quot;;
		for (int i = DbTaskRunner.NBPRKEY; i &gt; 1; i--) {
			action += acolumns[acolumns.length - i].name() + &quot;,&quot;;
		}
		action += acolumns[acolumns.length - 1].name() + &quot;))&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
		// Index Runner
		action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
		DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// cptrunner
		/*
		 * # Table to handle any number of sequences: CREATE TABLE Sequences ( name VARCHAR(22) NOT
		 * NULL, seq INT UNSIGNED NOT NULL, # (or BIGINT) PRIMARY KEY name ); # Create a Sequence:
		 * INSERT INTO Sequences (name, seq) VALUES (?, 0); # Drop a Sequence: DELETE FROM Sequences
		 * WHERE name = ?; # Get a sequence number: UPDATE Sequences SET seq = LAST_INSERT_ID(seq +
		 * 1) WHERE name = ?; $seq = $db-&gt;LastInsertId();
		 */
		action = &quot;CREATE TABLE Sequences (name VARCHAR(22) NOT NULL PRIMARY KEY,&quot; +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#57">57</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#60">60</a></td></tr><tr class="b"><td colspan='2'><div><pre>	@Override
	public void createTables(DbSession session) throws WaarpDatabaseNoConnectionException {
		// Create tables: configuration, hosts, rules, runner, cptrunner
		String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;
		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Multiple Mode
		String action = createTableH2 + DbMultipleMonitor.table + &quot;(&quot;;
		DbMultipleMonitor.Columns[] mcolumns = DbMultipleMonitor.Columns
				.values();
		for (int i = 0; i &lt; mcolumns.length - 1; i++) {
			action += mcolumns[i].name() +
					DBType.getType(DbMultipleMonitor.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += mcolumns[mcolumns.length - 1].name() +
				DBType.getType(DbMultipleMonitor.dbTypes[mcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
		DbMultipleMonitor multipleMonitor = new DbMultipleMonitor(session,
				Configuration.configuration.HOST_ID, 0, 0, 0);
		try {
			if (!multipleMonitor.exist())
				multipleMonitor.insert();
		} catch (WaarpDatabaseException e1) {
			e1.printStackTrace();
		}

		// Configuration
		action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
		DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// hosts
		action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
		DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
		for (int i = 0; i &lt; hcolumns.length - 1; i++) {
			action += hcolumns[i].name() +
					DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
		}
		action += hcolumns[hcolumns.length - 1].name() +
				DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// rules
		action = createTableH2 + DbRule.table + &quot;(&quot;;
		DbRule.Columns[] rcolumns = DbRule.Columns.values();
		for (int i = 0; i &lt; rcolumns.length - 1; i++) {
			action += rcolumns[i].name() +
					DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
		}
		action += rcolumns[rcolumns.length - 1].name() +
				DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// runner
		action = createTableH2 + DbTaskRunner.table + &quot;(&quot;;
		DbTaskRunner.Columns[] acolumns = DbTaskRunner.Columns.values();
		for (int i = 0; i &lt; acolumns.length; i++) {
			action += acolumns[i].name() +
					DBType.getType(DbTaskRunner.dbTypes[i]) + notNull + &quot;, &quot;;
		}
		// Several columns for primary key
		action += &quot; CONSTRAINT runner_pk &quot; + primaryKey + &quot;(&quot;;
		for (int i = DbTaskRunner.NBPRKEY; i &gt; 1; i--) {
			action += acolumns[acolumns.length - i].name() + &quot;,&quot;;
		}
		action += acolumns[acolumns.length - 1].name() + &quot;))&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
		// Index Runner
		action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#61">61</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#57">57</a></td></tr><tr class="b"><td colspan='2'><div><pre>		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Multiple Mode
		String action = createTableH2 + DbMultipleMonitor.table + &quot;(&quot;;
		DbMultipleMonitor.Columns[] mcolumns = DbMultipleMonitor.Columns
				.values();
		for (int i = 0; i &lt; mcolumns.length - 1; i++) {
			action += mcolumns[i].name() +
					DBType.getType(DbMultipleMonitor.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += mcolumns[mcolumns.length - 1].name() +
				DBType.getType(DbMultipleMonitor.dbTypes[mcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
		DbMultipleMonitor multipleMonitor = new DbMultipleMonitor(session,
				Configuration.configuration.HOST_ID, 0, 0, 0);
		try {
			if (!multipleMonitor.exist())
				multipleMonitor.insert();
		} catch (WaarpDatabaseException e1) {
			e1.printStackTrace();
		}

		// Configuration
		action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
		DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// hosts
		action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
		DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
		for (int i = 0; i &lt; hcolumns.length - 1; i++) {
			action += hcolumns[i].name() +
					DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
		}
		action += hcolumns[hcolumns.length - 1].name() +
				DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// rules
		action = createTableH2 + DbRule.table + &quot;(&quot;;
		DbRule.Columns[] rcolumns = DbRule.Columns.values();
		for (int i = 0; i &lt; rcolumns.length - 1; i++) {
			action += rcolumns[i].name() +
					DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
		}
		action += rcolumns[rcolumns.length - 1].name() +
				DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +
				primaryKey + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}

		// runner
		action = createTableH2 + DbTaskRunner.table + &quot;(&quot;;
		DbTaskRunner.Columns[] acolumns = DbTaskRunner.Columns.values();
		for (int i = 0; i &lt; acolumns.length; i++) {
			action += acolumns[i].name() +
					DBType.getType(DbTaskRunner.dbTypes[i]) + notNull + &quot;, &quot;;
		}
		// Several columns for primary key
		action += &quot; CONSTRAINT runner_pk &quot; + primaryKey + &quot;(&quot;;
		for (int i = DbTaskRunner.NBPRKEY; i &gt; 1; i--) {
			action += acolumns[acolumns.length - i].name() + &quot;,&quot;;
		}
		action += acolumns[acolumns.length - 1].name() + &quot;))&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
		// Index Runner
		action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#336">336</a></td></tr><tr class="a"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#451">451</a></td></tr><tr class="b"><td colspan='2'><div><pre>			body0 = REQUEST.Listing.readBodyHeader();
			String parm = parms.get(0);
			if (&quot;Filter&quot;.equalsIgnoreCase(parm)) {
				String startid = getTrimValue(&quot;startid&quot;);
				String stopid = getTrimValue(&quot;stopid&quot;);
				if (startid != null &amp;&amp; stopid == null) {
					try {
                 		stopid = Long.toString(Long.parseLong(startid)+(LIMITROW/2));
                    } catch (NumberFormatException e) {
                     	stopid = null;
                     	startid = null;
                    }
				}
				if (stopid != null &amp;&amp; startid == null) {
					try {
						startid = Long.toString(Long.parseLong(stopid) - (LIMITROW / 2));
                    } catch (NumberFormatException e) {
                     	stopid = null;
                     	startid = null;
                    }
				}
				String start = getValue(&quot;start&quot;);
				String stop = getValue(&quot;stop&quot;);
				String rule = getTrimValue(&quot;rule&quot;);
				String req = getTrimValue(&quot;req&quot;);
				boolean pending, transfer, error, done, all;
				pending = params.containsKey(&quot;pending&quot;);
				transfer = params.containsKey(&quot;transfer&quot;);
				error = params.containsKey(&quot;error&quot;);
				done = params.containsKey(&quot;done&quot;);
				all = params.containsKey(&quot;all&quot;);
				if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
					all = true;
				} else if (!(pending || transfer || error || done)) {
					all = true;
				}
				Timestamp tstart = WaarpStringUtils.fixDate(start);
				if (tstart != null) {
					start = tstart.toString();
				}
				Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
				if (tstop != null) {
					stop = tstop.toString();
				}
				head = resetOptionTransfer(head, startid == null ? &quot;&quot; : startid,
						stopid == null ? &quot;&quot; : stopid, start, stop,
						rule == null ? &quot;&quot; : rule, req == null ? &quot;&quot; : req,
						pending, transfer, error, done, all);
				body = REQUEST.Listing.readBody();</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\context\task\ExecMoveTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecMoveTask.html#96">96</a></td></tr><tr class="a"><td>org\waarp\openr66\context\task\ExecOutputTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecOutputTask.html#100">100</a></td></tr><tr class="b"><td colspan='2'><div><pre>				move(result.status, result.result, finalname);
				localExecClient.disconnect();
				return;
			} // else continue
		}
		String[] args = finalname.split(&quot; &quot;);
		File exec = new File(args[0]);
		if (exec.isAbsolute()) {
			if (!exec.canExecute()) {
				logger.error(&quot;Exec command is not executable: &quot; + finalname);
				R66Result result = new R66Result(session, false,
						ErrorCode.CommandNotFound, session.getRunner());
				futureCompletion.setResult(result);
				futureCompletion.cancel();
				return;
			}
		}
		CommandLine commandLine = new CommandLine(args[0]);
		for (int i = 1; i &lt; args.length; i++) {
			commandLine.addArgument(args[i]);
		}
		DefaultExecutor defaultExecutor = new DefaultExecutor();
		PipedInputStream inputStream = new PipedInputStream();
		PipedOutputStream outputStream = null;
		try {
			outputStream = new PipedOutputStream(inputStream);
		} catch (IOException e1) {
			try {
				inputStream.close();
			} catch (IOException e) {
			}
			logger.error(&quot;Exception: &quot; + e1.getMessage() +
					&quot; Exec in error with &quot; + commandLine.toString(), e1);
			futureCompletion.setFailure(e1);
			return;
		}
		PumpStreamHandler pumpStreamHandler = new PumpStreamHandler(
				outputStream, null);
		defaultExecutor.setStreamHandler(pumpStreamHandler);
		int[] correctValues = {
				0, 1 };
		defaultExecutor.setExitValues(correctValues);
		ExecuteWatchdog watchdog = null;

		if (delay &gt; 0) {
			watchdog = new ExecuteWatchdog(delay);
			defaultExecutor.setWatchdog(watchdog);
		}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\database\data\DbRule.java</td><td><a href="./xref/org/waarp/openr66/database/data/DbRule.html#461">461</a></td></tr><tr class="a"><td>org\waarp\openr66\database\data\DbRule.java</td><td><a href="./xref/org/waarp/openr66/database/data/DbRule.html#489">489</a></td></tr><tr class="b"><td colspan='2'><div><pre>	protected void setFromArray() throws WaarpDatabaseSqlException {
		ids = (String) allFields[Columns.HOSTIDS.ordinal()].getValue();
		mode = (Integer) allFields[Columns.MODETRANS.ordinal()].getValue();
		recvPath = (String) allFields[Columns.RECVPATH.ordinal()].getValue();
		sendPath = (String) allFields[Columns.SENDPATH.ordinal()].getValue();
		archivePath = (String) allFields[Columns.ARCHIVEPATH.ordinal()]
				.getValue();
		workPath = (String) allFields[Columns.WORKPATH.ordinal()].getValue();
		rpreTasks = (String) allFields[Columns.RPRETASKS.ordinal()].getValue();
		rpostTasks = (String) allFields[Columns.RPOSTTASKS.ordinal()].getValue();
		rerrorTasks = (String) allFields[Columns.RERRORTASKS.ordinal()]
				.getValue();
		spreTasks = (String) allFields[Columns.SPRETASKS.ordinal()].getValue();
		spostTasks = (String) allFields[Columns.SPOSTTASKS.ordinal()].getValue();
		serrorTasks = (String) allFields[Columns.SERRORTASKS.ordinal()]
				.getValue();
		updatedInfo = (Integer) allFields[Columns.UPDATEDINFO.ordinal()]
				.getValue();
		idRule = (String) allFields[Columns.IDRULE.ordinal()].getValue();</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#216">216</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#212">212</a></td></tr><tr class="b"><td colspan='2'><div><pre>				&quot; START WITH &quot; + (DbConstant.ILLEGALVALUE + 1);
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
	}

	/*
	 * (non-Javadoc)
	 * @see org.waarp.openr66.databaseold.model.DbModel#resetSequence()
	 */
	@Override
	public void resetSequence(DbSession session, long newvalue)
			throws WaarpDatabaseNoConnectionException {
		String action = &quot;ALTER SEQUENCE &quot; + DbTaskRunner.fieldseq +
				&quot; RESTART WITH &quot; + newvalue;
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
		System.out.println(action);
	}

	/*
	 * (non-Javadoc)
	 * @see org.waarp.openr66.databaseold.model.DbModel#nextSequence()
	 */
	@Override
	public long nextSequence(DbSession dbSession)
			throws WaarpDatabaseNoConnectionException,
			WaarpDatabaseSqlException, WaarpDatabaseNoDataException {
		long result = DbConstant.ILLEGALVALUE;
		String action = &quot;SELECT NEXTVAL('&quot; + DbTaskRunner.fieldseq + &quot;')&quot;;
		DbPreparedStatement preparedStatement = new DbPreparedStatement(
				dbSession);
		try {
			preparedStatement.createPrepareStatement(action);
			// Limit the search
			preparedStatement.executeQuery();
			if (preparedStatement.getNext()) {
				try {
					result = preparedStatement.getResultSet().getLong(1);
				} catch (SQLException e) {
					throw new WaarpDatabaseSqlException(e);
				}
				return result;
			} else {
				throw new WaarpDatabaseNoDataException(
						&quot;No sequence found. Must be initialized first&quot;);
			}
		} finally {
			preparedStatement.realClose();
		}
	}
}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1569">1569</a></td></tr><tr class="a"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1652">1652</a></td></tr><tr class="b"><td colspan='2'><div><pre>	public static boolean setConfigurationServerShutdownFromXml(Configuration config,
			String filename) {
		Document document = null;
		// Open config file
		try {
			document = new SAXReader().read(filename);
		} catch (DocumentException e) {
			logger.error(&quot;Unable to read the XML Config file: &quot; + filename, e);
			return false;
		}
		if (document == null) {
			logger.error(&quot;Unable to read the XML Config file: &quot; + filename);
			return false;
		}
		configuration = XmlUtil.read(document, configServer);
		hashConfig = new XmlHash(configuration);
		// Now read the configuration
		if (!loadIdentity(config)) {
			logger.error(&quot;Cannot load Identity&quot;);
			return false;
		}
		if (!loadDatabase(config)) {
			logger.error(&quot;Cannot load Database configuration&quot;);
			return false;
		}
		if (!loadServerParam(config)) {
			logger.error(&quot;Cannot load Server Parameters&quot;);
			return false;
		}
		if (!loadDirectory(config)) {
			logger.error(&quot;Cannot load Directory configuration&quot;);
			return false;
		}
		if (!loadLimit(config, false)) {
			logger.error(&quot;Cannot load Limit configuration&quot;);
			return false;
		}
		if (config.useSSL) {
			if (!loadSsl(config)) {
				logger.error(&quot;Cannot load SSL configuration&quot;);
				return false;
			}
		}
		if (!loadNetworkServer(config)) {
			logger.error(&quot;Cannot load Network configuration&quot;);
			return false;
		}
		if (!DbConstant.admin.isConnected) {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\server\ChangeBandwidthLimits.java</td><td><a href="./xref/org/waarp/openr66/server/ChangeBandwidthLimits.html#82">82</a></td></tr><tr class="a"><td>org\waarp\openr66\server\ConfigExport.java</td><td><a href="./xref/org/waarp/openr66/server/ConfigExport.html#77">77</a></td></tr><tr class="b"><td colspan='2'><div><pre>				writeSessionLimit + &quot; &quot; + readSessionLimit, LocalPacketFactory.BANDWIDTHPACKET);
		DbHostAuth host = Configuration.configuration.HOST_SSLAUTH;
		SocketAddress socketAddress = host.getSocketAddress();
		boolean isSSL = host.isSsl();
		LocalChannelReference localChannelReference = networkTransaction
				.createConnectionWithRetry(socketAddress, isSSL, future);
		socketAddress = null;
		if (localChannelReference == null) {
			host = null;
			logger.error(&quot;Cannot Connect&quot;);
			future.setResult(new R66Result(
					new OpenR66ProtocolNoConnectionException(&quot;Cannot connect to server&quot;),
					null, true, ErrorCode.Internal, null));
			future.setFailure(future.getResult().exception);
			return;
		}
		localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);
		try {
			ChannelUtils.writeAbstractLocalPacket(localChannelReference, valid, false);
		} catch (OpenR66ProtocolPacketException e) {
			logger.error(&quot;Bad Protocol&quot;, e);
			Channels.close(localChannelReference.getLocalChannel());
			localChannelReference = null;
			host = null;
			valid = null;
			future.setResult(new R66Result(e, null, true,
					ErrorCode.TransferError, null));
			future.setFailure(e);
			return;
		}
		host = null;
		future.awaitUninterruptibly();
		logger.info(&quot;Request done with &quot; + (future.isSuccess() ? &quot;success&quot; : &quot;error&quot;));
		Channels.close(localChannelReference.getLocalChannel());
		localChannelReference = null;
	}

	protected static long swriteGlobalLimit = -1;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\database\data\DbTaskRunner.java</td><td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#3357">3357</a></td></tr><tr class="a"><td>org\waarp\openr66\database\data\DbTaskRunner.java</td><td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#3468">3468</a></td></tr><tr class="b"><td colspan='2'><div><pre>		} catch (FileNotFoundException e) {
			logger.error(&quot;Cannot write XML file&quot;, e);
			throw new OpenR66ProtocolBusinessException(&quot;File not found&quot;);
		} catch (UnsupportedEncodingException e) {
			logger.error(&quot;Cannot write XML file&quot;, e);
			throw new OpenR66ProtocolBusinessException(&quot;Unsupported Encoding&quot;);
		} finally {
			if (xmlWriter != null) {
				try {
					xmlWriter.endDocument();
					xmlWriter.flush();
					xmlWriter.close();
				} catch (SAXException e) {
					try {
						outputStream.close();
					} catch (IOException e2) {
					}
					File file = new File(filename);
					file.delete();
					logger.error(&quot;Cannot write XML file&quot;, e);
					throw new OpenR66ProtocolBusinessException(&quot;Unsupported Encoding&quot;);
				} catch (IOException e) {
					try {
						outputStream.close();
					} catch (IOException e2) {
					}
					File file = new File(filename);
					file.delete();
					logger.error(&quot;Cannot write XML file&quot;, e);
					throw new OpenR66ProtocolBusinessException(&quot;Unsupported Encoding&quot;);
				}
			} else if (outputStream != null) {
				try {
					outputStream.close();
				} catch (IOException e) {
				}
				File file = new File(filename);
				file.delete();
			}
		}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#76">76</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#79">79</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#79">79</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#72">72</a></td></tr><tr class="b"><td colspan='2'><div><pre>		System.out.println(action);
		DbRequest request = new DbRequest(session);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			e.printStackTrace();
			return;
		} finally {
			request.close();
		}
		DbMultipleMonitor multipleMonitor = new DbMultipleMonitor(session,
				Configuration.configuration.HOST_ID, 0, 0, 0);
		try {
			if (!multipleMonitor.exist())
				multipleMonitor.insert();
		} catch (WaarpDatabaseException e1) {
			e1.printStackTrace();
		}

		// Configuration
		action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
		DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
				.values();
		for (int i = 0; i &lt; ccolumns.length - 1; i++) {
			action += ccolumns[i].name() +
					DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += ccolumns[ccolumns.length - 1].name() +
				DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\context\task\ExecMoveTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecMoveTask.html#205">205</a></td></tr><tr class="a"><td>org\waarp\openr66\context\task\ExecOutputTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecOutputTask.html#199">199</a></td></tr><tr class="b"><td colspan='2'><div><pre>				futureCompletion.setFailure(e);
				return;
			}
		} catch (IOException e) {
			try {
				outputStream.close();
			} catch (IOException e1) {
			}
			thread.interrupt();
			try {
				inputStream.close();
			} catch (IOException e1) {
			}
			pumpStreamHandler.stop();
			logger.error(&quot;IOException: &quot; + e.getMessage() +
					&quot; . Exec in error with &quot; + commandLine.toString());
			futureCompletion.setFailure(e);
			return;
		}
		try {
			outputStream.flush();
		} catch (IOException e) {
		}
		try {
			outputStream.close();
		} catch (IOException e) {
		}
		pumpStreamHandler.stop();
		try {
			if (delay &gt; 0) {
				thread.join(delay);
			} else {
				thread.join();
			}
		} catch (InterruptedException e) {
			Thread.currentThread().interrupt();
		}
		try {
			inputStream.close();
		} catch (IOException e1) {
		}
		String newname = null;
		if (defaultExecutor.isFailure(status) &amp;&amp; watchdog != null &amp;&amp;
				watchdog.killedProcess()) {
			// kill by the watchdoc (time out)
			status = -1;
			newname = &quot;TimeOut&quot;;
		} else {
			newname = lastLineReader.lastLine;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#384">384</a></td></tr><tr class="a"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#499">499</a></td></tr><tr class="b"><td colspan='2'><div><pre>				body = REQUEST.Listing.readBody();
				DbPreparedStatement preparedStatement = null;
				try {
					preparedStatement =
							DbTaskRunner.getFilterPrepareStatement(dbSession, LIMITROW, false,
									startid, stopid, tstart, tstop, rule, req,
									pending, transfer, error, done, all);
					preparedStatement.executeQuery();
					StringBuilder builder = new StringBuilder();
					int i = 0;
					while (preparedStatement.getNext()) {
						try {
							i++;
							DbTaskRunner taskRunner = DbTaskRunner
									.getFromStatement(preparedStatement);
							LocalChannelReference lcr =
									Configuration.configuration.getLocalTransaction().
											getFromRequest(taskRunner.getKey());
							builder.append(taskRunner.toSpecializedHtml(authentHttp, body,
									lcr != null ? &quot;Active&quot; : &quot;NotActive&quot;));
							if (i &gt; LIMITROW) {
								break;
							}
						} catch (WaarpDatabaseException e) {
							// try to continue if possible
							logger.warn(&quot;An error occurs while accessing a Runner: {}&quot;,
									e.getMessage());
							continue;
						}
					}
					preparedStatement.realClose();
					body = builder.toString();
				} catch (WaarpDatabaseException e) {
					if (preparedStatement != null) {
						preparedStatement.realClose();
					}
					logger.warn(&quot;OpenR66 Web Error {}&quot;, e.getMessage());
				}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\server\ConfigExport.java</td><td><a href="./xref/org/waarp/openr66/server/ConfigExport.html#82">82</a></td></tr><tr class="a"><td>org\waarp\openr66\server\LogExport.java</td><td><a href="./xref/org/waarp/openr66/server/LogExport.html#106">106</a></td></tr><tr class="b"><td colspan='2'><div><pre>		LocalChannelReference localChannelReference = networkTransaction
				.createConnectionWithRetry(socketAddress, isSSL, future);
		socketAddress = null;
		if (localChannelReference == null) {
			host = null;
			logger.error(&quot;Cannot Connect&quot;);
			future.setResult(new R66Result(
					new OpenR66ProtocolNoConnectionException(&quot;Cannot connect to server&quot;),
					null, true, ErrorCode.Internal, null));
			future.setFailure(future.getResult().exception);
			return;
		}
		localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);
		try {
			ChannelUtils.writeAbstractLocalPacket(localChannelReference, valid, false);
		} catch (OpenR66ProtocolPacketException e) {
			logger.error(&quot;Bad Protocol&quot;, e);
			Channels.close(localChannelReference.getLocalChannel());
			localChannelReference = null;
			host = null;
			valid = null;
			future.setResult(new R66Result(e, null, true,
					ErrorCode.TransferError, null));
			future.setFailure(e);
			return;
		}
		host = null;
		future.awaitUninterruptibly();
		logger.info(&quot;Request done with &quot; + (future.isSuccess() ? &quot;success&quot; : &quot;error&quot;));
		Channels.close(localChannelReference.getLocalChannel());
		localChannelReference = null;
	}

	protected static boolean shost = false;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\server\ChangeBandwidthLimits.java</td><td><a href="./xref/org/waarp/openr66/server/ChangeBandwidthLimits.html#86">86</a></td></tr><tr class="a"><td>org\waarp\openr66\server\LogExport.java</td><td><a href="./xref/org/waarp/openr66/server/LogExport.html#106">106</a></td></tr><tr class="b"><td colspan='2'><div><pre>		LocalChannelReference localChannelReference = networkTransaction
				.createConnectionWithRetry(socketAddress, isSSL, future);
		socketAddress = null;
		if (localChannelReference == null) {
			host = null;
			logger.error(&quot;Cannot Connect&quot;);
			future.setResult(new R66Result(
					new OpenR66ProtocolNoConnectionException(&quot;Cannot connect to server&quot;),
					null, true, ErrorCode.Internal, null));
			future.setFailure(future.getResult().exception);
			return;
		}
		localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);
		try {
			ChannelUtils.writeAbstractLocalPacket(localChannelReference, valid, false);
		} catch (OpenR66ProtocolPacketException e) {
			logger.error(&quot;Bad Protocol&quot;, e);
			Channels.close(localChannelReference.getLocalChannel());
			localChannelReference = null;
			host = null;
			valid = null;
			future.setResult(new R66Result(e, null, true,
					ErrorCode.TransferError, null));
			future.setFailure(e);
			return;
		}
		host = null;
		future.awaitUninterruptibly();
		logger.info(&quot;Request done with &quot; + (future.isSuccess() ? &quot;success&quot; : &quot;error&quot;));
		Channels.close(localChannelReference.getLocalChannel());
		localChannelReference = null;
	}

	protected static long swriteGlobalLimit = -1;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\server\ChangeBandwidthLimits.java</td><td><a href="./xref/org/waarp/openr66/server/ChangeBandwidthLimits.html#82">82</a></td></tr><tr class="a"><td>org\waarp\openr66\server\ConfigExport.java</td><td><a href="./xref/org/waarp/openr66/server/ConfigExport.html#77">77</a></td></tr><tr class="b"><td>org\waarp\openr66\server\ConfigImport.java</td><td><a href="./xref/org/waarp/openr66/server/ConfigImport.html#83">83</a></td></tr><tr class="a"><td colspan='2'><div><pre>				writeSessionLimit + &quot; &quot; + readSessionLimit, LocalPacketFactory.BANDWIDTHPACKET);
		DbHostAuth host = Configuration.configuration.HOST_SSLAUTH;
		SocketAddress socketAddress = host.getSocketAddress();
		boolean isSSL = host.isSsl();
		LocalChannelReference localChannelReference = networkTransaction
				.createConnectionWithRetry(socketAddress, isSSL, future);
		socketAddress = null;
		if (localChannelReference == null) {
			host = null;
			logger.error(&quot;Cannot Connect&quot;);
			future.setResult(new R66Result(
					new OpenR66ProtocolNoConnectionException(&quot;Cannot connect to server&quot;),
					null, true, ErrorCode.Internal, null));
			future.setFailure(future.getResult().exception);
			return;
		}
		localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);
		try {
			ChannelUtils.writeAbstractLocalPacket(localChannelReference, valid, false);
		} catch (OpenR66ProtocolPacketException e) {
			logger.error(&quot;Bad Protocol&quot;, e);
			Channels.close(localChannelReference.getLocalChannel());
			localChannelReference = null;
			host = null;
			valid = null;
			future.setResult(new R66Result(e, null, true,
					ErrorCode.TransferError, null));
			future.setFailure(e);
			return;
		}
		host = null;
		future.awaitUninterruptibly();
		logger.info(&quot;Request done with &quot; + (future.isSuccess() ? &quot;success&quot; : &quot;error&quot;));</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1452">1452</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1502">1502</a></td></tr><tr class="a"><td colspan='2'><div><pre>	public static boolean setConfigurationInitDatabase(Configuration config, String filename) {
		Document document = null;
		// Open config file
		try {
			document = new SAXReader().read(filename);
		} catch (DocumentException e) {
			logger.error(&quot;Unable to read the XML Config file: &quot; + filename, e);
			return false;
		}
		if (document == null) {
			logger.error(&quot;Unable to read the XML Config file: &quot; + filename);
			return false;
		}
		configuration = XmlUtil.read(document, configServer);
		hashConfig = new XmlHash(configuration);
		if (!loadIdentity(config)) {
			logger.error(&quot;Cannot load Identity&quot;);
			return false;
		}
		if (!loadDatabase(config)) {
			logger.error(&quot;Cannot load Database configuration&quot;);
			return false;
		}
		if (!loadDirectory(config)) {
			logger.error(&quot;Cannot load Directory configuration&quot;);
			return false;
		}
		if (!loadLimit(config, false)) {
			logger.error(&quot;Cannot load Limit configuration&quot;);
			return false;
		}
		if (!DbConstant.admin.isConnected) {
			// if no database, must load authentication from file
			if (!loadAuthentication(config)) {
				logger.error(&quot;Cannot load Authentication configuration&quot;);
				return false;
			}
		}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1440">1440</a></td></tr><tr class="b"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1546">1546</a></td></tr><tr class="a"><td colspan='2'><div><pre>			String system = REQUEST.System.readFileUnique(this);
			StringBuilder builder = new StringBuilder(system);
			WaarpStringUtils.replace(builder, REPLACEMENT.XXXXSESSIONLIMITWXXX.toString(),
					Long.toString(Configuration.configuration.serverChannelWriteLimit));
			WaarpStringUtils.replace(builder, REPLACEMENT.XXXXSESSIONLIMITRXXX.toString(),
					Long.toString(Configuration.configuration.serverChannelReadLimit));
			WaarpStringUtils.replace(builder, REPLACEMENT.XXXXDELAYCOMMDXXX.toString(),
					Long.toString(Configuration.configuration.delayCommander));
			WaarpStringUtils.replace(builder, REPLACEMENT.XXXXDELAYRETRYXXX.toString(),
					Long.toString(Configuration.configuration.delayRetry));
			WaarpStringUtils.replace(builder, REPLACEMENT.XXXXCHANNELLIMITWXXX.toString(),
					Long.toString(Configuration.configuration.serverGlobalWriteLimit));
			WaarpStringUtils.replace(builder, REPLACEMENT.XXXXCHANNELLIMITRXXX.toString(),
					Long.toString(Configuration.configuration.serverGlobalReadLimit));</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#998">998</a></td></tr><tr class="b"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1050">1050</a></td></tr><tr class="a"><td colspan='2'><div><pre>			} else if (&quot;TestConn&quot;.equalsIgnoreCase(parm)) {
				String host = getTrimValue(&quot;host&quot;);
				String addr = getTrimValue(&quot;address&quot;);
				String port = getTrimValue(&quot;port&quot;);
				String key = getTrimValue(&quot;hostkey&quot;);
				boolean ssl, admin, isclient;
				ssl = params.containsKey(&quot;ssl&quot;);
				admin = params.containsKey(&quot;admin&quot;);
				isclient = params.containsKey(&quot;isclient&quot;);
				head = resetOptionHosts(head, host, addr, ssl);
                int iport;
				try {
					iport = Integer.parseInt(port);
				} catch (NumberFormatException e1) {
					body0 = body1 = body = &quot;&quot;;
                    body = &quot;&lt;p&gt;&lt;center&gt;&lt;b&gt;Cannot find a Host: &quot;+e1.getMessage()+&quot;&lt;/b&gt;&lt;/center&gt;&lt;/p&gt;&quot;;
                    head = resetOptionHosts(head, &quot;&quot;, &quot;&quot;, false);
                    return head+body0+body+body1+end;
				}
				DbHostAuth dbhost = new DbHostAuth(dbSession, host, addr, iport,
						ssl, key.getBytes(), admin, isclient);</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\server\ConfigImport.java</td><td><a href="./xref/org/waarp/openr66/server/ConfigImport.html#88">88</a></td></tr><tr class="b"><td>org\waarp\openr66\server\LogExport.java</td><td><a href="./xref/org/waarp/openr66/server/LogExport.html#106">106</a></td></tr><tr class="a"><td colspan='2'><div><pre>		LocalChannelReference localChannelReference = networkTransaction
				.createConnectionWithRetry(socketAddress, isSSL, future);
		socketAddress = null;
		if (localChannelReference == null) {
			host = null;
			logger.error(&quot;Cannot Connect&quot;);
			future.setResult(new R66Result(
					new OpenR66ProtocolNoConnectionException(&quot;Cannot connect to server&quot;),
					null, true, ErrorCode.Internal, null));
			future.setFailure(future.getResult().exception);
			return;
		}
		localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);
		try {
			ChannelUtils.writeAbstractLocalPacket(localChannelReference, valid, false);
		} catch (OpenR66ProtocolPacketException e) {
			logger.error(&quot;Bad Protocol&quot;, e);
			Channels.close(localChannelReference.getLocalChannel());
			localChannelReference = null;
			host = null;
			valid = null;
			future.setResult(new R66Result(e, null, true,
					ErrorCode.TransferError, null));
			future.setFailure(e);
			return;
		}
		host = null;
		future.awaitUninterruptibly();
		logger.debug(&quot;Request done with &quot; + (future.isSuccess() ? &quot;success&quot; : &quot;error&quot;));</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\database\data\DbTaskRunner.java</td><td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#1532">1532</a></td></tr><tr class="b"><td>org\waarp\openr66\database\data\DbTaskRunner.java</td><td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#1572">1572</a></td></tr><tr class="a"><td colspan='2'><div><pre>			DbSession session, boolean in)
			throws WaarpDatabaseNoConnectionException, WaarpDatabaseSqlException {
		String request = &quot;SELECT COUNT(&quot; + Columns.SPECIALID.name() + &quot;) FROM &quot; + table;
		String requesterd;
		String from = Configuration.configuration.HOST_ID;
		String sfrom = Configuration.configuration.HOST_SSLID;
		if (in) {
			requesterd = Columns.REQUESTED.name();
		} else {
			requesterd = Columns.REQUESTER.name();
		}
		if (from != null &amp; sfrom != null) {
			request += &quot; WHERE ((&quot; + requesterd + &quot; = '&quot; +
					from + &quot;' OR &quot; + requesterd + &quot; = '&quot; + sfrom + &quot;') &quot;;
		} else if (from != null) {
			request += &quot; WHERE (&quot; + requesterd + &quot; = '&quot; + from + &quot;' &quot;;
		} else {
			request += &quot; WHERE (&quot; + requesterd + &quot; = '&quot; + sfrom + &quot;' &quot;;
		}
		request += &quot; AND &quot; + getLimitWhereCondition() + &quot;) &quot;;
		request += &quot; AND &quot; + Columns.STARTTRANS.name() + &quot; &gt;= ? &quot;;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1530">1530</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1613">1613</a></td></tr><tr class="a"><td colspan='2'><div><pre>			logger.error(&quot;Cannot load Limit configuration&quot;);
			return false;
		}
		if (!DbConstant.admin.isConnected) {
			// if no database, must load authentication from file
			if (!loadAuthentication(config)) {
				logger.error(&quot;Cannot load Authentication configuration&quot;);
				return false;
			}
		}
		config.HOST_AUTH = R66Auth.getServerAuth(
				DbConstant.admin.session, config.HOST_ID);
		if (config.HOST_AUTH == null &amp;&amp;
				config.useNOSSL) {
			logger.error(&quot;Cannot find Authentication for current host&quot;);
			return false;
		}
		if (config.HOST_SSLID != null) {
			config.HOST_SSLAUTH = R66Auth.getServerAuth(
					DbConstant.admin.session,
					config.HOST_SSLID);
			if (config.HOST_SSLAUTH == null &amp;&amp;
					config.useSSL) {
				logger.error(&quot;Cannot find SSL Authentication for current host&quot;);
				return false;
			}
		}
		hashConfig.clear();
		hashConfig = null;
		configuration = null;
		return true;
	}

	/**
	 * Initiate the configuration from the xml file for server shutdown
	 * 
	 * @param filename
	 * @return True if OK
	 */
	public static boolean setConfigurationServerShutdownFromXml(Configuration config,</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#196">196</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#187">187</a></td></tr><tr class="a"><td colspan='2'><div><pre>			return;
		} finally {
			request.close();
		}
		// Index Runner
		action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
		DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// cptrunner
		action = &quot;CREATE SEQUENCE &quot; + DbTaskRunner.fieldseq +
				&quot; MINVALUE &quot; + (DbConstant.ILLEGALVALUE + 1) +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#689">689</a></td></tr><tr class="b"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#730">730</a></td></tr><tr class="a"><td colspan='2'><div><pre>					body = REQUEST.CancelRestart.readBody();
					body = taskRunner.toSpecializedHtml(authentHttp, body,
							lcr != null ? &quot;Active&quot; : &quot;NotActive&quot;);
					String tstart = taskRunner.getStart().toString();
					tstart = tstart.substring(0, tstart.length());
					String tstop = taskRunner.getStop().toString();
					tstop = tstop.substring(0, tstop.length());
					head = resetOptionTransfer(head, (taskRunner.getSpecialId() - 1) + &quot;&quot;,
							(taskRunner.getSpecialId() + 1) + &quot;&quot;, tstart, tstop,
							taskRunner.getRuleId(), taskRunner.getRequested(),
							false, false, false, false, true);
				}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\context\task\ExecMoveTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecMoveTask.html#96">96</a></td></tr><tr class="b"><td>org\waarp\openr66\context\task\ExecOutputTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecOutputTask.html#100">100</a></td></tr><tr class="a"><td>org\waarp\openr66\context\task\ExecTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecTask.html#83">83</a></td></tr><tr class="b"><td colspan='2'><div><pre>				move(result.status, result.result, finalname);
				localExecClient.disconnect();
				return;
			} // else continue
		}
		String[] args = finalname.split(&quot; &quot;);
		File exec = new File(args[0]);
		if (exec.isAbsolute()) {
			if (!exec.canExecute()) {
				logger.error(&quot;Exec command is not executable: &quot; + finalname);
				R66Result result = new R66Result(session, false,
						ErrorCode.CommandNotFound, session.getRunner());
				futureCompletion.setResult(result);
				futureCompletion.cancel();
				return;
			}
		}
		CommandLine commandLine = new CommandLine(args[0]);
		for (int i = 1; i &lt; args.length; i++) {
			commandLine.addArgument(args[i]);
		}
		DefaultExecutor defaultExecutor = new DefaultExecutor();</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1530">1530</a></td></tr><tr class="a"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1613">1613</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1699">1699</a></td></tr><tr class="a"><td colspan='2'><div><pre>			logger.error(&quot;Cannot load Limit configuration&quot;);
			return false;
		}
		if (!DbConstant.admin.isConnected) {
			// if no database, must load authentication from file
			if (!loadAuthentication(config)) {
				logger.error(&quot;Cannot load Authentication configuration&quot;);
				return false;
			}
		}
		config.HOST_AUTH = R66Auth.getServerAuth(
				DbConstant.admin.session, config.HOST_ID);
		if (config.HOST_AUTH == null &amp;&amp;
				config.useNOSSL) {
			logger.error(&quot;Cannot find Authentication for current host&quot;);
			return false;
		}
		if (config.HOST_SSLID != null) {
			config.HOST_SSLAUTH = R66Auth.getServerAuth(
					DbConstant.admin.session,
					config.HOST_SSLID);
			if (config.HOST_SSLAUTH == null &amp;&amp;
					config.useSSL) {
				logger.error(&quot;Cannot find SSL Authentication for current host&quot;);
				return false;
			}
		}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#194">194</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#196">196</a></td></tr><tr class="a"><td colspan='2'><div><pre>			return;
		} finally {
			request.close();
		}
		// Index Runner
		action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
		DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// cptrunner
		/*
		 * # Table to handle any number of sequences: CREATE TABLE Sequences ( name VARCHAR(22) NOT
		 * NULL, seq INT UNSIGNED NOT NULL, # (or BIGINT) PRIMARY KEY name ); # Create a Sequence:
		 * INSERT INTO Sequences (name, seq) VALUES (?, 0); # Drop a Sequence: DELETE FROM Sequences
		 * WHERE name = ?; # Get a sequence number: UPDATE Sequences SET seq = LAST_INSERT_ID(seq +
		 * 1) WHERE name = ?; $seq = $db-&gt;LastInsertId();
		 */
		action = &quot;CREATE TABLE Sequences (name VARCHAR(22) NOT NULL PRIMARY KEY,&quot; +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\commander\Commander.java</td><td><a href="./xref/org/waarp/openr66/commander/Commander.html#303">303</a></td></tr><tr class="b"><td>org\waarp\openr66\commander\Commander.java</td><td><a href="./xref/org/waarp/openr66/commander/Commander.html#421">421</a></td></tr><tr class="a"><td colspan='2'><div><pre>					hostAuth = null;
				}
			} catch (WaarpDatabaseNoConnectionException e) {
				try {
					DbModelFactory.dbModel.validConnection(DbConstant.admin.session);
				} catch (WaarpDatabaseNoConnectionException e1) {
				}
				logger.error(&quot;Database No Connection Error: Cannot execute Commander&quot;, e);
				return;
			} catch (WaarpDatabaseSqlException e) {
				try {
					DbModelFactory.dbModel.validConnection(DbConstant.admin.session);
				} catch (WaarpDatabaseNoConnectionException e1) {
				}
				logger.error(&quot;Database SQL Error: Cannot execute Commander&quot;, e);
				return;
			} catch (WaarpDatabaseException e) {
				try {
					DbModelFactory.dbModel.validConnection(DbConstant.admin.session);
				} catch (WaarpDatabaseNoConnectionException e1) {
				}
				logger.error(&quot;Database Error: Cannot execute Commander&quot;, e);
				return;
			} finally {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1452">1452</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1502">1502</a></td></tr><tr class="a"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1569">1569</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1652">1652</a></td></tr><tr class="a"><td colspan='2'><div><pre>	public static boolean setConfigurationInitDatabase(Configuration config, String filename) {
		Document document = null;
		// Open config file
		try {
			document = new SAXReader().read(filename);
		} catch (DocumentException e) {
			logger.error(&quot;Unable to read the XML Config file: &quot; + filename, e);
			return false;
		}
		if (document == null) {
			logger.error(&quot;Unable to read the XML Config file: &quot; + filename);
			return false;
		}
		configuration = XmlUtil.read(document, configServer);
		hashConfig = new XmlHash(configuration);
		if (!loadIdentity(config)) {
			logger.error(&quot;Cannot load Identity&quot;);
			return false;
		}
		if (!loadDatabase(config)) {
			logger.error(&quot;Cannot load Database configuration&quot;);
			return false;
		}
		if (!loadDirectory(config)) {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\commander\Commander.java</td><td><a href="./xref/org/waarp/openr66/commander/Commander.html#249">249</a></td></tr><tr class="b"><td>org\waarp\openr66\commander\Commander.java</td><td><a href="./xref/org/waarp/openr66/commander/Commander.html#305">305</a></td></tr><tr class="a"><td>org\waarp\openr66\commander\Commander.java</td><td><a href="./xref/org/waarp/openr66/commander/Commander.html#423">423</a></td></tr><tr class="b"><td colspan='2'><div><pre>			} catch (WaarpDatabaseNoConnectionException e) {
				try {
					DbModelFactory.dbModel.validConnection(DbConstant.admin.session);
				} catch (WaarpDatabaseNoConnectionException e1) {
				}
				logger.error(&quot;Database No Connection Error: Cannot execute Commander&quot;, e);
				return;
			} catch (WaarpDatabaseSqlException e) {
				try {
					DbModelFactory.dbModel.validConnection(DbConstant.admin.session);
				} catch (WaarpDatabaseNoConnectionException e1) {
				}
				logger.error(&quot;Database SQL Error: Cannot execute Commander&quot;, e);
				return;
			} catch (WaarpDatabaseException e) {
				try {
					DbModelFactory.dbModel.validConnection(DbConstant.admin.session);
				} catch (WaarpDatabaseNoConnectionException e1) {
				}
				logger.error(&quot;Database Error: Cannot execute Commander&quot;, e);
				return;
			} finally {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\server\ConfigExport.java</td><td><a href="./xref/org/waarp/openr66/server/ConfigExport.html#181">181</a></td></tr><tr class="a"><td>org\waarp\openr66\server\LogExport.java</td><td><a href="./xref/org/waarp/openr66/server/LogExport.html#293">293</a></td></tr><tr class="b"><td colspan='2'><div><pre>					logger.warn(&quot;SUCCESS on Final files:\n    &quot; +
							(result.other != null ? ((ValidPacket) result.other).getSheader() :
									&quot;no file&quot;)
							+ &quot;\n    delay: &quot; + delay);
				}
			} else {
				if (result.code == ErrorCode.Warning) {
					logger.warn(&quot;Transfer is\n    WARNED&quot;, future.getCause());
					networkTransaction.closeAll();
					System.exit(result.code.ordinal());
				} else {
					logger.error(&quot;Transfer in\n    FAILURE&quot;, future.getCause());
					networkTransaction.closeAll();
					System.exit(result.code.ordinal());
				}
			}
		} finally {
			networkTransaction.closeAll();
		}
	}

}</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#485">485</a></td></tr><tr class="a"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#559">559</a></td></tr><tr class="b"><td colspan='2'><div><pre>					all = true;
				}
				Timestamp tstart = WaarpStringUtils.fixDate(start);
				if (tstart != null) {
					start = tstart.toString();
				}
				Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
				if (tstop != null) {
					stop = tstop.toString();
				}
				head = resetOptionTransfer(head, startid == null ? &quot;&quot; : startid,
						stopid == null ? &quot;&quot; : stopid, start, stop,
						rule == null ? &quot;&quot; : rule, req == null ? &quot;&quot; : req,
						pending, transfer, error, done, all);
				body = REQUEST.CancelRestart.readBody();</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\context\filesystem\R66File.java</td><td><a href="./xref/org/waarp/openr66/context/filesystem/R66File.html#456">456</a></td></tr><tr class="a"><td>org\waarp\openr66\context\filesystem\R66File.java</td><td><a href="./xref/org/waarp/openr66/context/filesystem/R66File.html#510">510</a></td></tr><tr class="b"><td colspan='2'><div><pre>			File newFile = getFileFromPath(path);
			if (newFile.getParentFile().canWrite()) {
				if (!file.renameTo(newFile)) {
					FileOutputStream fileOutputStream;
					try {
						fileOutputStream = new FileOutputStream(newFile);
					} catch (FileNotFoundException e) {
						logger
								.warn(&quot;Cannot find file: &quot; + newFile.getName(),
										e);
						return false;
					}
					FileChannel fileChannelOut = fileOutputStream.getChannel();
					if (get(fileChannelOut)) {
						delete();
					} else {
						try {
							fileChannelOut.close();
						} catch (IOException e) {
						}
						logger.error(&quot;Cannot write file: {}&quot;, newFile);
						return false;
					}
				}
				currentFile = getRelativePath(newFile);</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="a"><th>File</th><th>Line</th></tr><tr class="b"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#503">503</a></td></tr><tr class="a"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#517">517</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#531">531</a></td></tr><tr class="a"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#545">545</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#559">559</a></td></tr><tr class="a"><td colspan='2'><div><pre>		if (array != null) {
			for (rank = 0; rank &lt; array.length; rank++) {
				Element task = new DefaultElement(XTASK);
				task.add(newElement(DbRule.TASK_TYPE, array[rank][0]));
				task.add(newElement(DbRule.TASK_PATH, array[rank][1]));
				task.add(newElement(DbRule.TASK_DELAY, array[rank][2]));
				roottasks.add(task);
			}
		}
		tasks.add(roottasks);
		root.add(tasks);
		tasks = new DefaultElement(XRPOSTTASKS);</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#196">196</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#199">199</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#201">201</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#192">192</a></td></tr><tr class="a"><td colspan='2'><div><pre>		action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
		DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
		for (int i = 0; i &lt; icolumns.length - 1; i++) {
			action += icolumns[i].name() + &quot;, &quot;;
		}
		action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
		System.out.println(action);
		try {
			request.query(action);
		} catch (WaarpDatabaseNoConnectionException e) {
			e.printStackTrace();
			return;
		} catch (WaarpDatabaseSqlException e) {
			return;
		} finally {
			request.close();
		}

		// cptrunner
		action = &quot;CREATE SEQUENCE IF NOT EXISTS &quot; + DbTaskRunner.fieldseq +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#370">370</a></td></tr><tr class="b"><td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#559">559</a></td></tr><tr class="a"><td colspan='2'><div><pre>					all = true;
				}
				Timestamp tstart = WaarpStringUtils.fixDate(start);
				if (tstart != null) {
					start = tstart.toString();
				}
				Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
				if (tstop != null) {
					stop = tstop.toString();
				}
				head = resetOptionTransfer(head, startid == null ? &quot;&quot; : startid,
						stopid == null ? &quot;&quot; : stopid, start, stop,
						rule == null ? &quot;&quot; : rule, req == null ? &quot;&quot; : req,
						pending, transfer, error, done, all);
				body = REQUEST.Listing.readBody();</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#119">119</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#122">122</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#123">123</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#115">115</a></td></tr><tr class="a"><td colspan='2'><div><pre>			return;
		} finally {
			request.close();
		}

		// hosts
		action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
		DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
		for (int i = 0; i &lt; hcolumns.length - 1; i++) {
			action += hcolumns[i].name() +
					DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
		}
		action += hcolumns[hcolumns.length - 1].name() +
				DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\protocol\localhandler\LocalServerHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/localhandler/LocalServerHandler.html#1929">1929</a></td></tr><tr class="b"><td>org\waarp\openr66\protocol\localhandler\LocalServerHandler.java</td><td><a href="./xref/org/waarp/openr66/protocol/localhandler/LocalServerHandler.html#2041">2041</a></td></tr><tr class="a"><td colspan='2'><div><pre>					}
				}
				R66Result result = null;
				if (brule || bhost) {
					result = new R66Result(session, true, ErrorCode.CompleteOk, null);
				} else {
					result = new R66Result(session, true, ErrorCode.TransferError, null);
				}
				// Now answer
				ValidPacket valid = new ValidPacket(shost + &quot; &quot; + srule, result.code.getCode(),
						LocalPacketFactory.REQUESTUSERPACKET);
				localChannelReference.validateRequest(result);
				try {
					ChannelUtils.writeAbstractLocalPacket(localChannelReference,
							valid, true);
				} catch (OpenR66ProtocolPacketException e) {
				}
				Channels.close(channel);
				break;
			}
			case LocalPacketFactory.CONFIMPORTPACKET: {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\client\Message.java</td><td><a href="./xref/org/waarp/openr66/client/Message.html#143">143</a></td></tr><tr class="b"><td>org\waarp\openr66\client\RequestInformation.java</td><td><a href="./xref/org/waarp/openr66/client/RequestInformation.html#151">151</a></td></tr><tr class="a"><td colspan='2'><div><pre>			logger.debug(&quot;Requested host cannot be found: &quot; + requested);
			R66Result result = new R66Result(null, true, ErrorCode.ConnectionImpossible, null);
			this.future.setResult(result);
			this.future.cancel();
			return;
		}
		if (host.isClient()) {
			logger.error(&quot;Requested host is a client and cannot be requested: &quot; + requested);
			R66Result result = new R66Result(null, true, ErrorCode.ConnectionImpossible, null);
			this.future.setResult(result);
			this.future.cancel();
			return;
		}
		SocketAddress socketAddress = host.getSocketAddress();
		boolean isSSL = host.isSsl();
		LocalChannelReference localChannelReference = null;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\context\task\RescheduleTransferTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/RescheduleTransferTask.html#217">217</a></td></tr><tr class="b"><td>org\waarp\openr66\context\task\RescheduleTransferTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/RescheduleTransferTask.html#264">264</a></td></tr><tr class="a"><td colspan='2'><div><pre>				String[] elmts = args[i].split(&quot;;&quot;);
				boolean startModified = false;
				String[] values = elmts[0].split(&quot;:&quot;);
				Calendar start = getCalendar(values);
				if (start != null) {
					startModified = true;
				} else {
					start = Calendar.getInstance();
				}
				boolean stopModified = false;
				values = elmts[1].split(&quot;:&quot;);
				Calendar stop = getCalendar(values);
				if (stop != null) {
					stopModified = true;
				} else {
					stop = Calendar.getInstance();
				}
				logger.debug(&quot;Dates before check: Not between &quot; + start.getTime() + &quot; and &quot;</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#61">61</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#64">64</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#62">62</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#57">57</a></td></tr><tr class="a"><td colspan='2'><div><pre>		String primaryKey = &quot; PRIMARY KEY &quot;;
		String notNull = &quot; NOT NULL &quot;;

		// Multiple Mode
		String action = createTableH2 + DbMultipleMonitor.table + &quot;(&quot;;
		DbMultipleMonitor.Columns[] mcolumns = DbMultipleMonitor.Columns
				.values();
		for (int i = 0; i &lt; mcolumns.length - 1; i++) {
			action += mcolumns[i].name() +
					DBType.getType(DbMultipleMonitor.dbTypes[i]) + notNull +
					&quot;, &quot;;
		}
		action += mcolumns[mcolumns.length - 1].name() +
				DBType.getType(DbMultipleMonitor.dbTypes[mcolumns.length - 1]) +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#503">503</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#517">517</a></td></tr><tr class="a"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#531">531</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#545">545</a></td></tr><tr class="a"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#559">559</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#573">573</a></td></tr><tr class="a"><td colspan='2'><div><pre>		if (array != null) {
			for (rank = 0; rank &lt; array.length; rank++) {
				Element task = new DefaultElement(XTASK);
				task.add(newElement(DbRule.TASK_TYPE, array[rank][0]));
				task.add(newElement(DbRule.TASK_PATH, array[rank][1]));
				task.add(newElement(DbRule.TASK_DELAY, array[rank][2]));
				roottasks.add(task);
			}
		}
		tasks.add(roottasks);
		root.add(tasks);</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelH2.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#142">142</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelMysql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#145">145</a></td></tr><tr class="a"><td>org\waarp\openr66\database\model\DbModelOracle.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#147">147</a></td></tr><tr class="b"><td>org\waarp\openr66\database\model\DbModelPostgresql.java</td><td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#138">138</a></td></tr><tr class="a"><td colspan='2'><div><pre>			return;
		} finally {
			request.close();
		}

		// rules
		action = createTableH2 + DbRule.table + &quot;(&quot;;
		DbRule.Columns[] rcolumns = DbRule.Columns.values();
		for (int i = 0; i &lt; rcolumns.length - 1; i++) {
			action += rcolumns[i].name() +
					DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
		}
		action += rcolumns[rcolumns.length - 1].name() +
				DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\database\data\DbTaskRunner.java</td><td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#755">755</a></td></tr><tr class="b"><td>org\waarp\openr66\database\data\DbTaskRunner.java</td><td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#793">793</a></td></tr><tr class="a"><td colspan='2'><div><pre>	public void insert() throws WaarpDatabaseException {
		if (isSaved) {
			return;
		}
		if (dbSession == null) {
			if (specialId == DbConstant.ILLEGALVALUE) {
				// New SpecialId is not possible with No Database Model
				createNoDbSpecialId();
			}
			isSaved = true;
			if (Configuration.configuration.saveTaskRunnerWithNoDb) {
				try {
					setToArray();
					this.writeXmlWorkNoDb();
				} catch (OpenR66ProtocolBusinessException e) {
					// Ignore
				}
			}
			if (this.updatedInfo == UpdatedInfo.TOSUBMIT.ordinal()) {
				addNoDb();
			}
			return;
		}
		// First need to find a new id if id is not ok
		if (specialId == DbConstant.ILLEGALVALUE) {
			specialId = DbModelFactory.dbModel.nextSequence(dbSession);
			logger.debug(&quot;Try Insert create a new Id from sequence: &quot; +</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#575">575</a></td></tr><tr class="b"><td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td><td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#590">590</a></td></tr><tr class="a"><td colspan='2'><div><pre>					configNetworkServerDecls, false),
			new XmlDecl(XML_SSL, XmlType.XVAL, XML_ROOT + XML_SSL, configSslDecls, false),
			new XmlDecl(XML_DIRECTORY, XmlType.XVAL, XML_ROOT + XML_DIRECTORY,
					configDirectoryDecls, false),
			new XmlDecl(XML_LIMIT, XmlType.XVAL, XML_ROOT + XML_LIMIT, configLimitDecls, false),
			new XmlDecl(XML_DB, XmlType.XVAL, XML_ROOT + XML_DB, configDbDecls, false),
			new XmlDecl(XML_BUSINESS, XmlType.STRING, XML_ROOT + XML_BUSINESS + &quot;/&quot;
					+ XML_BUSINESSID, true)
	};
	/**
	 * Global Structure for Client Configuration
	 */
	private static final XmlDecl[] configClient = {</pre></div></td></tr></table><table border="0" class="bodyTable"><tr class="b"><th>File</th><th>Line</th></tr><tr class="a"><td>org\waarp\openr66\context\task\ExecMoveTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecMoveTask.html#145">145</a></td></tr><tr class="b"><td>org\waarp\openr66\context\task\ExecOutputTask.java</td><td><a href="./xref/org/waarp/openr66/context/task/ExecOutputTask.html#148">148</a></td></tr><tr class="a"><td colspan='2'><div><pre>		Thread thread = new Thread(lastLineReader, &quot;ExecRename&quot;
				+ session.getRunner().getSpecialId());
		thread.setDaemon(true);
		Configuration.configuration.getExecutorService().execute(thread);
		int status = -1;
		try {
			status = defaultExecutor.execute(commandLine);
		} catch (ExecuteException e) {
			if (e.getExitValue() == -559038737) {
				// Cannot run immediately so retry once
				try {
					Thread.sleep(Configuration.RETRYINMS);
				} catch (InterruptedException e1) {
				}
				try {
					status = defaultExecutor.execute(commandLine);
				} catch (ExecuteException e1) {</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2009-2012
                        <a href="http://www.waarp.it">Waarp</a>.
            All Rights Reserved.      
                
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
