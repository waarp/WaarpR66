<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.4 at 2016-02-10 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Waarp OpenR66 - CPD Results</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta name="Date-Revision-yyyymmdd" content="20160210" />
    <meta http-equiv="Content-Language" content="en" />
        
        </head>
  <body class="composite">
    <div id="banner">
                        <a href="http://www.waarp.it" id="bannerLeft">
                                                <img src="images/waarp.jpg" alt="Waarp Project" />
                </a>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                    
                <div class="xleft">
        <span id="publishDate">Last Published: 2016-02-10</span>
                  &nbsp;| <span id="projectVersion">Version: 3.0.6</span>
                      </div>
            <div class="xright">                    <a href="http://www.waarp.it/" class="externalLink" title="Waarp">Waarp</a>
              
                    
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                    
                                <h5>Waarp OpenR66</h5>
                  <ul>
                  <li class="none">
                          <a href="index.html" title="Overview of OpenR66">Overview of OpenR66</a>
            </li>
                  <li class="none">
                          <a href="configuration.html" title="Configuration of OpenR66 Server and Clients">Configuration of OpenR66 Server and Clients</a>
            </li>
                  <li class="none">
                          <a href="sslconfig.html" title="Configuration of OpenR66 SSL keys">Configuration of OpenR66 SSL keys</a>
            </li>
                  <li class="none">
                          <a href="commands.html" title="Commands for OpenR66 Server and Clients">Commands for OpenR66 Server and Clients</a>
            </li>
                  <li class="none">
                          <a href="protocol.html" title="Protocol for OpenR66 File Transfer">Protocol for OpenR66 File Transfer</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                  <li class="collapsed">
                          <a href="project-info.html" title="Project Information">Project Information</a>
                  </li>
                                                                                                                                                                                                                                                                                    <li class="expanded">
                          <a href="project-reports.html" title="Project Reports">Project Reports</a>
                    <ul>
                      <li class="none">
                          <a href="xref/index.html" title="Source Xref">Source Xref</a>
            </li>
                      <li class="none">
                          <a href="xref-test/index.html" title="Test Source Xref">Test Source Xref</a>
            </li>
                      <li class="none">
                          <a href="github-report.html" title="GitHub Report">GitHub Report</a>
            </li>
                      <li class="none">
                          <a href="changes-report.html" title="Changes Report">Changes Report</a>
            </li>
                      <li class="none">
                          <a href="changelog.html" title="Change Log">Change Log</a>
            </li>
                      <li class="none">
                          <a href="file-activity.html" title="File Activity">File Activity</a>
            </li>
                      <li class="none">
                          <a href="dev-activity.html" title="Developer Activity">Developer Activity</a>
            </li>
                      <li class="none">
                          <a href="taglist.html" title="Tag List">Tag List</a>
            </li>
                      <li class="none">
                          <a href="findbugs.html" title="FindBugs Report">FindBugs Report</a>
            </li>
                      <li class="none">
            <strong>CPD Report</strong>
          </li>
                      <li class="none">
                          <a href="pmd.html" title="PMD Report">PMD Report</a>
            </li>
                      <li class="none">
                          <a href="api/index.html" title="JavaDocs">JavaDocs</a>
            </li>
              </ul>
        </li>
          </ul>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                   
                    
            </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section">
<h2>CPD Results<a name="CPD_Results"></a></h2>
<p>The following document contains the results of PMD's  <a class="externalLink" href="http://pmd.sourceforge.net/cpd.html">CPD</a> 5.0.2.</p></div>
<div class="section">
<h2>Duplications<a name="Duplications"></a></h2>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#56">56</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#56">56</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>    public DbModelMariadb(String dbserver, String dbuser, String dbpasswd)
            throws WaarpDatabaseNoConnectionException {
        super(dbserver, dbuser, dbpasswd);
    }

    private final ReentrantLock lock = new ReentrantLock();

    @Override
    public void createTables(DbSession session) throws WaarpDatabaseNoConnectionException {
        // Create tables: configuration, hosts, rules, runner, cptrunner
        String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;
        String primaryKey = &quot; PRIMARY KEY &quot;;
        String notNull = &quot; NOT NULL &quot;;

        // Multiple Mode
        String action = createTableH2 + DbMultipleMonitor.table + &quot;(&quot;;
        DbMultipleMonitor.Columns[] mcolumns = DbMultipleMonitor.Columns
                .values();
        for (int i = 0; i &lt; mcolumns.length - 1; i++) {
            action += mcolumns[i].name() +
                    DBType.getType(DbMultipleMonitor.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += mcolumns[mcolumns.length - 1].name() +
                DBType.getType(DbMultipleMonitor.dbTypes[mcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        DbRequest request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        DbMultipleMonitor multipleMonitor = new DbMultipleMonitor(session,
                Configuration.configuration.getHOST_ID(), 0, 0, 0);
        try {
            if (!multipleMonitor.exist())
                multipleMonitor.insert();
        } catch (WaarpDatabaseException e1) {
            e1.printStackTrace();
        }

        // Configuration
        action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
        DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
                .values();
        for (int i = 0; i &lt; ccolumns.length - 1; i++) {
            action += ccolumns[i].name() +
                    DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += ccolumns[ccolumns.length - 1].name() +
                DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // HostConfiguration
        action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
        DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                .values();
        for (int i = 0; i &lt; chcolumns.length - 1; i++) {
            action += chcolumns[i].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += chcolumns[chcolumns.length - 1].name() +
                DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // hosts
        action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
        DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
        for (int i = 0; i &lt; hcolumns.length - 1; i++) {
            action += hcolumns[i].name() +
                    DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        action += hcolumns[hcolumns.length - 1].name() +
                DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // rules
        action = createTableH2 + DbRule.table + &quot;(&quot;;
        DbRule.Columns[] rcolumns = DbRule.Columns.values();
        for (int i = 0; i &lt; rcolumns.length - 1; i++) {
            action += rcolumns[i].name() +
                    DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
        }
        action += rcolumns[rcolumns.length - 1].name() +
                DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // runner
        action = createTableH2 + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] acolumns = DbTaskRunner.Columns.values();
        for (int i = 0; i &lt; acolumns.length; i++) {
            action += acolumns[i].name() +
                    DBType.getType(DbTaskRunner.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        // Several columns for primary key
        action += &quot; CONSTRAINT runner_pk &quot; + primaryKey + &quot;(&quot;;
        for (int i = DbTaskRunner.NBPRKEY; i &gt; 1; i--) {
            action += acolumns[acolumns.length - i].name() + &quot;,&quot;;
        }
        action += acolumns[acolumns.length - 1].name() + &quot;))&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        // Index Runner
        action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
        for (int i = 0; i &lt; icolumns.length - 1; i++) {
            action += icolumns[i].name() + &quot;, &quot;;
        }
        action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // cptrunner
        /*
         * # Table to handle any number of sequences: CREATE TABLE Sequences ( name VARCHAR(22) NOT
         * NULL, seq INT UNSIGNED NOT NULL, # (or BIGINT) PRIMARY KEY name ); # Create a Sequence:
         * INSERT INTO Sequences (name, seq) VALUES (?, 0); # Drop a Sequence: DELETE FROM Sequences
         * WHERE name = ?; # Get a sequence number: UPDATE Sequences SET seq = LAST_INSERT_ID(seq +
         * 1) WHERE name = ?; $seq = $db-&gt;LastInsertId();
         */
        action = &quot;CREATE TABLE Sequences (name VARCHAR(22) NOT NULL PRIMARY KEY,&quot; +
                &quot;seq BIGINT NOT NULL)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        action = &quot;INSERT INTO Sequences (name, seq) VALUES ('&quot; + DbTaskRunner.fieldseq + &quot;', &quot; +
                (DbConstant.ILLEGALVALUE + 1) + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
    }

    @Override
    public void resetSequence(DbSession session, long newvalue)
            throws WaarpDatabaseNoConnectionException {
        String action = &quot;UPDATE Sequences SET seq = &quot; + newvalue +
                &quot; WHERE name = '&quot; + DbTaskRunner.fieldseq + &quot;'&quot;;
        DbRequest request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            return;
        } finally {
            request.close();
        }
        System.out.println(action);
    }

    @Override
    public synchronized long nextSequence(DbSession dbSession)
            throws WaarpDatabaseNoConnectionException,
            WaarpDatabaseSqlException, WaarpDatabaseNoDataException {
        lock.lock();
        try {
            long result = DbConstant.ILLEGALVALUE;
            String action = &quot;SELECT seq FROM Sequences WHERE name = '&quot; +
                    DbTaskRunner.fieldseq + &quot;' FOR UPDATE&quot;;
            DbPreparedStatement preparedStatement = new DbPreparedStatement(
                    dbSession);
            try {
                dbSession.getConn().setAutoCommit(false);
            } catch (SQLException e1) {
            }
            try {
                preparedStatement.createPrepareStatement(action);
                // Limit the search
                preparedStatement.executeQuery();
                if (preparedStatement.getNext()) {
                    try {
                        result = preparedStatement.getResultSet().getLong(1);
                    } catch (SQLException e) {
                        throw new WaarpDatabaseSqlException(e);
                    }
                } else {
                    throw new WaarpDatabaseNoDataException(
                            &quot;No sequence found. Must be initialized first&quot;);
                }
            } finally {
                preparedStatement.realClose();
            }
            action = &quot;UPDATE Sequences SET seq = &quot; + (result + 1) +
                    &quot; WHERE name = '&quot; + DbTaskRunner.fieldseq + &quot;'&quot;;
            try {
                preparedStatement.createPrepareStatement(action);
                // Limit the search
                preparedStatement.executeUpdate();
            } finally {
                preparedStatement.realClose();
            }
            return result;
        } finally {
            try {
                dbSession.getConn().setAutoCommit(true);
            } catch (SQLException e1) {
            }
            lock.unlock();
        }
    }

    public boolean upgradeDb(DbSession session, String version) throws WaarpDatabaseNoConnectionException {
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_13.getVersion() + &quot;? &quot; + true);
            String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;
            String primaryKey = &quot; PRIMARY KEY &quot;;
            String notNull = &quot; NOT NULL &quot;;

            // HostConfiguration
            String action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
            DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                    .values();
            for (int i = 0; i &lt; chcolumns.length - 1; i++) {
                action += chcolumns[i].name() +
                        DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                        &quot;, &quot;;
            }
            action += chcolumns[chcolumns.length - 1].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                    primaryKey + &quot;)&quot;;
            System.out.println(action);
            DbRequest request = new DbRequest(session);
            try {
                request.query(action);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
        }
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_17.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_17.getVersion() + &quot;? &quot; + true);
            DbRequest request = new DbRequest(session);
            try {
                String command = &quot;ALTER TABLE &quot;
                        + DbTaskRunner.table
                        + &quot; ADD COLUMN &quot;
                        +
                        DbTaskRunner.Columns.TRANSFERINFO.name()
                        + &quot; &quot;
                        +
                        DBType.getType(DbTaskRunner.dbTypes[DbTaskRunner.Columns.TRANSFERINFO
                                .ordinal()]) +
                        &quot; AFTER &quot; + DbTaskRunner.Columns.FILEINFO.name();
                request.query(command);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                //return false;
            } finally {
                request.close();
            }
        }
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_23.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_23.getVersion() + &quot;? &quot; + true);
            DbRequest request = new DbRequest(session);
            try {
                String command = &quot;ALTER TABLE &quot;
                        + DbHostAuth.table
                        + &quot; ADD COLUMN &quot;
                        +
                        DbHostAuth.Columns.ISACTIVE.name()
                        + &quot; &quot;
                        +
                        DBType.getType(DbHostAuth.dbTypes[DbHostAuth.Columns.ISACTIVE
                                .ordinal()]) +
                        &quot; AFTER &quot; + DbHostAuth.Columns.ISCLIENT.name();
                request.query(command);
                command = &quot;UPDATE &quot; + DbHostAuth.table + &quot; SET &quot; + DbHostAuth.Columns.ISACTIVE.name() + &quot; = &quot; + true;
                request.query(command);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                //return false;
            } finally {
                request.close();
            }
            try {
                String command = &quot;ALTER TABLE &quot;
                        + DbHostAuth.table
                        + &quot; ADD COLUMN &quot;
                        +
                        DbHostAuth.Columns.ISPROXIFIED.name()
                        + &quot; &quot;
                        +
                        DBType.getType(DbHostAuth.dbTypes[DbHostAuth.Columns.ISPROXIFIED
                                .ordinal()]) +
                        &quot; AFTER &quot; + DbHostAuth.Columns.ISACTIVE.name();
                request.query(command);
                command = &quot;UPDATE &quot; + DbHostAuth.table + &quot; SET &quot; + DbHostAuth.Columns.ISPROXIFIED.name() + &quot; = &quot;
                        + false;
                request.query(command);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                //return false;
            } finally {
                request.close();
            }
        }
        if (PartnerConfiguration.isVersion2GTVersion1(version, R66Versions.V2_4_25.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_25.getVersion() + &quot;? &quot; + true);
            String command = &quot;ALTER TABLE &quot; + DbTaskRunner.table + &quot; MODIFY &quot; +
                    DbTaskRunner.Columns.FILENAME.name() + &quot; &quot; +
                    DBType.getType(DbTaskRunner.dbTypes[DbTaskRunner.Columns.FILENAME.ordinal()]) +
                    &quot; NOT NULL &quot;;
            DbRequest request = new DbRequest(session);
            try {
                System.out.println(&quot;Command: &quot; + command);
                request.query(command);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
            command = &quot;ALTER TABLE &quot; + DbTaskRunner.table + &quot; MODIFY &quot; +
                    DbTaskRunner.Columns.ORIGINALNAME.name() + &quot; &quot; +
                    DBType.getType(DbTaskRunner.dbTypes[DbTaskRunner.Columns.ORIGINALNAME.ordinal()]) +
                    &quot; NOT NULL &quot;;
            request = new DbRequest(session);
            try {
                System.out.println(&quot;Command: &quot; + command);
                request.query(command);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
        }
        DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                R66Versions.V2_4_25.getVersion());
        return true;
    }

    public boolean needUpgradeDb(DbSession session, String version, boolean tryFix)
            throws WaarpDatabaseNoConnectionException {
        // Check if the database is up to date
        DbRequest request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbHostConfiguration.Columns.HOSTID.name() + &quot; from &quot;
                        + DbHostConfiguration.table +
                        &quot; where &quot; + DbHostConfiguration.Columns.HOSTID + &quot; = '&quot; + Configuration.configuration.getHOST_ID()
                        + &quot;'&quot;);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_13.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_17.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbTaskRunner.Columns.TRANSFERINFO.name() + &quot; from &quot; + DbTaskRunner.table +
                        &quot; where &quot; + DbTaskRunner.Columns.SPECIALID + &quot; = &quot; + DbConstant.ILLEGALVALUE);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_17.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_23.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbHostAuth.Columns.ISACTIVE.name() + &quot; from &quot; + DbHostAuth.table +
                        &quot; where &quot; + DbHostAuth.Columns.PORT + &quot; = &quot; + 0);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_23.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GTVersion1(version, R66Versions.V2_4_25.getVersion())) {
            try {
                if (upgradeDb(session, version)) {
                    DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                            R66Versions.V2_4_25.getVersion());
                } else {
                    return true;
                }
            } finally {
            }
        }
        return false;
    }

}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#2149">2149</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#2169">2169</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                break;
            case Spooled:
                responseContent.append(Spooled(false));
                break;
            case SpooledDetailed:
                responseContent.append(Spooled(true));
                break;
            default:
                responseContent.append(index());
                break;
        }
        writeResponse(ctx);
    }

    private void checkSession(Channel channel) {
        String cookieString = request.headers().get(HttpHeaderNames.COOKIE);
        if (cookieString != null) {
            Set&lt;Cookie&gt; cookies = ServerCookieDecoder.LAX.decode(cookieString);
            if (!cookies.isEmpty()) {
                for (Cookie elt : cookies) {
                    if (elt.name().equalsIgnoreCase(R66SESSION + Configuration.configuration.getHOST_ID())) {
                        logger.debug(&quot;Found session: &quot; + elt);
                        admin = elt;
                        R66Session session = sessions.get(admin.value());
                        if (session != null) {
                            authentHttp = session;
                            authentHttp.setStatus(73);
                        } else {
                            admin = null;
                            continue;
                        }
                        DbSession dbSession = dbSessions.get(admin.value());
                        if (dbSession != null) {
                            if (dbSession.isDisActive()) {
                                clearSession();
                            }
                            this.dbSession = dbSession;
                        } else {
                            admin = null;
                            continue;
                        }
                    } else if (elt.name().equalsIgnoreCase(I18NEXT)) {
                        logger.debug(&quot;Found i18next: &quot; + elt);
                        lang = elt.value();
                    }
                }
            }
        }
        if (admin == null) {
            logger.debug(&quot;NoSession: &quot; + uriRequest + &quot;:{}&quot;, admin);
        }
    }

    private void handleCookies(HttpResponse response) {
        String cookieString = request.headers().get(HttpHeaderNames.COOKIE);
        boolean i18nextFound = false;
        if (cookieString != null) {
            Set&lt;Cookie&gt; cookies = ServerCookieDecoder.LAX.decode(cookieString);
            if (!cookies.isEmpty()) {
                // Reset the sessions if necessary.
                boolean findSession = false;
                for (Cookie cookie : cookies) {
                    if (cookie.name().equalsIgnoreCase(R66SESSION + Configuration.configuration.getHOST_ID())) {
                        if (newSession) {
                            findSession = false;
                        } else {
                            findSession = true;
                            response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(cookie));
                        }
                    } else if (cookie.name().equalsIgnoreCase(I18NEXT)) {
                        i18nextFound = true;
                        cookie.setValue(lang);
                        response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(cookie));
                    } else {
                        response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(cookie));
                    }
                }
                if (!i18nextFound) {
                    Cookie cookie = new DefaultCookie(I18NEXT, lang);
                    response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(cookie));
                }
                newSession = false;
                if (!findSession) {
                    if (admin != null) {
                        response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(admin));
                        logger.debug(&quot;AddSession: &quot; + uriRequest + &quot;:{}&quot;, admin);
                    }
                }
            }
        } else {
            Cookie cookie = new DefaultCookie(I18NEXT, lang);
            response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(cookie));
            if (admin != null) {
                logger.debug(&quot;AddSession: &quot; + uriRequest + &quot;:{}&quot;, admin);
                response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(admin));
            }
        }
    }

    /**
     * Write the response
     * 
     * @param ctx
     */
    private void writeResponse(ChannelHandlerContext ctx) {
        // Convert the response content to a ByteBuf.
        ByteBuf buf = Unpooled.copiedBuffer(responseContent.toString(),
                WaarpStringUtils.UTF8);
        responseContent.setLength(0);

        // Decide whether to close the connection or not.
        boolean keepAlive = HttpUtil.isKeepAlive(request);
        boolean close = HttpHeaderValues.CLOSE.contentEqualsIgnoreCase(request
                .headers().get(HttpHeaderNames.CONNECTION)) ||
                (!keepAlive) || forceClose;

        // Build the response object.
        FullHttpResponse response = new DefaultFullHttpResponse(HttpVersion.HTTP_1_1, HttpResponseStatus.OK, buf);
        response.headers().add(HttpHeaderNames.CONTENT_LENGTH, response.content().readableBytes());
        response.headers().set(HttpHeaderNames.CONTENT_TYPE, &quot;text/html&quot;);
        if (keepAlive) {
            response.headers().set(HttpHeaderNames.CONNECTION, HttpHeaderValues.KEEP_ALIVE);
        }
        if (!close) {
            // There's no need to add 'Content-Length' header
            // if this is the last response.
            response.headers().set(HttpHeaderNames.CONTENT_LENGTH,
                    String.valueOf(buf.readableBytes()));
        }

        handleCookies(response);

        // Write the response.
        ChannelFuture future = ctx.writeAndFlush(response);
        // Close the connection after the write operation is done if necessary.
        if (close) {
            future.addListener(WaarpSslUtility.SSLCLOSE);
        }
        if (shutdown) {
            ChannelUtils.startShutdown();
        }
    }

    /**
     * Send an error and close
     * 
     * @param ctx
     * @param status
     */
    private void sendError(ChannelHandlerContext ctx, HttpResponseStatus status) {
        responseContent.setLength(0);
        responseContent.append(error(status.toString()));
        FullHttpResponse response = new DefaultFullHttpResponse(
                HttpVersion.HTTP_1_1, status,
                Unpooled.copiedBuffer(responseContent.toString(),
                        WaarpStringUtils.UTF8));
        response.headers().add(HttpHeaderNames.CONTENT_LENGTH, response.content().readableBytes());
        response.headers().set(HttpHeaderNames.CONTENT_TYPE, &quot;text/html&quot;);
        responseContent.setLength(0);
        clearSession();
        // Close the connection as soon as the error message is sent.
        ctx.writeAndFlush(response).addListener(WaarpSslUtility.SSLCLOSE);
    }

    @Override
    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause)
            throws Exception {
        OpenR66Exception exception = OpenR66ExceptionTrappedFactory
                .getExceptionFromTrappedException(ctx.channel(), cause);
        if (exception != null) {
            if (!(exception instanceof OpenR66ProtocolBusinessNoWriteBackException)) {
                if (cause instanceof IOException) {
                    // Nothing to do
                    return;
                }
                logger.warn(&quot;Exception in HttpSslHandler {}&quot;, exception.getMessage());
            }
            if (ctx.channel().isActive()) {
                sendError(ctx, HttpResponseStatus.BAD_REQUEST);
            }
        } else {
            // Nothing to do
            return;
        }
    }

    @Override
    public void channelActive(ChannelHandlerContext ctx) throws Exception {
        Channel channel = ctx.channel();
        Configuration.configuration.getHttpChannelGroup().add(channel);
        super.channelActive(ctx);
    }

    /**
     * @return the lIMITROW
     */
    public int getLIMITROW() {
        return LIMITROW;
    }

    /**
     * @param lIMITROW the lIMITROW to set
     */
    private void setLIMITROW(int lIMITROW) {
        LIMITROW = lIMITROW;
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#67">67</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#67">67</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#85">85</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        String primaryKey = &quot; PRIMARY KEY &quot;;
        String notNull = &quot; NOT NULL &quot;;

        // Multiple Mode
        String action = createTableH2 + DbMultipleMonitor.table + &quot;(&quot;;
        DbMultipleMonitor.Columns[] mcolumns = DbMultipleMonitor.Columns
                .values();
        for (int i = 0; i &lt; mcolumns.length - 1; i++) {
            action += mcolumns[i].name() +
                    DBType.getType(DbMultipleMonitor.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += mcolumns[mcolumns.length - 1].name() +
                DBType.getType(DbMultipleMonitor.dbTypes[mcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        DbRequest request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        DbMultipleMonitor multipleMonitor = new DbMultipleMonitor(session,
                Configuration.configuration.getHOST_ID(), 0, 0, 0);
        try {
            if (!multipleMonitor.exist())
                multipleMonitor.insert();
        } catch (WaarpDatabaseException e1) {
            e1.printStackTrace();
        }

        // Configuration
        action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
        DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
                .values();
        for (int i = 0; i &lt; ccolumns.length - 1; i++) {
            action += ccolumns[i].name() +
                    DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += ccolumns[ccolumns.length - 1].name() +
                DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // HostConfiguration
        action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
        DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                .values();
        for (int i = 0; i &lt; chcolumns.length - 1; i++) {
            action += chcolumns[i].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += chcolumns[chcolumns.length - 1].name() +
                DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // hosts
        action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
        DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
        for (int i = 0; i &lt; hcolumns.length - 1; i++) {
            action += hcolumns[i].name() +
                    DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        action += hcolumns[hcolumns.length - 1].name() +
                DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // rules
        action = createTableH2 + DbRule.table + &quot;(&quot;;
        DbRule.Columns[] rcolumns = DbRule.Columns.values();
        for (int i = 0; i &lt; rcolumns.length - 1; i++) {
            action += rcolumns[i].name() +
                    DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
        }
        action += rcolumns[rcolumns.length - 1].name() +
                DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // runner
        action = createTableH2 + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] acolumns = DbTaskRunner.Columns.values();
        for (int i = 0; i &lt; acolumns.length; i++) {
            action += acolumns[i].name() +
                    DBType.getType(DbTaskRunner.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        // Several columns for primary key
        action += &quot; CONSTRAINT runner_pk &quot; + primaryKey + &quot;(&quot;;
        for (int i = DbTaskRunner.NBPRKEY; i &gt; 1; i--) {
            action += acolumns[acolumns.length - i].name() + &quot;,&quot;;
        }
        action += acolumns[acolumns.length - 1].name() + &quot;))&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        // Index Runner
        action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
        for (int i = 0; i &lt; icolumns.length - 1; i++) {
            action += icolumns[i].name() + &quot;, &quot;;
        }
        action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // cptrunner
        /*
         * # Table to handle any number of sequences: CREATE TABLE Sequences ( name VARCHAR(22) NOT
         * NULL, seq INT UNSIGNED NOT NULL, # (or BIGINT) PRIMARY KEY name ); # Create a Sequence:
         * INSERT INTO Sequences (name, seq) VALUES (?, 0); # Drop a Sequence: DELETE FROM Sequences
         * WHERE name = ?; # Get a sequence number: UPDATE Sequences SET seq = LAST_INSERT_ID(seq +
         * 1) WHERE name = ?; $seq = $db-&gt;LastInsertId();
         */
        action = &quot;CREATE TABLE Sequences (name VARCHAR(22) NOT NULL PRIMARY KEY,&quot; +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#60">60</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#63">63</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#63">63</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>    @Override
    public void createTables(DbSession session) throws WaarpDatabaseNoConnectionException {
        // Create tables: configuration, hosts, rules, runner, cptrunner
        String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;
        String primaryKey = &quot; PRIMARY KEY &quot;;
        String notNull = &quot; NOT NULL &quot;;

        // Multiple Mode
        String action = createTableH2 + DbMultipleMonitor.table + &quot;(&quot;;
        DbMultipleMonitor.Columns[] mcolumns = DbMultipleMonitor.Columns
                .values();
        for (int i = 0; i &lt; mcolumns.length - 1; i++) {
            action += mcolumns[i].name() +
                    DBType.getType(DbMultipleMonitor.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += mcolumns[mcolumns.length - 1].name() +
                DBType.getType(DbMultipleMonitor.dbTypes[mcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        DbRequest request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        DbMultipleMonitor multipleMonitor = new DbMultipleMonitor(session,
                Configuration.configuration.getHOST_ID(), 0, 0, 0);
        try {
            if (!multipleMonitor.exist())
                multipleMonitor.insert();
        } catch (WaarpDatabaseException e1) {
            e1.printStackTrace();
        }

        // Configuration
        action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
        DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
                .values();
        for (int i = 0; i &lt; ccolumns.length - 1; i++) {
            action += ccolumns[i].name() +
                    DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += ccolumns[ccolumns.length - 1].name() +
                DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // HostConfiguration
        action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
        DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                .values();
        for (int i = 0; i &lt; chcolumns.length - 1; i++) {
            action += chcolumns[i].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += chcolumns[chcolumns.length - 1].name() +
                DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // hosts
        action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
        DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
        for (int i = 0; i &lt; hcolumns.length - 1; i++) {
            action += hcolumns[i].name() +
                    DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        action += hcolumns[hcolumns.length - 1].name() +
                DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // rules
        action = createTableH2 + DbRule.table + &quot;(&quot;;
        DbRule.Columns[] rcolumns = DbRule.Columns.values();
        for (int i = 0; i &lt; rcolumns.length - 1; i++) {
            action += rcolumns[i].name() +
                    DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
        }
        action += rcolumns[rcolumns.length - 1].name() +
                DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // runner
        action = createTableH2 + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] acolumns = DbTaskRunner.Columns.values();
        for (int i = 0; i &lt; acolumns.length; i++) {
            action += acolumns[i].name() +
                    DBType.getType(DbTaskRunner.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        // Several columns for primary key
        action += &quot; CONSTRAINT runner_pk &quot; + primaryKey + &quot;(&quot;;
        for (int i = DbTaskRunner.NBPRKEY; i &gt; 1; i--) {
            action += acolumns[acolumns.length - i].name() + &quot;,&quot;;
        }
        action += acolumns[acolumns.length - 1].name() + &quot;))&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        // Index Runner
        action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1892">1892</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1919">1919</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                if (params.containsKey(sLIMITROW)) {
                    String snb = getTrimValue(sLIMITROW);
                    if (snb != null) {
                        try {
                            int old = getLIMITROW();
                            setLIMITROW(Integer.parseInt(snb));
                            if (getLIMITROW() &lt; 5) {
                                setLIMITROW(old);
                            }
                        } catch (Exception e1) {
                        }
                    }
                }
            } else {
                params = null;
            }
        }
    }

    private void clearSession() {
        if (admin != null) {
            R66Session lsession = sessions.remove(admin.value());
            DbSession ldbsession = dbSessions.remove(admin.value());
            admin = null;
            if (lsession != null) {
                lsession.setStatus(75);
                lsession.clear();
            }
            if (ldbsession != null) {
                ldbsession.forceDisconnect();
                DbAdmin.decHttpSession();
            }
        }
    }

    private void checkAuthent(ChannelHandlerContext ctx) {
        newSession = true;
        if (request.method() == HttpMethod.GET) {
            String logon = Logon();
            logon = logon.replaceAll(REPLACEMENT.XXXERRORMESGXXX.toString(),
                    &quot;&quot;);
            responseContent.append(logon);
            clearSession();
            writeResponse(ctx);
            return;
        } else if (request.method() == HttpMethod.POST) {
            getParams();
            if (params == null) {
                String logon = Logon();
                logon = logon.replaceAll(REPLACEMENT.XXXERRORMESGXXX.toString(),
                        Messages.getString(&quot;HttpSslHandler.EmptyLogin&quot;));
                responseContent.append(logon);
                clearSession();
                writeResponse(ctx);
                return;
            }
        }
        boolean getMenu = false;
        if (params.containsKey(&quot;Logon&quot;)) {
            String name = null, password = null;
            List&lt;String&gt; values = null;
            if (!params.isEmpty()) {
                // get values
                if (params.containsKey(&quot;name&quot;)) {
                    values = params.get(&quot;name&quot;);
                    if (values != null) {
                        name = values.get(0);
                        if (name == null || name.isEmpty()) {
                            getMenu = true;
                        }
                    }
                } else {
                    getMenu = true;
                }
                // search the nb param
                if ((!getMenu) &amp;&amp; params.containsKey(&quot;passwd&quot;)) {
                    values = params.get(&quot;passwd&quot;);
                    if (values != null) {
                        password = values.get(0);
                        if (password == null || password.isEmpty()) {
                            getMenu = true;
                        } else {
                            getMenu = false;
                        }
                    } else {
                        getMenu = true;
                    }
                } else {
                    getMenu = true;
                }
            } else {
                getMenu = true;
            }
            if (!getMenu) {
                logger.debug(&quot;Name? &quot;
                        + name.equals(Configuration.configuration.getADMINNAME()) +
                        &quot; Passwd? &quot; + Arrays.equals(password.getBytes(WaarpStringUtils.UTF8),
                                Configuration.configuration.getSERVERADMINKEY()));
                if (name.equals(Configuration.configuration.getADMINNAME()) &amp;&amp;
                        Arrays.equals(password.getBytes(WaarpStringUtils.UTF8),
                                Configuration.configuration.getSERVERADMINKEY())) {
                    authentHttp.getAuth().specialNoSessionAuth(true,
                            Configuration.configuration.getHOST_ID());
                    authentHttp.setStatus(70);
                } else {
                    try {
                        authentHttp.getAuth().connectionHttps(DbConstant.admin.getSession(), name,
                                FilesystemBasedDigest.passwdCrypt(password.getBytes(WaarpStringUtils.UTF8)));
                    } catch (Reply530Exception e1) {
                        getMenu = true;
                    } catch (Reply421Exception e1) {
                        getMenu = true;
                    }
                }
                if (!authentHttp.isAuthenticated()) {
                    authentHttp.setStatus(71);
                    logger.debug(&quot;Still not authenticated: {}&quot;, authentHttp);
                    getMenu = true;
                }
                logger.debug(&quot;Identified: &quot; + authentHttp.getAuth().isIdentified() + &quot;:&quot;
                        + authentHttp.isAuthenticated());
            }
        } else {
            getMenu = true;
        }
        if (getMenu) {
            String logon = Logon();
            logon = logon.replaceAll(REPLACEMENT.XXXERRORMESGXXX.toString(),
                    Messages.getString(&quot;HttpSslHandler.BadLogin&quot;));
            responseContent.append(logon);
            clearSession();
            writeResponse(ctx);
        } else {
            // load DbSession
            if (this.dbSession != null) {
                clearSession();
                this.dbSession = null;
            }
            if (this.dbSession == null) {
                try {
                    if (DbConstant.admin.isActive()) {
                        this.dbSession = new DbSession(DbConstant.admin, false);
                        DbAdmin.incHttpSession();
                        this.isPrivateDbSession = true;
                    }
                } catch (WaarpDatabaseNoConnectionException e1) {
                    // Cannot connect so use default connection
                    logger.warn(&quot;Use default database connection&quot;);
                    this.dbSession = DbConstant.admin.getSession();
                }
            }
            String index = index();
            responseContent.append(index);
            clearSession();
            admin = new DefaultCookie(R66SESSION + Configuration.configuration.getHOST_ID(),
                    Configuration.configuration.getHOST_ID() +
                            Long.toHexString(random.nextLong()));
            sessions.put(admin.value(), this.authentHttp);
            authentHttp.setStatus(72);
            if (this.isPrivateDbSession) {
                dbSessions.put(admin.value(), dbSession);
            }
            logger.debug(&quot;CreateSession: &quot; + uriRequest + &quot;:{}&quot;, admin);
            writeResponse(ctx);
        }
    }

    @Override
    protected void channelRead0(ChannelHandlerContext ctx, FullHttpRequest msg) throws Exception {
        FullHttpRequest request = this.request = msg;
        QueryStringDecoder queryStringDecoder = new QueryStringDecoder(request.uri());
        uriRequest = queryStringDecoder.path();
        logger.debug(&quot;Msg: &quot; + uriRequest);
        if (uriRequest.contains(&quot;gre/&quot;) || uriRequest.contains(&quot;img/&quot;) ||
                uriRequest.contains(&quot;app/&quot;) || uriRequest.contains(&quot;css/&quot;) || uriRequest.contains(&quot;js/&quot;) || uriRequest.contains(&quot;datatable/&quot;) ||</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#64">64</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#85">85</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        String primaryKey = &quot; PRIMARY KEY &quot;;
        String notNull = &quot; NOT NULL &quot;;

        // Multiple Mode
        String action = createTableH2 + DbMultipleMonitor.table + &quot;(&quot;;
        DbMultipleMonitor.Columns[] mcolumns = DbMultipleMonitor.Columns
                .values();
        for (int i = 0; i &lt; mcolumns.length - 1; i++) {
            action += mcolumns[i].name() +
                    DBType.getType(DbMultipleMonitor.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += mcolumns[mcolumns.length - 1].name() +
                DBType.getType(DbMultipleMonitor.dbTypes[mcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        DbRequest request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        DbMultipleMonitor multipleMonitor = new DbMultipleMonitor(session,
                Configuration.configuration.getHOST_ID(), 0, 0, 0);
        try {
            if (!multipleMonitor.exist())
                multipleMonitor.insert();
        } catch (WaarpDatabaseException e1) {
            e1.printStackTrace();
        }

        // Configuration
        action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
        DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
                .values();
        for (int i = 0; i &lt; ccolumns.length - 1; i++) {
            action += ccolumns[i].name() +
                    DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += ccolumns[ccolumns.length - 1].name() +
                DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // HostConfiguration
        action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
        DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                .values();
        for (int i = 0; i &lt; chcolumns.length - 1; i++) {
            action += chcolumns[i].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += chcolumns[chcolumns.length - 1].name() +
                DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // hosts
        action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
        DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
        for (int i = 0; i &lt; hcolumns.length - 1; i++) {
            action += hcolumns[i].name() +
                    DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        action += hcolumns[hcolumns.length - 1].name() +
                DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // rules
        action = createTableH2 + DbRule.table + &quot;(&quot;;
        DbRule.Columns[] rcolumns = DbRule.Columns.values();
        for (int i = 0; i &lt; rcolumns.length - 1; i++) {
            action += rcolumns[i].name() +
                    DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
        }
        action += rcolumns[rcolumns.length - 1].name() +
                DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // runner
        action = createTableH2 + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] acolumns = DbTaskRunner.Columns.values();
        for (int i = 0; i &lt; acolumns.length; i++) {
            action += acolumns[i].name() +
                    DBType.getType(DbTaskRunner.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        // Several columns for primary key
        action += &quot; CONSTRAINT runner_pk &quot; + primaryKey + &quot;(&quot;;
        for (int i = DbTaskRunner.NBPRKEY; i &gt; 1; i--) {
            action += acolumns[acolumns.length - i].name() + &quot;,&quot;;
        }
        action += acolumns[acolumns.length - 1].name() + &quot;))&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            // XXX FIX no return;
        } finally {
            request.close();
        }
        // Index Runner
        action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1519">1519</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1603">1603</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            return REQUEST.System.read(this);
        }
        return system;
    }

    private String SystemLimited() {
        getParams();
        DbHostConfiguration config = null;
        try {
            config = new DbHostConfiguration(dbSession, Configuration.configuration.getHOST_ID());
        } catch (WaarpDatabaseException e2) {
            config = new DbHostConfiguration(dbSession, Configuration.configuration.getHOST_ID(), &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;);
            try {
                config.insert();
            } catch (WaarpDatabaseException e) {
            }
        }
        if (params == null) {
            String system = SystemLimitedSource();
            StringBuilder builder = new StringBuilder(system);
            replaceStringSystem(config, builder);
            langHandle(builder);
            return builder.toString();
        }
        String extraInformation = null;
        if (params.containsKey(&quot;ACTION&quot;)) {
            List&lt;String&gt; action = params.get(&quot;ACTION&quot;);
            for (String act : action) {
                if (act.equalsIgnoreCase(&quot;Language&quot;)) {
                    lang = getTrimValue(&quot;change&quot;);
                    extraInformation = Messages.getString(&quot;HttpSslHandler.LangIs&quot;) + &quot;Web: &quot; + lang + &quot; OpenR66: &quot; + Messages.getSlocale(); //$NON-NLS-1$
                } else if (act.equalsIgnoreCase(&quot;Disconnect&quot;)) {
                    String logon = Logon();
                    logon = logon.replaceAll(REPLACEMENT.XXXERRORMESGXXX.toString(),
                            Messages.getString(&quot;HttpSslHandler.DisActive&quot;));
                    newSession = true;
                    clearSession();
                    forceClose = true;
                    return logon;
                }
            }
        }
        String system = SystemLimitedSource();
        StringBuilder builder = new StringBuilder(system);
        replaceStringSystem(config, builder);
        langHandle(builder);
        if (extraInformation != null) {
            builder.append(extraInformation);
        }
        return builder.toString();
    }

    /**
     * @param config
     * @param builder
     */
    private void replaceStringSystem(DbHostConfiguration config, StringBuilder builder) {
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXBUSINESSXXX.toString(),
                config.getBusiness());
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXROLESXXX.toString(),
                config.getRoles());
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXALIASESXXX.toString(),
                config.getAliases());
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXOTHERXXX.toString(),
                config.getOthers());
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXSESSIONLIMITWXXX.toString(),
                Long.toString(Configuration.configuration.getServerChannelWriteLimit()));
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXSESSIONLIMITRXXX.toString(),
                Long.toString(Configuration.configuration.getServerChannelReadLimit()));
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXDELATRAFFICXXX.toString(),
                Long.toString(Configuration.configuration.getDelayLimit()));
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXDELAYCOMMDXXX.toString(),
                Long.toString(Configuration.configuration.getDelayCommander()));
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXDELAYRETRYXXX.toString(),
                Long.toString(Configuration.configuration.getDelayRetry()));
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXCHANNELLIMITWXXX.toString(),
                Long.toString(Configuration.configuration.getServerGlobalWriteLimit()));
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXXCHANNELLIMITRXXX.toString(),
                Long.toString(Configuration.configuration.getServerGlobalReadLimit()));
        WaarpStringUtils.replace(builder, &quot;XXXBLOCKXXX&quot;, Configuration.configuration.isShutdown() ? &quot;checked&quot; : &quot;&quot;);
        switch (WaarpLoggerFactory.getLogLevel()) {
            case DEBUG:
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL1XXX&quot;, &quot;checked&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL2XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL3XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL4XXX&quot;, &quot;&quot;);
                break;
            case INFO:
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL1XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL2XXX&quot;, &quot;checked&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL3XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL4XXX&quot;, &quot;&quot;);
                break;
            case WARN:
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL1XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL2XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL3XXX&quot;, &quot;checked&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL4XXX&quot;, &quot;&quot;);
                break;
            case ERROR:
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL1XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL2XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL3XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL4XXX&quot;, &quot;checked&quot;);
                break;
            default:
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL1XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL2XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL3XXX&quot;, &quot;&quot;);
                WaarpStringUtils.replace(builder, &quot;XXXLEVEL4XXX&quot;, &quot;&quot;);
                break;

        }
    }

    private String Logout() {
        String logon = Logon();
        logon = logon.replaceAll(REPLACEMENT.XXXERRORMESGXXX.toString(),
                Messages.getString(&quot;HttpSslHandler.Disconnected&quot;));
        newSession = true;
        clearSession();
        forceClose = true;
        return logon;
    }

    private void fillHostIds(StringBuilder builder) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1738">1738</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1790">1790</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                                Messages.getString(&quot;HttpSslHandler.46&quot;); //$NON-NLS-1$
                    }
                } else if (act.equalsIgnoreCase(&quot;Disconnect&quot;)) {
                    return Logout();
                } else if (act.equalsIgnoreCase(&quot;Block&quot;)) {
                    boolean block = params.containsKey(&quot;blocking&quot;);
                    if (block) {
                        extraInformation = Messages.getString(&quot;HttpSslHandler.34&quot;); //$NON-NLS-1$
                    } else {
                        extraInformation = Messages.getString(&quot;HttpSslHandler.35&quot;); //$NON-NLS-1$
                    }
                    Configuration.configuration.setShutdown(block);
                } else if (act.equalsIgnoreCase(&quot;Shutdown&quot;)) {
                    String error;
                    if (Configuration.configuration.getShutdownConfiguration().serviceFuture != null) {
                        error = error(Messages.getString(&quot;HttpSslHandler.38&quot;)); //$NON-NLS-1$
                    } else {
                        error = error(Messages.getString(&quot;HttpSslHandler.37&quot;)); //$NON-NLS-1$
                    }
                    R66ShutdownHook.setRestart(false);
                    newSession = true;
                    clearSession();
                    forceClose = true;
                    shutdown = true;
                    return error;
                } else if (act.equalsIgnoreCase(&quot;Restart&quot;)) {
                    String error;
                    if (Configuration.configuration.getShutdownConfiguration().serviceFuture != null) {
                        error = error(Messages.getString(&quot;HttpSslHandler.38&quot;)); //$NON-NLS-1$
                    } else {
                        error = error(Messages.getString(&quot;HttpSslHandler.39&quot;) + (Configuration.configuration.getTIMEOUTCON() * 2 / 1000) + Messages.getString(&quot;HttpSslHandler.40&quot;)); //$NON-NLS-1$ //$NON-NLS-2$
                    }
                    error = error.replace(&quot;XXXRELOADHTTPXXX&quot;, &quot;HTTP-EQUIV=\&quot;refresh\&quot; CONTENT=\&quot;&quot;
                            + (Configuration.configuration.getTIMEOUTCON() * 2 / 1000) + &quot;\&quot;&quot;);
                    R66ShutdownHook.setRestart(true);
                    newSession = true;
                    clearSession();
                    forceClose = true;
                    shutdown = true;
                    return error;
                } else if (act.equalsIgnoreCase(&quot;Validate&quot;)) {
                    String bsessionr = getTrimValue(&quot;BSESSR&quot;);
                    long lsessionr = Configuration.configuration.getServerChannelReadLimit();
                    long lglobalr;
                    long lsessionw;
                    long lglobalw;
                    long delay;
                    try {
                        if (bsessionr != null) {
                            lsessionr = (Long.parseLong(bsessionr) / 10) * 10;
                        }
                        String bglobalr = getTrimValue(&quot;BGLOBR&quot;);
                        lglobalr = Configuration.configuration.getServerGlobalReadLimit();
                        if (bglobalr != null) {
                            lglobalr = (Long.parseLong(bglobalr) / 10) * 10;
                        }
                        String bsessionw = getTrimValue(&quot;BSESSW&quot;);
                        lsessionw = Configuration.configuration.getServerChannelWriteLimit();
                        if (bsessionw != null) {
                            lsessionw = (Long.parseLong(bsessionw) / 10) * 10;
                        }
                        String bglobalw = getTrimValue(&quot;BGLOBW&quot;);
                        lglobalw = Configuration.configuration.getServerGlobalWriteLimit();
                        if (bglobalw != null) {
                            lglobalw = (Long.parseLong(bglobalw) / 10) * 10;
                        }
                        String dtra = getTrimValue(&quot;DTRA&quot;);
                        delay = Configuration.configuration.getDelayLimit();
                        if (dtra != null) {
                            delay = (Long.parseLong(dtra) / 10) * 10;
                            if (delay &lt; 100) {
                                delay = 100;
                            }
                        }
                        Configuration.configuration.changeNetworkLimit(
                                lglobalw, lglobalr, lsessionw, lsessionr,
                                delay);
                        String dcomm = getTrimValue(&quot;DCOM&quot;);
                        if (dcomm != null) {
                            Configuration.configuration.setDelayCommander(Long.parseLong(dcomm));
                            if (Configuration.configuration.getDelayCommander() &lt;= 100) {
                                Configuration.configuration.setDelayCommander(100);
                            }
                            Configuration.configuration.reloadCommanderDelay();
                        }
                        String dret = getTrimValue(&quot;DRET&quot;);
                        if (dret != null) {
                            Configuration.configuration.setDelayRetry(Long.parseLong(dret));
                            if (Configuration.configuration.getDelayRetry() &lt;= 1000) {
                                Configuration.configuration.setDelayRetry(1000);
                            }
                        }
                        extraInformation = Messages.getString(&quot;HttpSslHandler.41&quot;); //$NON-NLS-1$
                    } catch (NumberFormatException e) {
                        extraInformation = Messages.getString(&quot;HttpSslHandler.42&quot;); //$NON-NLS-1$
                    }
                } else if (act.equalsIgnoreCase(&quot;HostConfig&quot;)) {
                    config.setBusiness(getTrimValue(&quot;BUSINESS&quot;));
                    config.setRoles(getTrimValue(&quot;ROLES&quot;));
                    config.setAliases(getTrimValue(&quot;ALIASES&quot;));
                    config.setOthers(getTrimValue(&quot;OTHER&quot;));
                    try {
                        config.update();
                        extraInformation = Messages.getString(&quot;HttpSslHandler.41&quot;); //$NON-NLS-1$
                    } catch (WaarpDatabaseException e) {
                        extraInformation = Messages.getString(&quot;HttpSslHandler.43&quot;); //$NON-NLS-1$
                    }
                }
            }
        }
        String system = REQUEST.System.read(this);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\gateway\kernel\exec\JavaExecutorWaarpFtp4jClient.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/gateway/kernel/exec/JavaExecutorWaarpFtp4jClient.html#100">100</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\context\task\FtpTransferTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/FtpTransferTask.html#106">106</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            logger.error(&quot;Not enough arguments&quot;);
            return;
        }
        String filepath = null;
        String filename = null;
        String requested = null;
        int port = 21;
        String user = null;
        String pwd = null;
        String acct = null;
        boolean isPassive = true;
        int ssl = 0; // -1 native, 1 auth
        String cwd = null;
        int digest = 0; // 1 CRC, 2 MD5, 3 SHA1
        String command = null;
        int codeCommand = 0; // -1 get, 1 put, 2 append
        String preArgs = null;
        String postArgs = null;
        /*
         * &quot;-file filepath &lt;br&gt; -to requestedHost &lt;br&gt; -port port &lt;br&gt; -user user &lt;br&gt; -pwd pwd &lt;br&gt;
         * [-account account] &lt;br&gt; [-mode active/passive] &lt;br&gt; [-ssl no/implicit/explicit]&lt;br&gt; [-cwd
         * remotepath] &lt;br&gt; [-digest (crc,md5,sha1)] &lt;br&gt; [-pre extraCommand1 with ',' as separator
         * of arguments] &lt;br&gt; -command command from (get,put,append) &lt;br&gt; [-post extraCommand2 with
         * ',' as separator of arguments]&quot; &lt;br&gt;
         */
        for (int i = 0; i &lt; args.length; i++) {
            if (args[i].equalsIgnoreCase(&quot;-file&quot;)) {
                i++;
                filepath = args[i];
                filename = new File(filepath).getName();
            } else if (args[i].equalsIgnoreCase(&quot;-to&quot;)) {
                i++;
                requested = args[i];
            } else if (args[i].equalsIgnoreCase(&quot;-port&quot;)) {
                i++;
                port = Integer.parseInt(args[i]);
            } else if (args[i].equalsIgnoreCase(&quot;-user&quot;)) {
                i++;
                user = args[i];
            } else if (args[i].equalsIgnoreCase(&quot;-pwd&quot;)) {
                i++;
                pwd = args[i];
            } else if (args[i].equalsIgnoreCase(&quot;-account&quot;)) {
                i++;
                acct = args[i];
            } else if (args[i].equalsIgnoreCase(&quot;-mode&quot;)) {
                i++;
                isPassive = (args[i].equalsIgnoreCase(&quot;passive&quot;));
            } else if (args[i].equalsIgnoreCase(&quot;-ssl&quot;)) {
                i++;
                if (args[i].equalsIgnoreCase(&quot;implicit&quot;)) {
                    ssl = -1;
                } else if (args[i].equalsIgnoreCase(&quot;explicit&quot;)) {
                    ssl = 1;
                } else {
                    ssl = 0;
                }
            } else if (args[i].equalsIgnoreCase(&quot;-cwd&quot;)) {
                i++;
                cwd = args[i];
            } else if (args[i].equalsIgnoreCase(&quot;-digest&quot;)) {
                i++;
                if (args[i].equalsIgnoreCase(&quot;crc&quot;)) {
                    digest = 1;
                } else if (args[i].equalsIgnoreCase(&quot;md5&quot;)) {
                    digest = 2;
                } else if (args[i].equalsIgnoreCase(&quot;sha1&quot;)) {
                    digest = 3;
                } else {
                    digest = 0;
                }
            } else if (args[i].equalsIgnoreCase(&quot;-pre&quot;)) {
                i++;
                preArgs = args[i].replace(',', ' ');
            } else if (args[i].equalsIgnoreCase(&quot;-post&quot;)) {
                i++;
                postArgs = args[i].replace(',', ' ');
            } else if (args[i].equalsIgnoreCase(&quot;-command&quot;)) {
                i++;
                command = args[i];
                // get,put,append,list
                // -1 get, 1 put, 2 append
                if (command.equalsIgnoreCase(&quot;get&quot;)) {
                    codeCommand = -1;
                } else if (command.equalsIgnoreCase(&quot;put&quot;)) {
                    codeCommand = 1;
                } else if (command.equalsIgnoreCase(&quot;append&quot;)) {
                    codeCommand = 2;
                } else {
                    // error
                    codeCommand = 0;
                }
            }
        }
        if (filepath == null || requested == null || port &lt;= 0 || user == null || pwd == null ||
                codeCommand == 0) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#419">419</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#467">467</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#467">467</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            command = &quot;ALTER TABLE &quot; + DbTaskRunner.table + &quot; ALTER COLUMN &quot; +
                    DbTaskRunner.Columns.ORIGINALNAME.name() + &quot; &quot; +
                    DBType.getType(DbTaskRunner.dbTypes[DbTaskRunner.Columns.ORIGINALNAME.ordinal()]) +
                    &quot; NOT NULL &quot;;
            request = new DbRequest(session);
            try {
                System.out.println(&quot;Command: &quot; + command);
                request.query(command);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
        }
        DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                R66Versions.V2_4_25.getVersion());
        return true;
    }

    public boolean needUpgradeDb(DbSession session, String version, boolean tryFix)
            throws WaarpDatabaseNoConnectionException {
        // Check if the database is up to date
        DbRequest request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbHostConfiguration.Columns.HOSTID.name() + &quot; from &quot;
                        + DbHostConfiguration.table +
                        &quot; where &quot; + DbHostConfiguration.Columns.HOSTID + &quot; = '&quot; + Configuration.configuration.getHOST_ID()
                        + &quot;'&quot;);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_13.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_17.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbTaskRunner.Columns.TRANSFERINFO.name() + &quot; from &quot; + DbTaskRunner.table +
                        &quot; where &quot; + DbTaskRunner.Columns.SPECIALID + &quot; = &quot; + DbConstant.ILLEGALVALUE);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_17.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_23.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbHostAuth.Columns.ISACTIVE.name() + &quot; from &quot; + DbHostAuth.table +
                        &quot; where &quot; + DbHostAuth.Columns.PORT + &quot; = &quot; + 0);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_23.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GTVersion1(version, R66Versions.V2_4_25.getVersion())) {
            try {
                if (upgradeDb(session, version)) {
                    DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                            R66Versions.V2_4_25.getVersion());
                } else {
                    return true;
                }
            } finally {
            }
        }
        return false;
    }

}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#406">406</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#425">425</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            DbRequest request = new DbRequest(session);
            try {
                System.out.println(&quot;Command: &quot; + command);
                request.query(command);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
        }
        DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                R66Versions.V2_4_25.getVersion());
        return true;
    }

    public boolean needUpgradeDb(DbSession session, String version, boolean tryFix)
            throws WaarpDatabaseNoConnectionException {
        // Check if the database is up to date
        DbRequest request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbHostConfiguration.Columns.HOSTID.name() + &quot; from &quot;
                        + DbHostConfiguration.table +
                        &quot; where &quot; + DbHostConfiguration.Columns.HOSTID + &quot; = '&quot; + Configuration.configuration.getHOST_ID()
                        + &quot;'&quot;);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_13.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_17.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbTaskRunner.Columns.TRANSFERINFO.name() + &quot; from &quot; + DbTaskRunner.table +
                        &quot; where &quot; + DbTaskRunner.Columns.SPECIALID + &quot; = &quot; + DbConstant.ILLEGALVALUE);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_17.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_23.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbHostAuth.Columns.ISACTIVE.name() + &quot; from &quot; + DbHostAuth.table +
                        &quot; where &quot; + DbHostAuth.Columns.PORT + &quot; = &quot; + 0);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_23.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GTVersion1(version, R66Versions.V2_4_25.getVersion())) {
            try {
                if (upgradeDb(session, version)) {
                    DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                            R66Versions.V2_4_25.getVersion());
                } else {
                    return true;
                }
            } finally {
            }
        }
        return false;
    }

}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#423">423</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#471">471</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#471">471</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#406">406</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#425">425</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            request = new DbRequest(session);
            try {
                System.out.println(&quot;Command: &quot; + command);
                request.query(command);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
        }
        DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                R66Versions.V2_4_25.getVersion());
        return true;
    }

    public boolean needUpgradeDb(DbSession session, String version, boolean tryFix)
            throws WaarpDatabaseNoConnectionException {
        // Check if the database is up to date
        DbRequest request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbHostConfiguration.Columns.HOSTID.name() + &quot; from &quot;
                        + DbHostConfiguration.table +
                        &quot; where &quot; + DbHostConfiguration.Columns.HOSTID + &quot; = '&quot; + Configuration.configuration.getHOST_ID()
                        + &quot;'&quot;);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_13.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_17.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbTaskRunner.Columns.TRANSFERINFO.name() + &quot; from &quot; + DbTaskRunner.table +
                        &quot; where &quot; + DbTaskRunner.Columns.SPECIALID + &quot; = &quot; + DbConstant.ILLEGALVALUE);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_17.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_23.getVersion())) {
            try {
                request = new DbRequest(session);
                request.select(&quot;select &quot; + DbHostAuth.Columns.ISACTIVE.name() + &quot; from &quot; + DbHostAuth.table +
                        &quot; where &quot; + DbHostAuth.Columns.PORT + &quot; = &quot; + 0);
                request.close();
                DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                        R66Versions.V2_4_23.getVersion());
            } catch (WaarpDatabaseSqlException e) {
                return !upgradeDb(session, version);
            } finally {
                if (request != null) {
                    request.close();
                }
            }
        }
        request = null;
        if (PartnerConfiguration.isVersion2GTVersion1(version, R66Versions.V2_4_25.getVersion())) {
            try {
                if (upgradeDb(session, version)) {
                    DbHostConfiguration.updateVersionDb(session, Configuration.configuration.getHOST_ID(),
                            R66Versions.V2_4_25.getVersion());
                } else {
                    return true;
                }
            } finally {
            }
        }
        return false;
    }

}</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1224">1224</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1317">1317</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                }
                int gmode = 0;

                TRANSFERMODE tmode = null;
                if (mode.equals(&quot;send&quot;)) {
                    tmode = RequestPacket.TRANSFERMODE.SENDMODE;
                    gmode = -2;
                } else if (mode.equals(&quot;recv&quot;)) {
                    tmode = RequestPacket.TRANSFERMODE.RECVMODE;
                    gmode = -1;
                } else if (mode.equals(&quot;sendmd5&quot;)) {
                    tmode = RequestPacket.TRANSFERMODE.SENDMD5MODE;
                    gmode = -2;
                } else if (mode.equals(&quot;recvmd5&quot;)) {
                    tmode = RequestPacket.TRANSFERMODE.RECVMD5MODE;
                    gmode = -1;
                } else if (mode.equals(&quot;sendth&quot;)) {
                    tmode = RequestPacket.TRANSFERMODE.SENDTHROUGHMODE;
                    gmode = -2;
                } else if (mode.equals(&quot;recvth&quot;)) {
                    tmode = RequestPacket.TRANSFERMODE.RECVTHROUGHMODE;
                    gmode = -1;
                } else if (mode.equals(&quot;sendthmd5&quot;)) {
                    tmode = RequestPacket.TRANSFERMODE.SENDMD5THROUGHMODE;
                    gmode = -2;
                } else if (mode.equals(&quot;recvthmd5&quot;)) {
                    tmode = RequestPacket.TRANSFERMODE.RECVMD5THROUGHMODE;
                    gmode = -1;
                }
                head = resetOptionRules(head, rule, tmode, gmode);
                logger.debug(&quot;Recv UpdOrInsert: &quot; + rule + &quot;:&quot; + hostids + &quot;:&quot; + tmode.ordinal() + &quot;:&quot; +
                        recvp + &quot;:&quot; + sendp + &quot;:&quot; + archp + &quot;:&quot; + workp + &quot;:&quot; + rpre + &quot;:&quot; + rpost + &quot;:&quot; + rerr + &quot;:&quot;
                        + spre + &quot;:&quot; + spost + &quot;:&quot; + serr);
                DbRule dbrule = new DbRule(dbSession, rule, hostids, tmode.ordinal(),
                        recvp, sendp, archp, workp, rpre, rpost, rerr, spre, spost, serr);
                try {
                    if (&quot;Create&quot;.equalsIgnoreCase(parm)) {
                        dbrule.insert();
                    } else {
                        if (dbrule.exist()) {
                            dbrule.update();
                        } else {
                            dbrule.insert();
                        }
                    }
                } catch (WaarpDatabaseException e) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#397">397</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#475">475</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            if (&quot;Filter&quot;.equalsIgnoreCase(parm) || ! isNotReload) {
                String startid = getTrimValue(&quot;startid&quot;);
                String stopid = getTrimValue(&quot;stopid&quot;);
                if (isNotReload &amp;&amp; startid != null &amp;&amp; stopid == null) {
                    stopid = Long.MAX_VALUE + &quot;&quot;;
                }
                if (isNotReload &amp;&amp; stopid != null &amp;&amp; startid == null) {
                    startid = (DbConstant.ILLEGALVALUE + 1) + &quot;&quot;;
                }
                String start = getValue(&quot;start&quot;);
                String stop = getValue(&quot;stop&quot;);
                String rule = getTrimValue(&quot;rule&quot;);
                String req = getTrimValue(&quot;req&quot;);
                boolean pending, transfer, error, done, all;
                pending = params.containsKey(&quot;pending&quot;);
                transfer = params.containsKey(&quot;transfer&quot;);
                error = params.containsKey(&quot;error&quot;);
                done = params.containsKey(&quot;done&quot;);
                all = params.containsKey(&quot;all&quot;);
                if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
                    all = true;
                } else if (!(pending || transfer || error || done)) {
                    all = true;
                }
                Timestamp tstart = WaarpStringUtils.fixDate(start);
                if (tstart != null) {
                    start = tstart.toString();
                }
                Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
                if (tstop != null) {
                    stop = tstop.toString();
                }
                Long idstart = null;
                head = setDbTaskRunnerJsonData(head, errorText, startid, stopid, tstart, tstop, rule, req, pending, transfer, error, done, all);
                head = resetOptionTransfer(head, startid == null ? (idstart != null ? idstart.toString() : &quot;&quot;)
                        : startid,
                        stopid == null ? &quot;&quot; : stopid, start, stop,
                        rule == null ? &quot;&quot; : rule, req == null ? &quot;&quot; : req,
                        pending, transfer, error, done, all);
            } else {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#784">784</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#897">897</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        String errorMsg = &quot;&quot;;
        String seeAll = checkAuthorizedToSeeAll();
        try {
            getValid =
                    DbTaskRunner.getFilterPrepareStatement(dbSession, 0,// 0 means no limit
                            true, null, null, tstart, tstop, rule, req,
                            pending, transfer, error, done, all, seeAll);
            nbAndSpecialId = DbTaskRunner.writeXMLWriter(getValid, filename);
        } catch (WaarpDatabaseNoConnectionException e1) {
            isexported = false;
            toPurge = false;
            logger.warn(&quot;Export error: {}&quot;, e1.getMessage());
            errorMsg = e1.getMessage();
        } catch (WaarpDatabaseSqlException e1) {
            isexported = false;
            toPurge = false;
            logger.warn(&quot;Export error: {}&quot;, e1.getMessage());
            errorMsg = e1.getMessage();
        } catch (OpenR66ProtocolBusinessException e) {
            isexported = false;
            toPurge = false;
            logger.warn(&quot;Export error: {}&quot;, e.getMessage());
            errorMsg = e.getMessage();
        } finally {
            if (getValid != null) {
                getValid.realClose();
            }
        }
        int purge = 0;
        if (isexported &amp;&amp; nbAndSpecialId != null) {
            if (nbAndSpecialId.nb &lt;= 0) {
                return body.replace(XXXRESULTXXX,
                        Messages.getString(&quot;HttpSslHandler.7&quot;)); //$NON-NLS-1$
            }
            // in case of purge
            if (isexported &amp;&amp; toPurge) {
                // purge with same filter all runners where globallasttep
                // is ALLDONE or ERROR
                // but getting the higher Special first
                String stopId = Long.toString(nbAndSpecialId.higherSpecialId);
                try {
                    purge =
                            DbTaskRunner.purgeLogPrepareStatement(dbSession,
                                    null, stopId, tstart, tstop, rule, req,
                                    pending, transfer, error, done, all);
                } catch (WaarpDatabaseNoConnectionException e) {
                } catch (WaarpDatabaseSqlException e) {
                    logger.warn(&quot;Purge error: {}&quot;, e.getMessage());
                }
            }
        }
        return body
                .replace(
                        XXXRESULTXXX,
                        &quot;Export &quot;
                                + (isexported ? &quot;&lt;B&gt;&quot; + Messages.getString(&quot;HttpSslHandler.8&quot;) + //$NON-NLS-1$</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#2075">2075</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#2095">2095</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                    ctx, Configuration.configuration.getBaseDirectory() + uriRequest,
                    R66SESSION + Configuration.configuration.getHOST_ID());
            return;
        }
        checkSession(ctx.channel());
        if (!authentHttp.isAuthenticated()) {
            logger.debug(&quot;Not Authent: &quot; + uriRequest + &quot;:{}&quot;, authentHttp);
            checkAuthent(ctx);
            return;
        }
        String find = uriRequest;
        if (uriRequest.charAt(0) == '/') {
            find = uriRequest.substring(1);
        }
        REQUEST req = REQUEST.index;
        if (find.length() != 0) {
            find = find.substring(0, find.indexOf(&quot;.&quot;));
            try {
                req = REQUEST.valueOf(find);
            } catch (IllegalArgumentException e1) {
                req = REQUEST.index;
                logger.debug(&quot;NotFound: &quot; + find + &quot;:&quot; + uriRequest);
            }
        }
        switch (req) {
            case CancelRestart:
                if (authentHttp.getAuth().isValidRole(ROLE.TRANSFER)) {
                    responseContent.append(CancelRestart());
                } else {
                    responseContent.append(unallowed(Messages.getString(&quot;HttpSslHandler.CancelRestartUnallowed&quot;)));
                }
                break;
            case Export:
                if (authentHttp.getAuth().isValidRole(ROLE.SYSTEM)) {
                    responseContent.append(Export());
                } else {
                    responseContent.append(unallowed(Messages.getString(&quot;HttpSslHandler.ExportUnallowed&quot;)));
                }
                break;
            case Hosts:
                if (authentHttp.getAuth().isValidRole(ROLE.CONFIGADMIN)) {
                    responseContent.append(Hosts());
                } else {
                    responseContent.append(unallowed(Messages.getString(&quot;HttpSslHandler.HostUnallowed&quot;)));
                }
                break;
            case index:
                responseContent.append(index());
                break;
            case ListingReload:</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#318">318</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#341">341</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        return REQUEST.Logon.read(this);
    }

    private String resetOptionTransfer(String header, String startid, String stopid,
            String start, String stop, String rule, String req,
            boolean pending, boolean transfer, boolean error, boolean done, boolean all) {
        StringBuilder builder = new StringBuilder(header);
        WaarpStringUtils.replace(builder, &quot;XXXSTARTIDXXX&quot;, startid);
        WaarpStringUtils.replace(builder, &quot;XXXSTOPIDXXX&quot;, stopid);
        WaarpStringUtils.replace(builder, &quot;XXXSTARTXXX&quot;, start);
        WaarpStringUtils.replace(builder, &quot;XXXSTOPXXX&quot;, stop);
        WaarpStringUtils.replace(builder, &quot;XXXRULEXXX&quot;, rule);
        WaarpStringUtils.replace(builder, &quot;XXXREQXXX&quot;, req);
        WaarpStringUtils.replace(builder, &quot;XXXPENDXXX&quot;, pending ? &quot;checked&quot; : &quot;&quot;);
        WaarpStringUtils.replace(builder, &quot;XXXTRANSXXX&quot;, transfer ? &quot;checked&quot; : &quot;&quot;);
        WaarpStringUtils.replace(builder, &quot;XXXERRXXX&quot;, error ? &quot;checked&quot; : &quot;&quot;);
        WaarpStringUtils.replace(builder, &quot;XXXDONEXXX&quot;, done ? &quot;checked&quot; : &quot;&quot;);
        WaarpStringUtils.replace(builder, &quot;XXXALLXXX&quot;, all ? &quot;checked&quot; : &quot;&quot;);
        return builder.toString();
    }

    private String checkAuthorizedToSeeAll() {
        boolean seeAll = false;
        if (authentHttp.getAuth().isValidRole(ROLE.CONFIGADMIN)) {
            DbHostConfiguration dbhc;
            try {
                dbhc = new DbHostConfiguration(dbSession, Configuration.configuration.getHOST_ID());
            } catch (WaarpDatabaseException e) {
                return null;
            }
            seeAll = dbhc != null &amp;&amp; dbhc.isSeeAllId(authentHttp.getAuth().getUser());
        }
        if (seeAll) {
            return &quot;*&quot;;
        }
        return null;
    }

    private String setDbTaskRunnerJsonData(String head, String errorText,</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\context\task\ExecMoveTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecMoveTask.html#92">92</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\context\task\ExecOutputTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecOutputTask.html#98">98</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                move(result.getStatus(), result.getResult(), finalname);
                localExecClient.disconnect();
                return;
            } // else continue
        }
        String[] args = finalname.split(&quot; &quot;);
        File exec = new File(args[0]);
        if (exec.isAbsolute()) {
            if (!exec.canExecute()) {
                logger.error(&quot;Exec command is not executable: &quot; + finalname);
                R66Result result = new R66Result(session, false,
                        ErrorCode.CommandNotFound, session.getRunner());
                futureCompletion.setResult(result);
                futureCompletion.cancel();
                return;
            }
        }
        CommandLine commandLine = new CommandLine(args[0]);
        for (int i = 1; i &lt; args.length; i++) {
            commandLine.addArgument(args[i]);
        }
        DefaultExecutor defaultExecutor = new DefaultExecutor();
        PipedInputStream inputStream = new PipedInputStream();
        PipedOutputStream outputStream = null;
        try {
            outputStream = new PipedOutputStream(inputStream);
        } catch (IOException e1) {
            try {
                inputStream.close();
            } catch (IOException e) {
            }
            logger.error(&quot;Exception: &quot; + e1.getMessage() +
                    &quot; Exec in error with &quot; + commandLine.toString(), e1);
            futureCompletion.setFailure(e1);
            return;
        }
        PumpStreamHandler pumpStreamHandler = new PumpStreamHandler(
                outputStream, null);
        defaultExecutor.setStreamHandler(pumpStreamHandler);
        int[] correctValues = {
                0, 1 };
        defaultExecutor.setExitValues(correctValues);
        ExecuteWatchdog watchdog = null;

        if (delay &gt; 0) {
            watchdog = new ExecuteWatchdog(delay);
            defaultExecutor.setWatchdog(watchdog);
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbRule.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbRule.html#465">465</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\data\DbRule.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbRule.html#494">494</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>    protected void setFromArray() throws WaarpDatabaseSqlException {
        ids = (String) allFields[Columns.HOSTIDS.ordinal()].getValue();
        setMode((Integer) allFields[Columns.MODETRANS.ordinal()].getValue());
        recvPath = (String) allFields[Columns.RECVPATH.ordinal()].getValue();
        sendPath = (String) allFields[Columns.SENDPATH.ordinal()].getValue();
        archivePath = (String) allFields[Columns.ARCHIVEPATH.ordinal()]
                .getValue();
        workPath = (String) allFields[Columns.WORKPATH.ordinal()].getValue();
        rpreTasks = (String) allFields[Columns.RPRETASKS.ordinal()].getValue();
        rpostTasks = (String) allFields[Columns.RPOSTTASKS.ordinal()].getValue();
        rerrorTasks = (String) allFields[Columns.RERRORTASKS.ordinal()]
                .getValue();
        spreTasks = (String) allFields[Columns.SPRETASKS.ordinal()].getValue();
        spostTasks = (String) allFields[Columns.SPOSTTASKS.ordinal()].getValue();
        serrorTasks = (String) allFields[Columns.SERRORTASKS.ordinal()]
                .getValue();
        updatedInfo = (Integer) allFields[Columns.UPDATEDINFO.ordinal()]
                .getValue();
        setIdRule((String) allFields[Columns.IDRULE.ordinal()].getValue());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#513">513</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#601">601</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                        pending, transfer, error, done, all);
            } else if (&quot;RestartAll&quot;.equalsIgnoreCase(parm) ||
                    &quot;StopAll&quot;.equalsIgnoreCase(parm) ||
                    &quot;StopCleanAll&quot;.equalsIgnoreCase(parm)) {
                boolean stopcommand = &quot;StopAll&quot;.equalsIgnoreCase(parm) || &quot;StopCleanAll&quot;.equalsIgnoreCase(parm);
                String startid = getTrimValue(&quot;startid&quot;);
                String stopid = getTrimValue(&quot;stopid&quot;);
                String start = getValue(&quot;start&quot;);
                String stop = getValue(&quot;stop&quot;);
                String rule = getTrimValue(&quot;rule&quot;);
                String req = getTrimValue(&quot;req&quot;);
                boolean pending, transfer, error, done, all;
                pending = params.containsKey(&quot;pending&quot;);
                transfer = params.containsKey(&quot;transfer&quot;);
                error = params.containsKey(&quot;error&quot;);
                done = false;
                all = false;
                if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
                    all = true;
                } else if (!(pending || transfer || error || done)) {
                    all = true;
                    pending = true;
                    transfer = true;
                    error = true;
                }
                Timestamp tstart = WaarpStringUtils.fixDate(start);
                if (tstart != null) {
                    start = tstart.toString();
                }
                Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
                if (tstop != null) {
                    stop = tstop.toString();
                }
                head = resetOptionTransfer(head, startid == null ? &quot;&quot; : startid,
                        stopid == null ? &quot;&quot; : stopid, start, stop,
                        rule == null ? &quot;&quot; : rule, req == null ? &quot;&quot; : req,
                        pending, transfer, error, done, all);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\localhandler\TransferActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/TransferActions.html#877">877</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\localhandler\TransferActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/TransferActions.html#944">944</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                session.newState(ENDTRANSFERR);
                try {
                    session.setFinalizeTransfer(true, result);
                } catch (OpenR66RunnerErrorException e) {
                    // TODO
                    session.newState(ERROR);
                    ErrorPacket error = null;
                    if (localChannelReference.getFutureRequest().getResult() != null) {
                        result = localChannelReference.getFutureRequest().getResult();
                        error = new ErrorPacket(
                                &quot;Error while finalizing transfer: &quot; + result.getMessage(),
                                result.getCode().getCode(), ErrorPacket.FORWARDCLOSECODE);
                    } else {
                        error = new ErrorPacket(
                                &quot;Error while finalizing transfer&quot;,
                                ErrorCode.FinalOp.getCode(), ErrorPacket.FORWARDCLOSECODE);
                    }
                    try {
                        ChannelUtils.writeAbstractLocalPacket(localChannelReference, error, true);
                    } catch (OpenR66ProtocolPacketException e1) {
                    }
                    session.setStatus(23);
                    ChannelCloseTimer.closeFutureChannel(channel);
                    return;
                } catch (OpenR66ProtocolSystemException e) {
                    // TODO
                    session.newState(ERROR);
                    ErrorPacket error = null;
                    if (localChannelReference.getFutureRequest().getResult() != null) {
                        result = localChannelReference.getFutureRequest().getResult();
                        error = new ErrorPacket(
                                &quot;Error while finalizing transfer: &quot; + result.getMessage(),
                                result.getCode().getCode(), ErrorPacket.FORWARDCLOSECODE);
                    } else {
                        error = new ErrorPacket(
                                &quot;Error while finalizing transfer&quot;,
                                ErrorCode.FinalOp.getCode(), ErrorPacket.FORWARDCLOSECODE);
                    }
                    try {
                        ChannelUtils.writeAbstractLocalPacket(localChannelReference, error, true);
                    } catch (OpenR66ProtocolPacketException e1) {
                    }
                    session.setStatus(23);
                    ChannelCloseTimer.closeFutureChannel(channel);
                    return;
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#318">318</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#350">350</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#350">350</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            preparedStatement.realClose();
        }
    }

    public boolean upgradeDb(DbSession session, String version) throws WaarpDatabaseNoConnectionException {
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_13.getVersion() + &quot;? &quot; + true);
            String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;
            String primaryKey = &quot; PRIMARY KEY &quot;;
            String notNull = &quot; NOT NULL &quot;;

            // HostConfiguration
            String action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
            DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                    .values();
            for (int i = 0; i &lt; chcolumns.length - 1; i++) {
                action += chcolumns[i].name() +
                        DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                        &quot;, &quot;;
            }
            action += chcolumns[chcolumns.length - 1].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                    primaryKey + &quot;)&quot;;
            System.out.println(action);
            DbRequest request = new DbRequest(session);
            try {
                request.query(action);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
        }
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_17.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_17.getVersion() + &quot;? &quot; + true);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#395">395</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#395">395</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            String parm = parms.get(0);
            boolean isNotReload = ! &quot;Reload&quot;.equalsIgnoreCase(parm);
            if (&quot;Filter&quot;.equalsIgnoreCase(parm) || ! isNotReload) {
                String startid = getTrimValue(&quot;startid&quot;);
                String stopid = getTrimValue(&quot;stopid&quot;);
                if (isNotReload &amp;&amp; startid != null &amp;&amp; stopid == null) {
                    stopid = Long.MAX_VALUE + &quot;&quot;;
                }
                if (isNotReload &amp;&amp; stopid != null &amp;&amp; startid == null) {
                    startid = (DbConstant.ILLEGALVALUE + 1) + &quot;&quot;;
                }
                String start = getValue(&quot;start&quot;);
                String stop = getValue(&quot;stop&quot;);
                String rule = getTrimValue(&quot;rule&quot;);
                String req = getTrimValue(&quot;req&quot;);
                boolean pending, transfer, error, done, all;
                pending = params.containsKey(&quot;pending&quot;);
                transfer = params.containsKey(&quot;transfer&quot;);
                error = params.containsKey(&quot;error&quot;);
                done = params.containsKey(&quot;done&quot;);
                all = params.containsKey(&quot;all&quot;);
                if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
                    all = true;
                } else if (!(pending || transfer || error || done)) {
                    all = true;
                }
                Timestamp tstart = WaarpStringUtils.fixDate(start);
                if (tstart != null) {
                    start = tstart.toString();
                }
                Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
                if (tstop != null) {
                    stop = tstop.toString();
                }
                Long idstart = null;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#394">394</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#513">513</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            body0 = REQUEST.Listing.readBodyHeader();
            String parm = parms.get(0);
            boolean isNotReload = ! &quot;Reload&quot;.equalsIgnoreCase(parm);
            if (&quot;Filter&quot;.equalsIgnoreCase(parm) || ! isNotReload) {
                String startid = getTrimValue(&quot;startid&quot;);
                String stopid = getTrimValue(&quot;stopid&quot;);
                if (isNotReload &amp;&amp; startid != null &amp;&amp; stopid == null) {
                    stopid = Long.MAX_VALUE + &quot;&quot;;
                }
                if (isNotReload &amp;&amp; stopid != null &amp;&amp; startid == null) {
                    startid = (DbConstant.ILLEGALVALUE + 1) + &quot;&quot;;
                }
                String start = getValue(&quot;start&quot;);
                String stop = getValue(&quot;stop&quot;);
                String rule = getTrimValue(&quot;rule&quot;);
                String req = getTrimValue(&quot;req&quot;);
                boolean pending, transfer, error, done, all;
                pending = params.containsKey(&quot;pending&quot;);
                transfer = params.containsKey(&quot;transfer&quot;);
                error = params.containsKey(&quot;error&quot;);
                done = params.containsKey(&quot;done&quot;);
                all = params.containsKey(&quot;all&quot;);
                if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
                    all = true;
                } else if (!(pending || transfer || error || done)) {
                    all = true;
                }
                Timestamp tstart = WaarpStringUtils.fixDate(start);
                if (tstart != null) {
                    start = tstart.toString();
                }
                Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
                if (tstop != null) {
                    stop = tstop.toString();
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#395">395</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#514">514</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            String parm = parms.get(0);
            boolean isNotReload = ! &quot;Reload&quot;.equalsIgnoreCase(parm);
            if (&quot;Filter&quot;.equalsIgnoreCase(parm) || ! isNotReload) {
                String startid = getTrimValue(&quot;startid&quot;);
                String stopid = getTrimValue(&quot;stopid&quot;);
                if (isNotReload &amp;&amp; startid != null &amp;&amp; stopid == null) {
                    stopid = Long.MAX_VALUE + &quot;&quot;;
                }
                if (isNotReload &amp;&amp; stopid != null &amp;&amp; startid == null) {
                    startid = (DbConstant.ILLEGALVALUE + 1) + &quot;&quot;;
                }
                String start = getValue(&quot;start&quot;);
                String stop = getValue(&quot;stop&quot;);
                String rule = getTrimValue(&quot;rule&quot;);
                String req = getTrimValue(&quot;req&quot;);
                boolean pending, transfer, error, done, all;
                pending = params.containsKey(&quot;pending&quot;);
                transfer = params.containsKey(&quot;transfer&quot;);
                error = params.containsKey(&quot;error&quot;);
                done = params.containsKey(&quot;done&quot;);
                all = params.containsKey(&quot;all&quot;);
                if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
                    all = true;
                } else if (!(pending || transfer || error || done)) {
                    all = true;
                }
                Timestamp tstart = WaarpStringUtils.fixDate(start);
                if (tstart != null) {
                    start = tstart.toString();
                }
                Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
                if (tstop != null) {
                    stop = tstop.toString();
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1142">1142</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1235">1235</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    }

    private String resetOptionRules(String header,
            String rule, RequestPacket.TRANSFERMODE mode, int gmode) {
        StringBuilder builder = new StringBuilder(header);
        WaarpStringUtils.replace(builder, &quot;XXXRULEXXX&quot;, rule);
        if (mode != null) {
            switch (mode) {
                case RECVMODE:
                    WaarpStringUtils.replace(builder, &quot;XXXRECVXXX&quot;, &quot;checked&quot;);
                    break;
                case SENDMODE:
                    WaarpStringUtils.replace(builder, &quot;XXXSENDXXX&quot;, &quot;checked&quot;);
                    break;
                case RECVMD5MODE:
                    WaarpStringUtils.replace(builder, &quot;XXXRECVMXXX&quot;, &quot;checked&quot;);
                    break;
                case SENDMD5MODE:
                    WaarpStringUtils.replace(builder, &quot;XXXSENDMXXX&quot;, &quot;checked&quot;);
                    break;
                case RECVTHROUGHMODE:
                    WaarpStringUtils.replace(builder, &quot;XXXRECVTXXX&quot;, &quot;checked&quot;);
                    break;
                case SENDTHROUGHMODE:
                    WaarpStringUtils.replace(builder, &quot;XXXSENDTXXX&quot;, &quot;checked&quot;);
                    break;
                case RECVMD5THROUGHMODE:
                    WaarpStringUtils.replace(builder, &quot;XXXRECVMTXXX&quot;, &quot;checked&quot;);
                    break;
                case SENDMD5THROUGHMODE:
                    WaarpStringUtils.replace(builder, &quot;XXXSENDMTXXX&quot;, &quot;checked&quot;);
                    break;
                case UNKNOWNMODE:
                    break;
                default:
                    break;
            }
        }
        if (gmode == -1) {// All Recv
            WaarpStringUtils.replace(builder, &quot;XXXARECVXXX&quot;, &quot;checked&quot;);
        } else if (gmode == -2) {// All Send
            WaarpStringUtils.replace(builder, &quot;XXXASENDXXX&quot;, &quot;checked&quot;);
        } else if (gmode == -3) {// All
            WaarpStringUtils.replace(builder, &quot;XXXALLXXX&quot;, &quot;checked&quot;);
        }
        return builder.toString();
    }

    private String Rules() {
        getParams();
        String head = REQUEST.Rules.read(this);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#738">738</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#852">852</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        String body = REQUEST.Export.read(this);
        String start = getValue(&quot;start&quot;);
        String stop = getValue(&quot;stop&quot;);
        String rule = getTrimValue(&quot;rule&quot;);
        String req = getTrimValue(&quot;req&quot;);
        boolean pending, transfer, error, done, all;
        pending = params.containsKey(&quot;pending&quot;);
        transfer = params.containsKey(&quot;transfer&quot;);
        error = params.containsKey(&quot;error&quot;);
        done = params.containsKey(&quot;done&quot;);
        all = params.containsKey(&quot;all&quot;);
        boolean toPurge = params.containsKey(&quot;purge&quot;);
        if (toPurge) {
            transfer = false;
        }
        if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
            all = true;
        } else if (!(pending || transfer || error || done)) {
            all = true;
        }
        Timestamp tstart = WaarpStringUtils.fixDate(start);
        if (tstart != null) {
            start = tstart.toString();
        }
        Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
        if (tstop != null) {
            stop = tstop.toString();
        }
        body = resetOptionTransfer(body, &quot;&quot;, &quot;&quot;, start, stop,
                rule == null ? &quot;&quot; : rule, req == null ? &quot;&quot; : req,
                pending, transfer, error, done, all);
        boolean isexported = true;
        // clean a bit the database before exporting
        try {
            DbTaskRunner.changeFinishedToDone(dbSession);
        } catch (WaarpDatabaseNoConnectionException e2) {
            // should not be
        }
        // create export of log and optionally purge them from database
        DbPreparedStatement getValid = null;
        NbAndSpecialId nbAndSpecialId = null;
        String basename = Configuration.configuration.getArchivePath() + R66Dir.SEPARATOR +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\context\filesystem\R66File.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/filesystem/R66File.html#479">479</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\context\filesystem\R66File.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/filesystem/R66File.html#560">560</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            File newFile = getFileFromPath(path);
            File parentFile = newFile.getParentFile();
            if (parentFile == null) {
                String dir = getFullInDir();
                if (dir != null) {
                    newFile = new File(dir, newFile.getPath());
                    parentFile = newFile.getParentFile();
                }
            }
            if (newFile.exists()) {
                logger.warn(&quot;Target file already exists: &quot;+newFile.getAbsolutePath());
                return false;
            }
            if (newFile.getAbsolutePath().equals(file.getAbsolutePath())) {
                // already in the right position
                isReady = true;
                return true;
            }
            if (parentFile != null &amp;&amp; parentFile.canWrite()) {
                if (!file.renameTo(newFile)) {
                    FileOutputStream fileOutputStream = null;
                    try {
                        try {
                            fileOutputStream = new FileOutputStream(newFile);
                        } catch (FileNotFoundException e) {
                            logger
                                    .warn(&quot;Cannot find file: &quot; + newFile.getName(),
                                            e);
                            return false;
                        }
                        FileChannel fileChannelOut = fileOutputStream.getChannel();
                        if (get(fileChannelOut)) {
                            delete();
                        } else {
                            try {
                                fileChannelOut.close();
                            } catch (IOException e) {
                            }
                            logger.error(&quot;Cannot write file: {}&quot;, newFile);
                            return false;
                        }
                    } finally {
                        if (fileOutputStream != null) {
                            try {
                                fileOutputStream.close();
                            } catch (IOException e) {
                            }
                        }
                    }
                }
                currentFile = getRelativePath(newFile);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#475">475</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#397">397</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            } else if (&quot;Filter&quot;.equalsIgnoreCase(parm) || ! isNotReload) {
                String startid = getTrimValue(&quot;startid&quot;);
                String stopid = getTrimValue(&quot;stopid&quot;);
                if (isNotReload &amp;&amp; startid != null &amp;&amp; stopid == null) {
                    stopid = Long.MAX_VALUE + &quot;&quot;;
                }
                if (isNotReload &amp;&amp; stopid != null &amp;&amp; startid == null) {
                    startid = (DbConstant.ILLEGALVALUE + 1) + &quot;&quot;;
                }
                String start = getValue(&quot;start&quot;);
                String stop = getValue(&quot;stop&quot;);
                String rule = getTrimValue(&quot;rule&quot;);
                String req = getTrimValue(&quot;req&quot;);
                boolean pending, transfer, error, done, all;
                pending = params.containsKey(&quot;pending&quot;);
                transfer = params.containsKey(&quot;transfer&quot;);
                error = params.containsKey(&quot;error&quot;);
                done = params.containsKey(&quot;done&quot;);
                all = params.containsKey(&quot;all&quot;);
                if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
                    all = true;
                } else if (!(pending || transfer || error || done)) {
                    all = true;
                }
                Timestamp tstart = WaarpStringUtils.fixDate(start);
                if (tstart != null) {
                    start = tstart.toString();
                }
                Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
                if (tstop != null) {
                    stop = tstop.toString();
                }
                Long idstart = null;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#475">475</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#516">516</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            } else if (&quot;Filter&quot;.equalsIgnoreCase(parm) || ! isNotReload) {
                String startid = getTrimValue(&quot;startid&quot;);
                String stopid = getTrimValue(&quot;stopid&quot;);
                if (isNotReload &amp;&amp; startid != null &amp;&amp; stopid == null) {
                    stopid = Long.MAX_VALUE + &quot;&quot;;
                }
                if (isNotReload &amp;&amp; stopid != null &amp;&amp; startid == null) {
                    startid = (DbConstant.ILLEGALVALUE + 1) + &quot;&quot;;
                }
                String start = getValue(&quot;start&quot;);
                String stop = getValue(&quot;stop&quot;);
                String rule = getTrimValue(&quot;rule&quot;);
                String req = getTrimValue(&quot;req&quot;);
                boolean pending, transfer, error, done, all;
                pending = params.containsKey(&quot;pending&quot;);
                transfer = params.containsKey(&quot;transfer&quot;);
                error = params.containsKey(&quot;error&quot;);
                done = params.containsKey(&quot;done&quot;);
                all = params.containsKey(&quot;all&quot;);
                if (pending &amp;&amp; transfer &amp;&amp; error &amp;&amp; done) {
                    all = true;
                } else if (!(pending || transfer || error || done)) {
                    all = true;
                }
                Timestamp tstart = WaarpStringUtils.fixDate(start);
                if (tstart != null) {
                    start = tstart.toString();
                }
                Timestamp tstop = WaarpStringUtils.fixDate(stop, tstart);
                if (tstop != null) {
                    stop = tstop.toString();
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#277">277</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#285">285</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        String action = &quot;ALTER SEQUENCE &quot; + DbTaskRunner.fieldseq +
                &quot; RESTART WITH &quot; + newvalue;
        DbRequest request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            e.printStackTrace();
            return;
        } finally {
            request.close();
        }
        System.out.println(action);
    }

    @Override
    public long nextSequence(DbSession dbSession)
            throws WaarpDatabaseNoConnectionException,
            WaarpDatabaseSqlException, WaarpDatabaseNoDataException {
        long result = DbConstant.ILLEGALVALUE;
        String action = &quot;SELECT NEXTVAL('&quot; + DbTaskRunner.fieldseq + &quot;')&quot;;
        DbPreparedStatement preparedStatement = new DbPreparedStatement(
                dbSession);
        try {
            preparedStatement.createPrepareStatement(action);
            // Limit the search
            preparedStatement.executeQuery();
            if (preparedStatement.getNext()) {
                try {
                    result = preparedStatement.getResultSet().getLong(1);
                } catch (SQLException e) {
                    throw new WaarpDatabaseSqlException(e);
                }
                return result;
            } else {
                throw new WaarpDatabaseNoDataException(
                        &quot;No sequence found. Must be initialized first&quot;);
            }
        } finally {
            preparedStatement.realClose();
        }
    }

    public boolean upgradeDb(DbSession session, String version) throws WaarpDatabaseNoConnectionException {
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_13.getVersion() + &quot;? &quot; + true);
            String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2128">2128</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2213">2213</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        Document document = null;
        // Open config file
        try {
            document = new SAXReader().read(filename);
        } catch (DocumentException e) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename, e); //$NON-NLS-1$
            return false;
        }
        if (document == null) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename); //$NON-NLS-1$
            return false;
        }
        configuration = XmlUtil.read(document, configServer);
        hashConfig = new XmlHash(configuration);
        // Now read the configuration
        loadLocale(config);
        if (!loadIdentity(config)) {
            logger.error(&quot;Cannot load Identity&quot;);
            return false;
        }
        if (!loadDatabase(config)) {
            logger.error(&quot;Cannot load Database configuration&quot;);
            return false;
        }
        if (!loadServerParam(config)) {
            logger.error(&quot;Cannot load Server Parameters&quot;);
            return false;
        }
        if (!loadDirectory(config)) {
            logger.error(&quot;Cannot load Directory configuration&quot;);
            return false;
        }
        if (!loadLimit(config, false)) {
            logger.error(&quot;Cannot load Limit configuration&quot;);
            return false;
        }
        if (config.isUseSSL()) {
            if (!loadSsl(config)) {
                logger.error(&quot;Cannot load SSL configuration&quot;);
                return false;
            }
        }
        if (!loadNetworkServer(config)) {
            logger.error(&quot;Cannot load Network configuration&quot;);
            return false;
        }
        if (!DbConstant.admin.isActive()) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\context\task\ExecMoveTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecMoveTask.html#210">210</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\context\task\ExecOutputTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecOutputTask.html#200">200</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                futureCompletion.setFailure(e);
                return;
            }
        } catch (IOException e) {
            try {
                outputStream.close();
            } catch (IOException e1) {
            }
            thread.interrupt();
            try {
                inputStream.close();
            } catch (IOException e1) {
            }
            try {
                pumpStreamHandler.stop();
            } catch (IOException e2) {
            }
            logger.error(&quot;IOException: &quot; + e.getMessage() +
                    &quot; . Exec in error with &quot; + commandLine.toString());
            futureCompletion.setFailure(e);
            return;
        }
        try {
            outputStream.flush();
        } catch (IOException e) {
        }
        try {
            outputStream.close();
        } catch (IOException e) {
        }
        try {
            pumpStreamHandler.stop();
        } catch (IOException e2) {
        }
        try {
            if (delay &gt; 0) {
                thread.join(delay);
            } else {
                thread.join();
            }
        } catch (InterruptedException e) {
            Thread.currentThread().interrupt();
        }
        try {
            inputStream.close();
        } catch (IOException e1) {
        }
        String newname = null;
        if (defaultExecutor.isFailure(status) &amp;&amp; watchdog != null &amp;&amp;
                watchdog.killedProcess()) {
            // kill by the watchdoc (time out)
            status = -1;
            newname = &quot;TimeOut&quot;;
        } else {
            newname = lastLineReader.getLastLine();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1681">1681</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1744">1744</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            fillHostIds(builder);
            return builder.toString();
        }
        String extraInformation = null;
        if (params.containsKey(&quot;ACTION&quot;)) {
            List&lt;String&gt; action = params.get(&quot;ACTION&quot;);
            for (String act : action) {
                if (act.equalsIgnoreCase(&quot;Language&quot;)) {
                    lang = getTrimValue(&quot;change&quot;);
                    String sys = getTrimValue(&quot;changesys&quot;);
                    Messages.init(new Locale(sys));
                    extraInformation = Messages.getString(&quot;HttpSslHandler.LangIs&quot;) + &quot;Web: &quot; + lang + &quot; OpenR66: &quot; + Messages.getSlocale(); //$NON-NLS-1$
                } else if (act.equalsIgnoreCase(&quot;Level&quot;)) {
                    String loglevel = getTrimValue(&quot;loglevel&quot;);
                    WaarpLogLevel level = WaarpLogLevel.WARN;
                    if (loglevel.equalsIgnoreCase(&quot;debug&quot;)) {
                        level = WaarpLogLevel.DEBUG;
                    } else if (loglevel.equalsIgnoreCase(&quot;info&quot;)) {
                        level = WaarpLogLevel.INFO;
                    } else if (loglevel.equalsIgnoreCase(&quot;warn&quot;)) {
                        level = WaarpLogLevel.WARN;
                    } else if (loglevel.equalsIgnoreCase(&quot;error&quot;)) {
                        level = WaarpLogLevel.ERROR;
                    }
                    WaarpLoggerFactory.setLogLevel(level);
                    extraInformation = Messages.getString(&quot;HttpSslHandler.LangIs&quot;) + level.name(); //$NON-NLS-1$
                } else if (act.equalsIgnoreCase(&quot;ExportConfig&quot;)) {
                    String base = Configuration.configuration.getBaseDirectory() + R66Dir.SEPARATOR;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbConfigurationR66RestMethodHandler.html#187">187</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostConfigurationR66RestMethodHandler.html#206">206</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            node3.put(DbConfiguration.Columns.HOSTID.name(), &quot;HostId as VARCHAR in URI as &quot; + this.path + &quot;/id&quot;);
            node2 = RestArgument.fillDetailedAllow(METHOD.DELETE, this.path + &quot;/id&quot;, COMMAND_TYPE.DELETE.name(),
                    node3, node1);
            node.add(node2);
        }
        if (this.methods.contains(METHOD.POST)) {
            node3 = JsonHandler.createObjectNode();
            for (DbValue dbValue : values) {
                node3.put(dbValue.getColumn(), dbValue.getType());
            }
            node2 = RestArgument.fillDetailedAllow(METHOD.POST, this.path, COMMAND_TYPE.CREATE.name(),
                    node3, node1);
            node.add(node2);
        }
        node2 = RestArgument.fillDetailedAllow(METHOD.OPTIONS, this.path, COMMAND_TYPE.OPTIONS.name(), null, null);
        node.add(node2);

        return node;
    }

    @Override
    public String getPrimaryPropertyName() {
        return Columns.HOSTID.name();
    }

    @Override
    protected void put(HttpRestHandler handler, RestArgument arguments, RestArgument result,
            Object body) throws HttpIncorrectRequestException, HttpInvalidAuthenticationException,
            HttpNotFoundRequestException {
        super.put(handler, arguments, result, body);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1897">1897</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbHostConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbHostConfiguration.html#526">526</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        XmlValue value = hashConfig.get(DbHostConfiguration.XML_ROLES);
        if (value != null &amp;&amp; (value.getList() != null)) {
            for (XmlValue[] xml : (List&lt;XmlValue[]&gt;) value.getList()) {
                XmlHash subHash = new XmlHash(xml);
                value = subHash.get(DbHostConfiguration.XML_ROLEID);
                if (value == null || (value.isEmpty())) {
                    continue;
                }
                String refHostId = value.getString();
                value = subHash.get(DbHostConfiguration.XML_ROLESET);
                if (value == null || (value.isEmpty())) {
                    continue;
                }
                String roleset = value.getString();
                String[] roles = roleset.split(&quot; |\\|&quot;);
                RoleDefault newrole = new RoleDefault();
                for (String role : roles) {
                    try {
                        RoleDefault.ROLE roletype = RoleDefault.ROLE.valueOf(role.toUpperCase());
                        if (roletype == ROLE.NOACCESS) {
                            // reset
                            newrole.setRole(roletype);
                        } else {
                            newrole.addRole(roletype);
                        }
                    } catch (IllegalArgumentException e) {
                        // ignore
                    }
                }
                logger.info(&quot;New Role: &quot; + refHostId + &quot;:&quot; + newrole);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#326">326</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#339">339</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            String primaryKey = &quot; PRIMARY KEY &quot;;
            String notNull = &quot; NOT NULL &quot;;

            // HostConfiguration
            String action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
            DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                    .values();
            for (int i = 0; i &lt; chcolumns.length - 1; i++) {
                action += chcolumns[i].name() +
                        DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                        &quot;, &quot;;
            }
            action += chcolumns[chcolumns.length - 1].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                    primaryKey + &quot;)&quot;;
            System.out.println(action);
            DbRequest request = new DbRequest(session);
            try {
                request.query(action);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
        }
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_17.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_17.getVersion() + &quot;? &quot; + true);
            String command = &quot;ALTER TABLE &quot; + DbTaskRunner.table + &quot; ADD COLUMN IF NOT EXISTS &quot; +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#358">358</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#358">358</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#339">339</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            String primaryKey = &quot; PRIMARY KEY &quot;;
            String notNull = &quot; NOT NULL &quot;;

            // HostConfiguration
            String action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
            DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                    .values();
            for (int i = 0; i &lt; chcolumns.length - 1; i++) {
                action += chcolumns[i].name() +
                        DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                        &quot;, &quot;;
            }
            action += chcolumns[chcolumns.length - 1].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                    primaryKey + &quot;)&quot;;
            System.out.println(action);
            DbRequest request = new DbRequest(session);
            try {
                request.query(action);
            } catch (WaarpDatabaseSqlException e) {
                e.printStackTrace();
                return false;
            } finally {
                request.close();
            }
        }
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_17.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_17.getVersion() + &quot;? &quot; + true);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2004">2004</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2057">2057</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        Document document = null;
        // Open config file
        try {
            document = new SAXReader().read(filename);
        } catch (DocumentException e) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename, e); //$NON-NLS-1$
            return false;
        }
        if (document == null) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename); //$NON-NLS-1$
            return false;
        }
        configuration = XmlUtil.read(document, configServer);
        hashConfig = new XmlHash(configuration);
        loadLocale(config);
        if (!loadIdentity(config)) {
            logger.error(&quot;Cannot load Identity&quot;);
            return false;
        }
        if (!loadDatabase(config)) {
            logger.error(&quot;Cannot load Database configuration&quot;);
            return false;
        }
        if (!loadDirectory(config)) {
            logger.error(&quot;Cannot load Directory configuration&quot;);
            return false;
        }
        if (!loadLimit(config, false)) {
            logger.error(&quot;Cannot load Limit configuration&quot;);
            return false;
        }
        if (!DbConstant.admin.isActive()) {
            // if no database, must load authentication from file
            if (!loadAuthentication(config)) {
                logger.error(&quot;Cannot load Authentication configuration&quot;);
                return false;
            }
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#432">432</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#550">550</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                DbPreparedStatement preparedStatement = null;
                try {
                    preparedStatement =
                            DbTaskRunner.getFilterPrepareStatement(dbSession, getLIMITROW(), false,
                                    startid, stopid, tstart, tstop, rule, req,
                                    pending, transfer, error, done, all, seeAll);
                    preparedStatement.executeQuery();
                    StringBuilder builder = new StringBuilder();
                    int i = 0;
                    while (preparedStatement.getNext()) {
                        try {
                            i++;
                            DbTaskRunner taskRunner = DbTaskRunner
                                    .getFromStatement(preparedStatement);
                            if (isNotReload) {
                                long specid = taskRunner.getSpecialId();
                                if (idstart == null || idstart &gt; specid) {
                                    idstart = specid;
                                }
                            }
                            LocalChannelReference lcr =
                                    Configuration.configuration.getLocalTransaction().
                                            getFromRequest(taskRunner.getKey());
                            builder.append(taskRunner.toSpecializedHtml(
                                    authentHttp,
                                    body,
                                    lcr != null ? Messages.getString(&quot;HttpSslHandler.Active&quot;) : Messages
                                            .getString(&quot;HttpSslHandler.NotActive&quot;)));
                            if (i &gt; getLIMITROW()) {
                                break;
                            }
                        } catch (WaarpDatabaseException e) {
                            // try to continue if possible
                            logger.warn(&quot;An error occurs while accessing a Runner: {}&quot;,
                                    e.getMessage());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbConfigurationR66RestMethodHandler.html#187">187</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostAuthR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostAuthR66RestMethodHandler.html#192">192</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostConfigurationR66RestMethodHandler.html#206">206</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            node3.put(DbConfiguration.Columns.HOSTID.name(), &quot;HostId as VARCHAR in URI as &quot; + this.path + &quot;/id&quot;);
            node2 = RestArgument.fillDetailedAllow(METHOD.DELETE, this.path + &quot;/id&quot;, COMMAND_TYPE.DELETE.name(),
                    node3, node1);
            node.add(node2);
        }
        if (this.methods.contains(METHOD.POST)) {
            node3 = JsonHandler.createObjectNode();
            for (DbValue dbValue : values) {
                node3.put(dbValue.getColumn(), dbValue.getType());
            }
            node2 = RestArgument.fillDetailedAllow(METHOD.POST, this.path, COMMAND_TYPE.CREATE.name(),
                    node3, node1);
            node.add(node2);
        }
        node2 = RestArgument.fillDetailedAllow(METHOD.OPTIONS, this.path, COMMAND_TYPE.OPTIONS.name(), null, null);
        node.add(node2);

        return node;
    }

    @Override
    public String getPrimaryPropertyName() {
        return Columns.HOSTID.name();
    }

    @Override
    protected void put(HttpRestHandler handler, RestArgument arguments, RestArgument result,</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#228">228</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#241">241</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        } finally {
            request.close();
        }
        // Index Runner
        action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
        for (int i = 0; i &lt; icolumns.length - 1; i++) {
            action += icolumns[i].name() + &quot;, &quot;;
        }
        action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // cptrunner
        action = &quot;CREATE SEQUENCE &quot; + DbTaskRunner.fieldseq +
                &quot; MINVALUE &quot; + (DbConstant.ILLEGALVALUE + 1) +
                &quot; START WITH &quot; + (DbConstant.ILLEGALVALUE + 1);
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\server\ConfigExport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/ConfigExport.html#121">121</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\server\ConfigImport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/ConfigImport.html#160">160</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        }
        SocketAddress socketAddress;
        try {
            socketAddress = dbhost.getSocketAddress();
        } catch (IllegalArgumentException e) {
            logger.error(&quot;Cannot Connect to &quot; + dbhost.getHostid());
            future.setResult(new R66Result(
                    new OpenR66ProtocolNoConnectionException(&quot;Cannot connect to server &quot; + dbhost.getHostid()),
                    null, true, ErrorCode.ConnectionImpossible, null));
            dbhost = null;
            future.setFailure(future.getResult().getException());
            return;
        }
        boolean isSSL = dbhost.isSsl();

        LocalChannelReference localChannelReference = networkTransaction
                .createConnectionWithRetry(socketAddress, isSSL, future);
        socketAddress = null;
        if (localChannelReference == null) {
            logger.error(&quot;Cannot Connect to &quot; + dbhost.getHostid());
            future.setResult(new R66Result(
                    new OpenR66ProtocolNoConnectionException(&quot;Cannot connect to server &quot; + dbhost.getHostid()),
                    null, true, ErrorCode.ConnectionImpossible, null));
            dbhost = null;
            future.setFailure(future.getResult().getException());
            return;
        }
        localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\client\RequestTransfer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/RequestTransfer.html#445">445</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\client\RequestTransfer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/RequestTransfer.html#552">552</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        }

        logger.info(&quot;Try RequestTransfer to &quot; + host.toString());
        SocketAddress socketAddress;
        try {
            socketAddress = host.getSocketAddress();
        } catch (IllegalArgumentException e) {
            logger.debug(&quot;Cannot connect to &quot; + host.toString());
            host = null;
            future.setResult(new R66Result(null, true,
                    ErrorCode.ConnectionImpossible, null));
            future.cancel();
            return ErrorCode.ConnectionImpossible;
        }
        boolean isSSL = host.isSsl();

        LocalChannelReference localChannelReference = networkTransaction
                .createConnectionWithRetry(socketAddress, isSSL, future);
        socketAddress = null;
        if (localChannelReference == null) {
            logger.debug(&quot;Cannot connect to &quot; + host.toString());
            host = null;
            future.setResult(new R66Result(null, true,
                    ErrorCode.ConnectionImpossible, null));
            future.cancel();
            return ErrorCode.ConnectionImpossible;
        }
        boolean useJson = PartnerConfiguration.useJson(host.getHostid());
        logger.debug(&quot;UseJson: &quot; + useJson);
        AbstractLocalPacket packet = null;
        if (useJson) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\server\ConfigExport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/ConfigExport.html#254">254</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\server\ConfigImport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/ConfigImport.html#386">386</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                    logger.error(&quot;COnfigExport in     FAILURE since Host is not found: &quot; + stohost, e);
                    networkTransaction.closeAll();
                    System.exit(10);
                }
            } else {
                stohost = Configuration.configuration.getHOST_SSLID();
            }
            transaction.run();
            future.awaitUninterruptibly();
            long time2 = System.currentTimeMillis();
            long delay = time2 - time1;
            R66Result result = future.getResult();
            if (future.isSuccess()) {
                boolean useJson = PartnerConfiguration.useJson(stohost);
                logger.debug(&quot;UseJson: &quot; + useJson);
                String message = null;
                if (useJson) {
                    message = (result.getOther() != null ? ((JsonCommandPacket) result.getOther()).getRequest() :
                            &quot;no file&quot;);
                } else {
                    message = (result.getOther() != null ? ((ValidPacket) result.getOther()).getSheader() :
                            &quot;no file&quot;);
                }
                if (result.getCode() == ErrorCode.Warning) {
                    logger.warn(&quot;WARNED on files:     &quot; +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\client\RequestTransfer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/RequestTransfer.html#507">507</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\client\RequestTransfer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/RequestTransfer.html#593">593</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        }
        localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);
        try {
            ChannelUtils.writeAbstractLocalPacket(localChannelReference, packet, false);
        } catch (OpenR66ProtocolPacketException e) {
            logger.error(Messages.getString(&quot;RequestTransfer.63&quot;) + host.toString()); //$NON-NLS-1$
            localChannelReference.getLocalChannel().close();
            localChannelReference = null;
            host = null;
            packet = null;
            logger.debug(&quot;Bad Protocol&quot;, e);
            future.setResult(new R66Result(e, null, true,
                    ErrorCode.TransferError, null));
            future.setFailure(e);
            return ErrorCode.Internal;
        }
        packet = null;
        host = null;
        future.awaitUninterruptibly();

        localChannelReference.getLocalChannel().close();
        localChannelReference = null;

        logger.info(&quot;Request done with &quot; + (future.isSuccess() ? &quot;success&quot; : &quot;error&quot;));
        R66Result result = future.getResult();
        if (result != null) {
            return result.getCode();
        }
        return ErrorCode.Internal;
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\server\LogExport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/LogExport.html#172">172</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\server\LogExtendedExport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/LogExtendedExport.html#316">316</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    protected static boolean getParams(String[] args) {
        if (args.length &lt; 1) {
            logger.error(_INFO_ARGS);
            return false;
        }
        if (!FileBasedConfiguration
                .setClientConfigurationFromXml(Configuration.configuration, args[0])) {
            logger.error(_INFO_ARGS);
            return false;
        }
        String ssstart = null;
        String ssstop = null;
        for (int i = 1; i &lt; args.length; i++) {
            if (args[i].equalsIgnoreCase(&quot;-purge&quot;)) {
                spurgeLog = true;
            } else if (args[i].equalsIgnoreCase(&quot;-clean&quot;)) {
                sclean = true;
            } else if (args[i].equalsIgnoreCase(&quot;-start&quot;)) {
                i++;
                ssstart = args[i];
            } else if (args[i].equalsIgnoreCase(&quot;-stop&quot;)) {
                i++;
                ssstop = args[i];
            } else if (args[i].equalsIgnoreCase(&quot;-host&quot;)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#991">991</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1026">1026</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            } else if (&quot;TestConn&quot;.equalsIgnoreCase(parm)) {
                String host = getTrimValue(&quot;host&quot;);
                if (host == null || host.isEmpty()) {
                    errorText = Messages.getString(&quot;HttpSslHandler.17&quot;)
                            + &quot;&lt;/b&gt;&lt;/center&gt;&lt;/p&gt;&quot;;
                    head = resetOptionHosts(head, &quot;&quot;, &quot;&quot;, false, true);
                    head = setDbHostAuthJsonData(head, errorText, host, null, false, true);
                    return head.replace(XXXRESULTXXX, errorText).replace(XXXDATAJSONXXX, &quot;[]&quot;);
                }
                DbHostAuth dbhost;
                try {
                    dbhost = new DbHostAuth(dbSession, host);
                } catch (WaarpDatabaseException e) {
                    errorText = Messages.getString(&quot;HttpSslHandler.17&quot;) + e.getMessage() + &quot;&lt;/b&gt;&lt;/center&gt;&lt;/p&gt;&quot;; //$NON-NLS-1$
                    head = resetOptionHosts(head, &quot;&quot;, &quot;&quot;, false, true);
                    head = setDbHostAuthJsonData(head, errorText, host, null, false, true);
                    return head.replace(XXXRESULTXXX, errorText).replace(XXXDATAJSONXXX, &quot;[]&quot;);
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbConfigurationR66RestMethodHandler.html#187">187</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostAuthR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostAuthR66RestMethodHandler.html#192">192</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostConfigurationR66RestMethodHandler.html#206">206</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbRuleR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbRuleR66RestMethodHandler.html#186">186</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            node3.put(DbConfiguration.Columns.HOSTID.name(), &quot;HostId as VARCHAR in URI as &quot; + this.path + &quot;/id&quot;);
            node2 = RestArgument.fillDetailedAllow(METHOD.DELETE, this.path + &quot;/id&quot;, COMMAND_TYPE.DELETE.name(),
                    node3, node1);
            node.add(node2);
        }
        if (this.methods.contains(METHOD.POST)) {
            node3 = JsonHandler.createObjectNode();
            for (DbValue dbValue : values) {
                node3.put(dbValue.getColumn(), dbValue.getType());
            }
            node2 = RestArgument.fillDetailedAllow(METHOD.POST, this.path, COMMAND_TYPE.CREATE.name(),
                    node3, node1);
            node.add(node2);
        }
        node2 = RestArgument.fillDetailedAllow(METHOD.OPTIONS, this.path, COMMAND_TYPE.OPTIONS.name(), null, null);
        node.add(node2);

        return node;
    }

    @Override
    public String getPrimaryPropertyName() {
        return Columns.HOSTID.name();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbConfigurationR66RestMethodHandler.html#187">187</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostAuthR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostAuthR66RestMethodHandler.html#192">192</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostConfigurationR66RestMethodHandler.html#206">206</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbRuleR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbRuleR66RestMethodHandler.html#186">186</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbTaskRunnerR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbTaskRunnerR66RestMethodHandler.html#262">262</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            node3.put(DbConfiguration.Columns.HOSTID.name(), &quot;HostId as VARCHAR in URI as &quot; + this.path + &quot;/id&quot;);
            node2 = RestArgument.fillDetailedAllow(METHOD.DELETE, this.path + &quot;/id&quot;, COMMAND_TYPE.DELETE.name(),
                    node3, node1);
            node.add(node2);
        }
        if (this.methods.contains(METHOD.POST)) {
            node3 = JsonHandler.createObjectNode();
            for (DbValue dbValue : values) {
                node3.put(dbValue.getColumn(), dbValue.getType());
            }
            node2 = RestArgument.fillDetailedAllow(METHOD.POST, this.path, COMMAND_TYPE.CREATE.name(),
                    node3, node1);
            node.add(node2);
        }
        node2 = RestArgument.fillDetailedAllow(METHOD.OPTIONS, this.path, COMMAND_TYPE.OPTIONS.name(), null, null);
        node.add(node2);

        return node;
    }

    @Override
    public String getPrimaryPropertyName() {
        return Columns.HOSTID.name();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbTaskRunner.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#2024">2024</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\data\DbTaskRunner.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#2064">2064</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            DbSession session, boolean in)
            throws WaarpDatabaseNoConnectionException, WaarpDatabaseSqlException {
        String request = &quot;SELECT COUNT(&quot; + Columns.SPECIALID.name() + &quot;) FROM &quot; + table;
        String requesterd;
        String from = Configuration.configuration.getHOST_ID();
        String sfrom = Configuration.configuration.getHOST_SSLID();
        if (in) {
            requesterd = Columns.REQUESTED.name();
        } else {
            requesterd = Columns.REQUESTER.name();
        }
        if (from != null &amp; sfrom != null) {
            request += &quot; WHERE ((&quot; + requesterd + &quot; = '&quot; +
                    from + &quot;' OR &quot; + requesterd + &quot; = '&quot; + sfrom + &quot;') &quot;;
        } else if (from != null) {
            request += &quot; WHERE (&quot; + requesterd + &quot; = '&quot; + from + &quot;' &quot;;
        } else {
            request += &quot; WHERE (&quot; + requesterd + &quot; = '&quot; + sfrom + &quot;' &quot;;
        }
        request += &quot; AND &quot; + getLimitWhereCondition() + &quot;) &quot;;
        request += &quot; AND &quot; + Columns.STARTTRANS.name() + &quot; &gt;= ? &quot;;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\server\LogExport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/LogExport.html#134">134</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\server\LogExtendedExport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/LogExtendedExport.html#202">202</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                .createConnectionWithRetry(socketAddress, isSSL, future);
        socketAddress = null;
        if (localChannelReference == null) {
            logger.error(&quot;Cannot Connect to &quot; + host.getHostid());
            future.setResult(new R66Result(
                    new OpenR66ProtocolNoConnectionException(&quot;Cannot connect to server &quot; + host.getHostid()),
                    null, true, ErrorCode.ConnectionImpossible, null));
            host = null;
            future.setFailure(future.getResult().getException());
            return;
        }
        localChannelReference.sessionNewState(R66FiniteDualStates.VALIDOTHER);
        try {
            ChannelUtils.writeAbstractLocalPacket(localChannelReference, valid, false);
        } catch (OpenR66ProtocolPacketException e) {
            logger.error(&quot;Bad Protocol&quot;, e);
            localChannelReference.getLocalChannel().close();
            localChannelReference = null;
            host = null;
            valid = null;
            future.setResult(new R66Result(e, null, true,
                    ErrorCode.TransferError, null));
            future.setFailure(e);
            return;
        }
        host = null;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbHostConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbHostConfiguration.html#815">815</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\data\DbHostConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbHostConfiguration.html#915">915</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>    private boolean updateSet(String source, String path, HashSet&lt;String&gt; set) {
        if (source != null &amp;&amp; !source.isEmpty()) {
            Document document = null;
            StringReader reader = null;
            if (source != null &amp;&amp; !source.isEmpty()) {
                try {
                    reader = new StringReader(source);
                    document = new SAXReader().read(reader);
                } catch (DocumentException e) {
                    logger.error(&quot;Unable to read the XML Config &quot; + path + &quot; string: &quot; + source, e);
                    if (reader != null) {
                        reader.close();
                    }
                    return false;
                }
                if (document == null) {
                    logger.error(&quot;Unable to read the XML Config &quot; + path + &quot; string: &quot; + source);
                    if (reader != null) {
                        reader.close();
                    }
                    return false;
                }
                @SuppressWarnings(&quot;unchecked&quot;)
                List&lt;Element&gt; list = document.selectNodes(path);
                for (Element element : list) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#139">139</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#142">142</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#142">142</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#146">146</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#160">160</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        System.out.println(action);
        request = new DbRequest(session);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // hosts
        action = createTableH2 + DbHostAuth.table + &quot;(&quot;;
        DbHostAuth.Columns[] hcolumns = DbHostAuth.Columns.values();
        for (int i = 0; i &lt; hcolumns.length - 1; i++) {
            action += hcolumns[i].name() +
                    DBType.getType(DbHostAuth.dbTypes[i]) + notNull + &quot;, &quot;;
        }
        action += hcolumns[hcolumns.length - 1].name() +
                DBType.getType(DbHostAuth.dbTypes[hcolumns.length - 1]) +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2171">2171</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2264">2264</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            logger.error(&quot;Cannot load Network configuration&quot;);
            return false;
        }
        if (!DbConstant.admin.isActive()) {
            // if no database, must load authentication from file
            if (!loadAuthentication(config)) {
                logger.error(&quot;Cannot load Authentication configuration&quot;);
                return false;
            }
        }
        config.setHOST_AUTH(R66Auth.getServerAuth(
                DbConstant.admin.getSession(), config.getHOST_ID()));
        if (config.getHOST_AUTH() == null &amp;&amp;
                config.isUseNOSSL()) {
            logger.error(&quot;Cannot find Authentication for current host&quot;);
            return false;
        }
        if (config.getHOST_SSLID() != null) {
            config.setHOST_SSLAUTH(R66Auth.getServerAuth(
                    DbConstant.admin.getSession(),
                    config.getHOST_SSLID()));
            if (config.getHOST_SSLAUTH() == null &amp;&amp;
                    config.isUseSSL()) {
                logger.error(&quot;Cannot find SSL Authentication for current host&quot;);
                return false;
            }
        }
        loadBusinessWhiteList(config);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#639">639</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#738">738</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                }
                ErrorCode code = (stop) ?
                        ErrorCode.StoppedTransfer : ErrorCode.CanceledTransfer;
                if (lcr != null) {
                    int rank = taskRunner.getRank();
                    lcr.sessionNewState(R66FiniteDualStates.ERROR);
                    ErrorPacket error = new ErrorPacket(&quot;Transfer &quot; + parm + &quot; &quot; + rank,
                            code.getCode(), ErrorPacket.FORWARDCLOSECODE);
                    try {
                        // XXX ChannelUtils.writeAbstractLocalPacket(lcr, error);
                        // inform local instead of remote
                        ChannelUtils.writeAbstractLocalPacketToLocal(lcr, error);
                    } catch (Exception e) {
                    }
                    result = ErrorCode.CompleteOk;
                } else {
                    // Transfer is not running
                    // But is the database saying the contrary
                    result = ErrorCode.TransferOk;
                    if (taskRunner != null) {
                        if (taskRunner.stopOrCancelRunner(code)) {
                            result = ErrorCode.CompleteOk;
                        }
                    }
                }
                if (taskRunner != null) {
                    if (&quot;CancelClean&quot;.equalsIgnoreCase(parm)) {
                        TransferUtils.cleanOneTransfer(taskRunner, null, authentHttp, null);
                    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2055">2055</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2125">2125</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    public static boolean setConfigurationServerMinimalFromXml(Configuration config, String filename) {
        FileBasedConfiguration.checkDatabase = SystemPropertyUtil.getBoolean(R66SystemProperties.OPENR66_STARTUP_DATABASE_CHECK, false);
        Document document = null;
        // Open config file
        try {
            document = new SAXReader().read(filename);
        } catch (DocumentException e) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename, e); //$NON-NLS-1$
            return false;
        }
        if (document == null) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename); //$NON-NLS-1$
            return false;
        }
        configuration = XmlUtil.read(document, configServer);
        hashConfig = new XmlHash(configuration);
        loadLocale(config);
        if (!loadIdentity(config)) {
            logger.error(&quot;Cannot load Identity&quot;);
            return false;
        }
        if (!loadDatabase(config)) {
            logger.error(&quot;Cannot load Database configuration&quot;);
            return false;
        }
        if (!loadDirectory(config)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\configuration\PartnerConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/configuration/PartnerConfiguration.html#271">271</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\configuration\PartnerConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/configuration/PartnerConfiguration.html#314">314</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    public final static boolean isVersion2GEQVersion1(String version1, String version2) {
        if (version1 == null || version2 == null) {
            return false;
        }
        int major1 = 0;
        int rank1 = 0;
        int subversion1 = 0;
        String[] vals = version1.split(&quot;\\.&quot;);
        major1 = Integer.parseInt(vals[0]);
        rank1 = Integer.parseInt(vals[1]);
        subversion1 = Integer.parseInt(vals[2]);
        int major2 = 0;
        int rank2 = 0;
        int subversion2 = 0;
        vals = version2.split(&quot;\\.&quot;);
        major2 = Integer.parseInt(vals[0]);
        rank2 = Integer.parseInt(vals[1]);
        subversion2 = Integer.parseInt(vals[2]);
        logger.debug(&quot;1: &quot;
                + major1
                + &quot;:&quot;
                + rank1
                + &quot;:&quot;
                + subversion1
                + &quot; &lt;=? &quot;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#1851">1851</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbHostConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbHostConfiguration.html#504">504</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        XmlValue value = hashConfig.get(DbHostConfiguration.XML_ALIASES);
        if (value != null &amp;&amp; (value.getList() != null)) {
            for (XmlValue[] xml : (List&lt;XmlValue[]&gt;) value.getList()) {
                XmlHash subHash = new XmlHash(xml);
                value = subHash.get(DbHostConfiguration.XML_REALID);
                if (value == null || (value.isEmpty())) {
                    continue;
                }
                String refHostId = value.getString();
                value = subHash.get(DbHostConfiguration.XML_ALIASID);
                if (value == null || (value.isEmpty())) {
                    continue;
                }
                String aliasset = value.getString();
                String[] alias = aliasset.split(&quot; |\\|&quot;);
                for (String namealias : alias) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#767">767</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#811">811</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                    body = REQUEST.CancelRestart.readBody();
                    body = taskRunner
                            .toSpecializedHtml(
                                    authentHttp,
                                    body,
                                    lcr != null ? Messages.getString(&quot;HttpSslHandler.Active&quot;) : Messages.getString(&quot;HttpSslHandler.NotActive&quot;)); //$NON-NLS-1$ //$NON-NLS-2$
                    String tstart = taskRunner.getStart().toString();
                    tstart = tstart.substring(0, tstart.length());
                    String tstop = taskRunner.getStop().toString();
                    tstop = tstop.substring(0, tstop.length());
                    head = resetOptionTransfer(head, (taskRunner.getSpecialId() - 1) + &quot;&quot;,
                            (taskRunner.getSpecialId() + 1) + &quot;&quot;, tstart, tstop,
                            taskRunner.getRuleId(), taskRunner.getRequested(),
                            false, false, false, false, true);
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestBandwidthR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestBandwidthR66Handler.html#61">61</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestConfigR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestConfigR66Handler.html#65">65</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    public HttpRestBandwidthR66Handler(RestConfiguration config, METHOD... methods) {
        super(BASEURI, config, METHOD.OPTIONS);
        setIntersectionMethods(methods, METHOD.GET, METHOD.PUT);
    }

    @Override
    public void endParsingRequest(HttpRestHandler handler, RestArgument arguments, RestArgument result, Object body)
            throws HttpIncorrectRequestException, HttpInvalidAuthenticationException {
        logger.debug(&quot;debug: {} ### {}&quot;, arguments, result);
        if (body != null) {
            logger.debug(&quot;Obj: {}&quot;, body);
        }
        handler.setWillClose(false);
        ServerActions serverHandler = ((HttpRestR66Handler) handler).getServerHandler();
        // now action according to body
        JsonPacket json = (JsonPacket) body;
        if (json == null) {
            result.setDetail(&quot;not enough information&quot;);
            setError(handler, result, HttpResponseStatus.BAD_REQUEST);
            return;
        }
        result.getAnswer().put(AbstractDbData.JSON_MODEL, RESTHANDLERS.Bandwidth.name());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestLogR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestLogR66Handler.html#91">91</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\localhandler\ServerActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/ServerActions.html#903">903</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                LogJsonPacket node = (LogJsonPacket) json;
                boolean purge = node.isPurge();
                boolean clean = node.isClean();
                Timestamp start = (node.getStart() == null) ? null :
                        new Timestamp(node.getStart().getTime());
                Timestamp stop = (node.getStop() == null) ? null :
                        new Timestamp(node.getStop().getTime());
                String startid = node.getStartid();
                String stopid = node.getStopid();
                String rule = node.getRule();
                String request = node.getRequest();
                boolean pending = node.isStatuspending();
                boolean transfer = node.isStatustransfer();
                boolean done = node.isStatusdone();
                boolean error = node.isStatuserror();
                boolean isPurge = purge;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2085">2085</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2171">2171</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2264">2264</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            logger.error(&quot;Cannot load Limit configuration&quot;);
            return false;
        }
        if (!DbConstant.admin.isActive()) {
            // if no database, must load authentication from file
            if (!loadAuthentication(config)) {
                logger.error(&quot;Cannot load Authentication configuration&quot;);
                return false;
            }
        }
        config.setHOST_AUTH(R66Auth.getServerAuth(
                DbConstant.admin.getSession(), config.getHOST_ID()));
        if (config.getHOST_AUTH() == null &amp;&amp;
                config.isUseNOSSL()) {
            logger.error(&quot;Cannot find Authentication for current host&quot;);
            return false;
        }
        if (config.getHOST_SSLID() != null) {
            config.setHOST_SSLAUTH(R66Auth.getServerAuth(
                    DbConstant.admin.getSession(),
                    config.getHOST_SSLID()));
            if (config.getHOST_SSLAUTH() == null &amp;&amp;
                    config.isUseSSL()) {
                logger.error(&quot;Cannot find SSL Authentication for current host&quot;);
                return false;
            }
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#533">533</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#550">550</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#567">567</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#599">599</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        String[][] array = rule.getRpreTasksArray();
        if (array != null) {
            for (rank = 0; rank &lt; array.length; rank++) {
                Element task = new DefaultElement(XTASK);
                task.add(newElement(DbRule.TASK_TYPE, array[rank][0]));
                task.add(newElement(DbRule.TASK_PATH, array[rank][1]));
                task.add(newElement(DbRule.TASK_DELAY, array[rank][2]));
                if (array[rank].length &gt; 3) {
                    task.add(newElement(DbRule.TASK_COMMENT, array[rank][3]));
                }
                roottasks.add(task);
            }
        }
        tasks.add(roottasks);
        root.add(tasks);
        tasks = new DefaultElement(XRPOSTTASKS);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#558">558</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#647">647</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                                authentHttp, head, startid, stopid, tstart, tstop, rule, req,
                                pending, transfer, error, seeAll);
                    }
                } else {
                    DbPreparedStatement preparedStatement = null;
                    try {
                        preparedStatement =
                                DbTaskRunner.getFilterPrepareStatement(dbSession, 0, false,
                                        startid, stopid, tstart, tstop, rule, req,
                                        pending, transfer, error, done, all, seeAll);
                        preparedStatement.executeQuery();
                        //int i = 0;
                        while (preparedStatement.getNext()) {
                            try {
                                //i++;
                                DbTaskRunner taskRunner = DbTaskRunner
                                        .getFromStatement(preparedStatement);
                                LocalChannelReference lcr =
                                        Configuration.configuration.getLocalTransaction().
                                                getFromRequest(taskRunner.getKey());
                                R66Result finalResult = TransferUtils.restartTransfer(taskRunner,
                                        lcr);
                                ErrorCode result = finalResult.getCode();
                                ErrorCode last = taskRunner.getErrorInfo();
                                taskRunner.setErrorExecutionStatus(result);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#436">436</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#717">717</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            } else {
                head = resetOptionTransfer(head, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;,
                        false, false, false, false, true);
                head = setDbTaskRunnerJsonData(head, errorText, &quot;&quot;, &quot;&quot;, null, null, &quot;&quot;, &quot;&quot;, false, false, false, false, true);
            }
        } else {
            head = resetOptionTransfer(head, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;,
                    false, false, false, false, true);
            head = setDbTaskRunnerJsonData(head, errorText, &quot;&quot;, &quot;&quot;, null, null, &quot;&quot;, &quot;&quot;, false, false, false, false, true);
        }
        return head.replace(XXXRESULTXXX, errorText).replace(XXXDATAJSONXXX, &quot;[]&quot;);
    }
    private String Listing() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestInformationR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestInformationR66Handler.html#66">66</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestLogR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestLogR66Handler.html#66">66</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>    public HttpRestInformationR66Handler(RestConfiguration config, METHOD... methods) {
        super(BASEURI, config, METHOD.OPTIONS);
        setIntersectionMethods(methods, METHOD.GET);
    }

    @Override
    public void endParsingRequest(HttpRestHandler handler, RestArgument arguments, RestArgument result, Object body)
            throws HttpIncorrectRequestException, HttpInvalidAuthenticationException {
        logger.debug(&quot;debug: {} ### {}&quot;, arguments, result);
        if (body != null) {
            logger.debug(&quot;Obj: {}&quot;, body);
        }
        handler.setWillClose(false);
        ServerActions serverHandler = ((HttpRestR66Handler) handler).getServerHandler();
        // now action according to body
        JsonPacket json = (JsonPacket) body;
        if (json == null) {
            result.setDetail(&quot;not enough information&quot;);
            setError(handler, result, HttpResponseStatus.BAD_REQUEST);
            return;
        }
        result.getAnswer().put(AbstractDbData.JSON_MODEL, RESTHANDLERS.Information.name());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#533">533</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#550">550</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#567">567</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#599">599</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\RuleFileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/RuleFileBasedConfiguration.html#616">616</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        String[][] array = rule.getRpreTasksArray();
        if (array != null) {
            for (rank = 0; rank &lt; array.length; rank++) {
                Element task = new DefaultElement(XTASK);
                task.add(newElement(DbRule.TASK_TYPE, array[rank][0]));
                task.add(newElement(DbRule.TASK_PATH, array[rank][1]));
                task.add(newElement(DbRule.TASK_DELAY, array[rank][2]));
                if (array[rank].length &gt; 3) {
                    task.add(newElement(DbRule.TASK_COMMENT, array[rank][3]));
                }
                roottasks.add(task);
            }
        }
        tasks.add(roottasks);
        root.add(tasks);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\commander\Commander.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/commander/Commander.html#365">365</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\commander\Commander.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/commander/Commander.html#497">497</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                    hostAuth = null;
                }
            } catch (WaarpDatabaseNoConnectionException e) {
                try {
                    DbConstant.admin.getDbModel().validConnection(DbConstant.admin.getSession());
                } catch (WaarpDatabaseNoConnectionException e1) {
                }
                logger.error(&quot;Database No Connection Error: Cannot execute Commander&quot;, e);
                return;
            } catch (WaarpDatabaseSqlException e) {
                try {
                    DbConstant.admin.getDbModel().validConnection(DbConstant.admin.getSession());
                } catch (WaarpDatabaseNoConnectionException e1) {
                }
                logger.error(&quot;Database SQL Error: Cannot execute Commander&quot;, e);
                return;
            } catch (WaarpDatabaseException e) {
                try {
                    DbConstant.admin.getDbModel().validConnection(DbConstant.admin.getSession());
                } catch (WaarpDatabaseNoConnectionException e1) {
                }
                logger.error(&quot;Database Error: Cannot execute Commander&quot;, e);
                return;
            } finally {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#297">297</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#308">308</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        DbPreparedStatement preparedStatement = new DbPreparedStatement(
                dbSession);
        try {
            preparedStatement.createPrepareStatement(action);
            // Limit the search
            preparedStatement.executeQuery();
            if (preparedStatement.getNext()) {
                try {
                    result = preparedStatement.getResultSet().getLong(1);
                } catch (SQLException e) {
                    throw new WaarpDatabaseSqlException(e);
                }
                return result;
            } else {
                throw new WaarpDatabaseNoDataException(
                        &quot;No sequence found. Must be initialized first&quot;);
            }
        } finally {
            preparedStatement.realClose();
        }
    }

    public boolean upgradeDb(DbSession session, String version) throws WaarpDatabaseNoConnectionException {
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_13.getVersion() + &quot;? &quot; + true);
            String createTableH2 = &quot;CREATE TABLE &quot;;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#300">300</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#297">297</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        DbPreparedStatement preparedStatement = new DbPreparedStatement(
                dbSession);
        try {
            preparedStatement.createPrepareStatement(action);
            // Limit the search
            preparedStatement.executeQuery();
            if (preparedStatement.getNext()) {
                try {
                    result = preparedStatement.getResultSet().getLong(1);
                } catch (SQLException e) {
                    throw new WaarpDatabaseSqlException(e);
                }
                return result;
            } else {
                throw new WaarpDatabaseNoDataException(
                        &quot;No sequence found. Must be initialized first&quot;);
            }
        } finally {
            preparedStatement.realClose();
        }
    }

    public boolean upgradeDb(DbSession session, String version) throws WaarpDatabaseNoConnectionException {
        if (PartnerConfiguration.isVersion2GEQVersion1(version, R66Versions.V2_4_13.getVersion())) {
            System.out.println(version + &quot; to &quot; + R66Versions.V2_4_13.getVersion() + &quot;? &quot; + true);
            String createTableH2 = &quot;CREATE TABLE IF NOT EXISTS &quot;;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\commander\Commander.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/commander/Commander.html#260">260</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\commander\Commander.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/commander/Commander.html#367">367</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\commander\Commander.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/commander/Commander.html#499">499</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            } catch (WaarpDatabaseNoConnectionException e) {
                try {
                    DbConstant.admin.getDbModel().validConnection(DbConstant.admin.getSession());
                } catch (WaarpDatabaseNoConnectionException e1) {
                }
                logger.error(&quot;Database No Connection Error: Cannot execute Commander&quot;, e);
                return;
            } catch (WaarpDatabaseSqlException e) {
                try {
                    DbConstant.admin.getDbModel().validConnection(DbConstant.admin.getSession());
                } catch (WaarpDatabaseNoConnectionException e1) {
                }
                logger.error(&quot;Database SQL Error: Cannot execute Commander&quot;, e);
                return;
            } catch (WaarpDatabaseException e) {
                try {
                    DbConstant.admin.getDbModel().validConnection(DbConstant.admin.getSession());
                } catch (WaarpDatabaseNoConnectionException e1) {
                }
                logger.error(&quot;Database Error: Cannot execute Commander&quot;, e);
                return;
            } finally {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\context\task\ExecMoveTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecMoveTask.html#92">92</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\context\task\ExecOutputTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecOutputTask.html#98">98</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\context\task\ExecTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecTask.html#79">79</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                move(result.getStatus(), result.getResult(), finalname);
                localExecClient.disconnect();
                return;
            } // else continue
        }
        String[] args = finalname.split(&quot; &quot;);
        File exec = new File(args[0]);
        if (exec.isAbsolute()) {
            if (!exec.canExecute()) {
                logger.error(&quot;Exec command is not executable: &quot; + finalname);
                R66Result result = new R66Result(session, false,
                        ErrorCode.CommandNotFound, session.getRunner());
                futureCompletion.setResult(result);
                futureCompletion.cancel();
                return;
            }
        }
        CommandLine commandLine = new CommandLine(args[0]);
        for (int i = 1; i &lt; args.length; i++) {
            commandLine.addArgument(args[i]);
        }
        DefaultExecutor defaultExecutor = new DefaultExecutor();</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1105">1105</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1141">1141</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            } else if (&quot;TestConn&quot;.equalsIgnoreCase(parm)) {
                String host = getTrimValue(&quot;host&quot;);
                if (host == null || host.isEmpty()) {
                    body0 = body1 = body = &quot;&quot;;
                    body = Messages.getString(&quot;HttpSslHandler.17&quot;); //$NON-NLS-1$
                    head = resetOptionHosts(head, &quot;&quot;, &quot;&quot;, false, true);
                    return head + body0 + body + body1 + end;
                }
                DbHostAuth dbhost;
                try {
                    dbhost = new DbHostAuth(dbSession, host);
                } catch (WaarpDatabaseException e) {
                    body0 = body1 = body = &quot;&quot;;
                    body = Messages.getString(&quot;HttpSslHandler.17&quot;) + e.getMessage() //$NON-NLS-1$
                            + &quot;&lt;/b&gt;&lt;/center&gt;&lt;/p&gt;&quot;;
                    head = resetOptionHosts(head, &quot;&quot;, &quot;&quot;, false, true);
                    return head + body0 + body + body1 + end;
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\gateway\kernel\exec\JavaExecutorWaarpFtp4jClient.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/gateway/kernel/exec/JavaExecutorWaarpFtp4jClient.html#238">238</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\context\task\FtpTransferTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/FtpTransferTask.html#260">260</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                logger.error(ftpClient.getResult());
                return;
            }
            if (digest &gt; 0) {
                // digest check
                String params = null;
                DigestAlgo algo = null;
                switch (digest) {
                    case 1: // CRC
                        params = &quot;XCRC &quot;;
                        algo = DigestAlgo.CRC32;
                        break;
                    case 2: // MD5
                        params = &quot;XMD5 &quot;;
                        algo = DigestAlgo.MD5;
                        break;
                    case 3: // SHA1
                    default:
                        params = &quot;XSHA1 &quot;;
                        algo = DigestAlgo.SHA1;
                        break;
                }
                params += filename;
                String[] values = ftpClient.executeCommand(params);
                String hashresult = null;
                if (values != null) {
                    values = values[0].split(&quot; &quot;);
                    hashresult = (values.length &gt; 3 ? values[1] : values[0]);
                }
                if (hashresult == null) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#210">210</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#241">241</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    private DbSession dbSession = null;
    /**
     * Does this dbSession is private and so should be closed
     */
    private boolean isPrivateDbSession = false;

    public static String hashStatus() {
        return &quot;HttpSslHandler: [sessions: &quot; + sessions.size() + &quot; dbSessions: &quot; + dbSessions.size() + &quot;] &quot;;
    }

    private String readFileHeader(String filename) {
        String value;
        try {
            value = WaarpStringUtils.readFileException(filename);
        } catch (InvalidArgumentException e) {
            logger.error(&quot;Error while trying to open: &quot; + filename, e);
            return &quot;&quot;;
        } catch (FileTransferException e) {
            logger.error(&quot;Error while trying to read: &quot; + filename, e);
            return &quot;&quot;;
        }
        StringBuilder builder = new StringBuilder(value);
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXLOCALXXX.toString(),
                Integer.toString(
                        Configuration.configuration.getLocalTransaction().
                                getNumberLocalChannel()) + &quot; Thread(&quot; + Thread.activeCount()+&quot;)&quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2003">2003</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2212">2212</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    public static boolean setConfigurationInitDatabase(Configuration config, String filename) {
        Document document = null;
        // Open config file
        try {
            document = new SAXReader().read(filename);
        } catch (DocumentException e) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename, e); //$NON-NLS-1$
            return false;
        }
        if (document == null) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename); //$NON-NLS-1$
            return false;
        }
        configuration = XmlUtil.read(document, configServer);
        hashConfig = new XmlHash(configuration);
        loadLocale(config);
        if (!loadIdentity(config)) {
            logger.error(&quot;Cannot load Identity&quot;);
            return false;
        }
        if (!loadDatabase(config)) {
            logger.error(&quot;Cannot load Database configuration&quot;);
            return false;
        }
        if (!loadDirectory(config)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#133">133</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#328">328</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
        DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                .values();
        for (int i = 0; i &lt; chcolumns.length - 1; i++) {
            action += chcolumns[i].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += chcolumns[chcolumns.length - 1].name() +
                DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                notNull + &quot;,&quot;;
        action += constraint + &quot; hostconf_pk &quot; + primaryKey + &quot;(&quot;
                + chcolumns[chcolumns.length - 1].name() + &quot;))&quot;;
        System.out.println(action);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1495">1495</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1579">1579</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            return spooled.replace(XXXDATAJSONXXX, builder);
        }
    }

    /**
     * Applied current lang to system page
     * 
     * @param builder
     */
    private void langHandle(StringBuilder builder) {
        // i18n: add here any new languages
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXCURLANGENXXX.name(), lang.equalsIgnoreCase(&quot;en&quot;) ? &quot;checked&quot;
                : &quot;&quot;);
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXCURLANGFRXXX.name(), lang.equalsIgnoreCase(&quot;fr&quot;) ? &quot;checked&quot;
                : &quot;&quot;);
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXCURSYSLANGENXXX.name(),
                Messages.getSlocale().equalsIgnoreCase(&quot;en&quot;) ? &quot;checked&quot; : &quot;&quot;);
        WaarpStringUtils.replace(builder, REPLACEMENT.XXXCURSYSLANGFRXXX.name(),
                Messages.getSlocale().equalsIgnoreCase(&quot;fr&quot;) ? &quot;checked&quot; : &quot;&quot;);
    }

    private String SystemLimitedSource() {
        String system = REQUEST.SystemLimited.read(this);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\client\DirectTransfer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/DirectTransfer.html#205">205</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\client\MultipleDirectTransfer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/MultipleDirectTransfer.html#227">227</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                    networkTransaction.closeAll();
                    System.exit(ErrorCode.Unknown.ordinal());
                }
                if (result.getRunner().getErrorInfo() == ErrorCode.Warning) {
                    outputFormat.setValue(FIELDS.status.name(), 1);
                    outputFormat.setValue(FIELDS.statusTxt.name(),
                            Messages.getString(&quot;Transfer.Status&quot;) + Messages.getString(&quot;RequestInformation.Warned&quot;)); //$NON-NLS-1$
                } else {
                    outputFormat.setValue(FIELDS.status.name(), 2);
                    outputFormat.setValue(FIELDS.statusTxt.name(),
                            Messages.getString(&quot;Transfer.Status&quot;) + Messages.getString(&quot;RequestInformation.Failure&quot;)); //$NON-NLS-1$
                }
                outputFormat.setValue(FIELDS.remote.name(), rhost);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#113">113</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#111">111</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    private static final WaarpLogger logger = WaarpLoggerFactory.getLogger(HttpResponsiveSslHandler.class);
    /**
     * Session Management
     */
    private static final ConcurrentHashMap&lt;String, R66Session&gt; sessions = new ConcurrentHashMap&lt;String, R66Session&gt;();
    private static final ConcurrentHashMap&lt;String, DbSession&gt; dbSessions = new ConcurrentHashMap&lt;String, DbSession&gt;();
    private static final Random random = new Random();

    private R66Session authentHttp = new R66Session();

    private FullHttpRequest request;
    private boolean newSession = false;
    private volatile Cookie admin = null;
    private final StringBuilder responseContent = new StringBuilder();
    private String uriRequest;
    private Map&lt;String, List&lt;String&gt;&gt; params;
    private String lang = Messages.getSlocale();
    private boolean forceClose = false;
    private boolean shutdown = false;

    private static final String R66SESSION = &quot;R66SESSION&quot;;
    private static final String I18NEXT = &quot;i18next&quot;;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#366">366</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#861">861</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            String json = DbTaskRunner.getJson(preparedStatement, getLIMITROW());
            return head.replace(XXXDATAJSONXXX, json);
        } catch (WaarpDatabaseException e) {
            if (preparedStatement != null) {
                preparedStatement.realClose();
            }
            logger.warn(&quot;OpenR66 Web Error {}&quot;, e.getMessage());
            errorText += Messages.getString(&quot;ErrorCode.17&quot;)+&quot;: &quot;+e.getMessage()+&quot;&lt;BR/&gt;&quot;;
        } catch (OpenR66ProtocolBusinessException e) {
            if (preparedStatement != null) {
                preparedStatement.realClose();
            }
            logger.warn(&quot;OpenR66 Web Error {}&quot;, e.getMessage());
            errorText += Messages.getString(&quot;ErrorCode.17&quot;)+&quot;: &quot;+e.getMessage()+&quot;&lt;BR/&gt;&quot;;
        }
        return head.replace(XXXRESULTXXX, errorText);
    }
    private String ListingReload() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#841">841</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#954">954</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                                        + Messages.getString(&quot;HttpSslHandler.9&quot;) + nbAndSpecialId.nb + Messages.getString(&quot;HttpSslHandler.10&quot;) + purge //$NON-NLS-1$ //$NON-NLS-2$
                                        + Messages.getString(&quot;HttpSslHandler.11&quot;) + &quot;&lt;/B&gt;&quot; : //$NON-NLS-1$
                                        &quot;&lt;B&gt;&quot; + Messages.getString(&quot;HttpSslHandler.12&quot;))) + &quot;&lt;/B&gt;&quot; + errorMsg; //$NON-NLS-1$
    }

    private String resetOptionHosts(String header,
            String host, String addr, boolean ssl, boolean active) {
        StringBuilder builder = new StringBuilder(header);
        WaarpStringUtils.replace(builder, &quot;XXXFHOSTXXX&quot;, host);
        WaarpStringUtils.replace(builder, &quot;XXXFADDRXXX&quot;, addr);
        WaarpStringUtils.replace(builder, &quot;XXXFSSLXXX&quot;, ssl ? &quot;checked&quot; : &quot;&quot;);
        WaarpStringUtils.replace(builder, &quot;XXXFACTIVXXX&quot;, active ? &quot;checked&quot; : &quot;&quot;);
        return builder.toString();
    }
    private String setDbHostAuthJsonData(String head, String errorText, String host, String addr, boolean ssl, boolean isactive) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\data\DbRule.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbRule.html#574">574</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbRule.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbRule.html#669">669</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        getIdsRule(this.ids);
        setRpreTasksArray(getTasksRule(this.rpreTasks));
        setRpostTasksArray(getTasksRule(this.rpostTasks));
        setRerrorTasksArray(getTasksRule(this.rerrorTasks));
        setSpreTasksArray(getTasksRule(this.spreTasks));
        setSpostTasksArray(getTasksRule(this.spostTasks));
        setSerrorTasksArray(getTasksRule(this.serrorTasks));
        // and reverse
        this.rpreTasks = setTasksRule(getRpreTasksArray());
        this.rpostTasks = setTasksRule(getRpostTasksArray());
        this.rerrorTasks = setTasksRule(getRerrorTasksArray());
        this.spreTasks = setTasksRule(getSpreTasksArray());
        this.spostTasks = setTasksRule(getSpostTasksArray());
        this.serrorTasks = setTasksRule(getSerrorTasksArray());
        setToArray();
        isSaved = false;
    }

    /**
     * @param dbSession
     * @param idRule
     * @throws WaarpDatabaseException
     */
    public DbRule(DbSession dbSession, String idRule) throws WaarpDatabaseException {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1204">1204</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1297">1297</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            String parm = parms.get(0);
            if (&quot;Create&quot;.equalsIgnoreCase(parm) || &quot;Update&quot;.equalsIgnoreCase(parm)) {
                String rule = getTrimValue(&quot;rule&quot;);
                String hostids = getTrimValue(&quot;hostids&quot;);
                String recvp = getTrimValue(&quot;recvp&quot;);
                String sendp = getTrimValue(&quot;sendp&quot;);
                String archp = getTrimValue(&quot;archp&quot;);
                String workp = getTrimValue(&quot;workp&quot;);
                String rpre = getTrimValue(&quot;rpre&quot;);
                String rpost = getTrimValue(&quot;rpost&quot;);
                String rerr = getTrimValue(&quot;rerr&quot;);
                String spre = getTrimValue(&quot;spre&quot;);
                String spost = getTrimValue(&quot;spost&quot;);
                String serr = getTrimValue(&quot;serr&quot;);
                String mode = getTrimValue(&quot;mode&quot;);
                if (rule == null || mode == null) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#2125">2125</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#2142">2142</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                responseContent.append(ListingReload());
                break;
            case Listing:
                responseContent.append(Listing());
                break;
            case Logon:
                responseContent.append(index());
                break;
            case Logout:
                responseContent.append(Logout());
                break;
            case Rules:
                if (authentHttp.getAuth().isValidRole(ROLE.CONFIGADMIN)) {
                    responseContent.append(Rules());
                } else {
                    responseContent.append(unallowed(Messages.getString(&quot;HttpSslHandler.RulesUnallowed&quot;)));
                }
                break;
            case System:
                if (authentHttp.getAuth().isValidRole(ROLE.SYSTEM)) {
                    responseContent.append(System());
                } else {
                    responseContent.append(SystemLimited());
                }
                break;
            case Spooled:</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbConfigurationR66RestMethodHandler.html#159">159</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostAuthR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostAuthR66RestMethodHandler.html#165">165</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostConfigurationR66RestMethodHandler.html#178">178</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                    JsonHandler.createObjectNode().put(DbConfiguration.Columns.HOSTID.name(),
                            &quot;HostId as VARCHAR in URI as &quot; + this.path + &quot;/id&quot;),
                    node1);
            node.add(node2);

            node3 = JsonHandler.createObjectNode();
            for (FILTER_ARGS arg : FILTER_ARGS.values()) {
                node3.put(arg.name(), arg.type);
            }
            node2 = RestArgument.fillDetailedAllow(METHOD.GET, this.path, COMMAND_TYPE.MULTIGET.name(),
                    node3, JsonHandler.createArrayNode().add(node1));
            node.add(node2);
        }
        if (this.methods.contains(METHOD.PUT)) {
            node3 = JsonHandler.createObjectNode();
            node3.put(DbConfiguration.Columns.HOSTID.name(), &quot;HostId as VARCHAR in URI as &quot; + this.path + &quot;/id&quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2004">2004</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2128">2128</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        Document document = null;
        // Open config file
        try {
            document = new SAXReader().read(filename);
        } catch (DocumentException e) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename, e); //$NON-NLS-1$
            return false;
        }
        if (document == null) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename); //$NON-NLS-1$
            return false;
        }
        configuration = XmlUtil.read(document, configServer);
        hashConfig = new XmlHash(configuration);
        loadLocale(config);
        if (!loadIdentity(config)) {
            logger.error(&quot;Cannot load Identity&quot;);
            return false;
        }
        if (!loadDatabase(config)) {
            logger.error(&quot;Cannot load Database configuration&quot;);
            return false;
        }
        if (!loadDirectory(config)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2057">2057</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2213">2213</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        Document document = null;
        // Open config file
        try {
            document = new SAXReader().read(filename);
        } catch (DocumentException e) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename, e); //$NON-NLS-1$
            return false;
        }
        if (document == null) {
            logger.error(Messages.getString(&quot;FileBasedConfiguration.CannotReadXml&quot;) + filename); //$NON-NLS-1$
            return false;
        }
        configuration = XmlUtil.read(document, configServer);
        hashConfig = new XmlHash(configuration);
        loadLocale(config);
        if (!loadIdentity(config)) {
            logger.error(&quot;Cannot load Identity&quot;);
            return false;
        }
        if (!loadDatabase(config)) {
            logger.error(&quot;Cannot load Database configuration&quot;);
            return false;
        }
        if (!loadDirectory(config)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#270">270</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#289">289</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        WaarpStringUtils.replaceAll(builder, REPLACEMENT.XXXLANGXXX.toString(), lang);
        return builder.toString();
    }

    private String getTrimValue(String varname) {
        List&lt;String&gt; varlist = params.get(varname);
        if (varlist != null &amp;&amp; !varlist.isEmpty()) {
            String value = params.get(varname).get(0).trim();
            if (value.isEmpty()) {
                value = null;
            }
            return value;
        }
        return null;
    }

    private String getValue(String varname) {
        return params.get(varname).get(0);
    }

    private String index() {
        String index = REQUEST.index.read(this);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestBusinessR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestBusinessR66Handler.html#69">69</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestControlR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestControlR66Handler.html#78">78</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        setIntersectionMethods(methods, METHOD.GET);
    }

    @Override
    public void endParsingRequest(HttpRestHandler handler, RestArgument arguments, RestArgument result, Object body)
            throws HttpIncorrectRequestException, HttpInvalidAuthenticationException {
        logger.debug(&quot;debug: {} ### {}&quot;, arguments, result);
        if (body != null) {
            logger.debug(&quot;Obj: {}&quot;, body);
        }
        handler.setWillClose(false);
        ServerActions serverHandler = ((HttpRestR66Handler) handler).getServerHandler();
        R66Session session = serverHandler.getSession();
        // now action according to body
        JsonPacket json = (JsonPacket) body;
        if (json == null) {
            result.setDetail(&quot;not enough information&quot;);
            setError(handler, result, HttpResponseStatus.BAD_REQUEST);
            return;
        }
        result.getAnswer().put(AbstractDbData.JSON_MODEL, RESTHANDLERS.Business.name());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\client\DirectTransfer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/DirectTransfer.html#161">161</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\client\MultipleDirectTransfer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/MultipleDirectTransfer.html#182">182</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            OutputFormat outputFormat = new OutputFormat(DirectTransfer.class.getSimpleName(), args);
            if (future.isSuccess()) {
                if (result.getRunner().getErrorInfo() == ErrorCode.Warning) {
                    outputFormat.setValue(FIELDS.status.name(), 1);
                    outputFormat.setValue(FIELDS.statusTxt.name(),
                            Messages.getString(&quot;Transfer.Status&quot;) + Messages.getString(&quot;RequestInformation.Warned&quot;)); //$NON-NLS-1$
                } else {
                    outputFormat.setValue(FIELDS.status.name(), 0);
                    outputFormat.setValue(FIELDS.statusTxt.name(),
                            Messages.getString(&quot;Transfer.Status&quot;) + Messages.getString(&quot;RequestInformation.Success&quot;)); //$NON-NLS-1$
                }
                outputFormat.setValue(FIELDS.remote.name(), rhost);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\localhandler\TransferActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/TransferActions.html#880">880</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\localhandler\TransferActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/TransferActions.html#901">901</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\localhandler\TransferActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/TransferActions.html#947">947</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\localhandler\TransferActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/TransferActions.html#968">968</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                } catch (OpenR66RunnerErrorException e) {
                    // TODO
                    session.newState(ERROR);
                    ErrorPacket error = null;
                    if (localChannelReference.getFutureRequest().getResult() != null) {
                        result = localChannelReference.getFutureRequest().getResult();
                        error = new ErrorPacket(
                                &quot;Error while finalizing transfer: &quot; + result.getMessage(),
                                result.getCode().getCode(), ErrorPacket.FORWARDCLOSECODE);
                    } else {
                        error = new ErrorPacket(
                                &quot;Error while finalizing transfer&quot;,
                                ErrorCode.FinalOp.getCode(), ErrorPacket.FORWARDCLOSECODE);
                    }
                    try {
                        ChannelUtils.writeAbstractLocalPacket(localChannelReference, error, true);
                    } catch (OpenR66ProtocolPacketException e1) {
                    }
                    session.setStatus(23);
                    ChannelCloseTimer.closeFutureChannel(channel);
                    return;
                } catch (OpenR66ProtocolSystemException e) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbConfiguration.html#375">375</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\data\DbHostConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbHostConfiguration.html#699">699</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        DbConfiguration dbConfiguration = new DbConfiguration(preparedStatement.getDbSession());
        dbConfiguration.getValues(preparedStatement, dbConfiguration.allFields);
        dbConfiguration.setFromArray();
        dbConfiguration.isSaved = true;
        return dbConfiguration;
    }

    /**
     * 
     * @return the DbPreparedStatement for getting Updated Object
     * @throws WaarpDatabaseNoConnectionException
     * @throws WaarpDatabaseSqlException
     */
    public static DbPreparedStatement getUpdatedPrepareStament(DbSession session)
            throws WaarpDatabaseNoConnectionException, WaarpDatabaseSqlException {
        String request = &quot;SELECT &quot; + selectAllFields;
        request += &quot; FROM &quot; + table +
                &quot; WHERE &quot; + Columns.UPDATEDINFO.name() + &quot; = &quot; +
                AbstractDbData.UpdatedInfo.TOSUBMIT.ordinal() +
                &quot; AND &quot; + Columns.HOSTID.name() + &quot; = '&quot; + Configuration.configuration.getHOST_ID()
                + &quot;'&quot;;
        DbPreparedStatement prep = new DbPreparedStatement(session, request);
        return prep;
    }

    /**
     * 
     * @param session
     * @param hostid
     * @param limitBandwith
     *            0 for no limit, &gt; 0 for one limit, &lt; 0 for no filter
     * @return the preparedStatement with the filter
     * @throws WaarpDatabaseNoConnectionException
     * @throws WaarpDatabaseSqlException
     */
    public static DbPreparedStatement getFilterPrepareStament(DbSession session,
            String hostid, long limitBandwith)</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#223">223</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#223">223</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#228">228</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        } finally {
            request.close();
        }
        // Index Runner
        action = &quot;CREATE INDEX IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
        for (int i = 0; i &lt; icolumns.length - 1; i++) {
            action += icolumns[i].name() + &quot;, &quot;;
        }
        action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // cptrunner
        /*
         * # Table to handle any number of sequences: CREATE TABLE Sequences ( name VARCHAR(22) NOT
         * NULL, seq INT UNSIGNED NOT NULL, # (or BIGINT) PRIMARY KEY name ); # Create a Sequence:
         * INSERT INTO Sequences (name, seq) VALUES (?, 0); # Drop a Sequence: DELETE FROM Sequences
         * WHERE name = ?; # Get a sequence number: UPDATE Sequences SET seq = LAST_INSERT_ID(seq +
         * 1) WHERE name = ?; $seq = $db-&gt;LastInsertId();
         */
        action = &quot;CREATE TABLE Sequences (name VARCHAR(22) NOT NULL PRIMARY KEY,&quot; +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#366">366</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#861">861</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1126">1126</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            String json = DbTaskRunner.getJson(preparedStatement, getLIMITROW());
            return head.replace(XXXDATAJSONXXX, json);
        } catch (WaarpDatabaseException e) {
            if (preparedStatement != null) {
                preparedStatement.realClose();
            }
            logger.warn(&quot;OpenR66 Web Error {}&quot;, e.getMessage());
            errorText += Messages.getString(&quot;ErrorCode.17&quot;)+&quot;: &quot;+e.getMessage()+&quot;&lt;BR/&gt;&quot;;
        } catch (OpenR66ProtocolBusinessException e) {
            if (preparedStatement != null) {
                preparedStatement.realClose();
            }
            logger.warn(&quot;OpenR66 Web Error {}&quot;, e.getMessage());
            errorText += Messages.getString(&quot;ErrorCode.17&quot;)+&quot;: &quot;+e.getMessage()+&quot;&lt;BR/&gt;&quot;;
        }
        return head.replace(XXXRESULTXXX, errorText);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\client\Message.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/Message.html#145">145</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\client\RequestInformation.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/RequestInformation.html#185">185</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            logger.debug(Messages.getString(&quot;Message.HostNotFound&quot;) + requested); //$NON-NLS-1$
            R66Result result = new R66Result(null, true, ErrorCode.ConnectionImpossible, null);
            this.future.setResult(result);
            this.future.cancel();
            return;
        }
        if (host.isClient()) {
            logger.error(Messages.getString(&quot;Message.HostIsClient&quot;) + requested); //$NON-NLS-1$
            R66Result result = new R66Result(null, true, ErrorCode.ConnectionImpossible, null);
            this.future.setResult(result);
            this.future.cancel();
            return;
        }
        SocketAddress socketAddress = host.getSocketAddress();
        boolean isSSL = host.isSsl();
        LocalChannelReference localChannelReference = null;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2362">2362</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\configuration\FileBasedConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/configuration/FileBasedConfiguration.html#2426">2426</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        }
        config.setHOST_AUTH(R66Auth.getServerAuth(
                DbConstant.admin.getSession(), config.getHOST_ID()));
        if (config.getHOST_AUTH() == null) {
            logger.error(&quot;Cannot find Authentication for current host&quot;);
            return false;
        }
        if (config.getHOST_SSLID() != null) {
            config.setHOST_SSLAUTH(R66Auth.getServerAuth(
                    DbConstant.admin.getSession(),
                    config.getHOST_SSLID()));
            if (config.getHOST_SSLAUTH() == null) {
                logger.error(&quot;Cannot find SSL Authentication for current host&quot;);
                return false;
            }
        }
        loadBusinessWhiteList(config);
        hashConfig.clear();
        hashConfig = null;
        configuration = null;
        return true;
    }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#984">984</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1059">1059</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            if (&quot;Create&quot;.equalsIgnoreCase(parm)) {
                String host = getTrimValue(&quot;host&quot;);
                String addr = getTrimValue(&quot;address&quot;);
                String port = getTrimValue(&quot;port&quot;);
                String key = getTrimValue(&quot;hostkey&quot;);
                boolean ssl, admin, isclient, isactive, isproxified;
                ssl = params.containsKey(&quot;ssl&quot;);
                admin = params.containsKey(&quot;admin&quot;);
                isclient = params.containsKey(&quot;isclient&quot;);
                isactive = params.containsKey(&quot;isactive&quot;);
                isproxified = params.containsKey(&quot;isproxified&quot;);
                if (host == null || addr == null || port == null || key == null) {
                    body0 = body1 = body = &quot;&quot;;
                    body = Messages.getString(&quot;HttpSslHandler.13&quot;); //$NON-NLS-1$</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbConfigurationR66RestMethodHandler.html#160">160</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostAuthR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostAuthR66RestMethodHandler.html#166">166</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostConfigurationR66RestMethodHandler.html#179">179</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbRuleR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbRuleR66RestMethodHandler.html#160">160</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                            &quot;HostId as VARCHAR in URI as &quot; + this.path + &quot;/id&quot;),
                    node1);
            node.add(node2);

            node3 = JsonHandler.createObjectNode();
            for (FILTER_ARGS arg : FILTER_ARGS.values()) {
                node3.put(arg.name(), arg.type);
            }
            node2 = RestArgument.fillDetailedAllow(METHOD.GET, this.path, COMMAND_TYPE.MULTIGET.name(),
                    node3, JsonHandler.createArrayNode().add(node1));
            node.add(node2);
        }
        if (this.methods.contains(METHOD.PUT)) {
            node3 = JsonHandler.createObjectNode();
            node3.put(DbConfiguration.Columns.HOSTID.name(), &quot;HostId as VARCHAR in URI as &quot; + this.path + &quot;/id&quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestControlR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestControlR66Handler.html#166">166</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestInformationR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestInformationR66Handler.html#121">121</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                    result.setDetail(&quot;New Transfer cannot be registered&quot;);
                    setError(handler, result, HttpResponseStatus.NOT_ACCEPTABLE);
                }
            } else {
                logger.info(&quot;Validation is ignored: &quot; + json);
                result.setDetail(&quot;Unknown command&quot;);
                setError(handler, result, json, HttpResponseStatus.PRECONDITION_FAILED);
            }
        } catch (OpenR66ProtocolNotAuthenticatedException e) {
            throw new HttpInvalidAuthenticationException(e);
        } catch (OpenR66ProtocolPacketException e) {
            throw new HttpIncorrectRequestException(e);
        } catch (OpenR66ProtocolNoDataException e) {
            throw new HttpIncorrectRequestException(e);
        }
    }

    protected ArrayNode getDetailedAllow() {
        ArrayNode node = JsonHandler.createArrayNode();

        if (this.methods.contains(METHOD.GET)) {
            InformationJsonPacket node3 = new InformationJsonPacket(Long.MIN_VALUE, false, &quot;remoteHost&quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbTaskRunner.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#4132">4132</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\data\DbTaskRunner.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbTaskRunner.html#4372">4372</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        } catch (FileNotFoundException e) {
            logger.error(&quot;Cannot write XML file&quot;, e);
            throw new OpenR66ProtocolBusinessException(&quot;File not found&quot;);
        } catch (UnsupportedEncodingException e) {
            logger.error(&quot;Cannot write XML file&quot;, e);
            throw new OpenR66ProtocolBusinessException(&quot;Unsupported Encoding&quot;);
        } finally {
            if (xmlWriter != null) {
                try {
                    xmlWriter.endDocument();
                    xmlWriter.flush();
                    xmlWriter.close();
                } catch (SAXException e) {
                    try {
                        outputStream.close();
                    } catch (IOException e2) {
                    }
                    File file = new File(filename);
                    file.delete();
                    logger.error(&quot;Cannot write XML file&quot;, e);
                    throw new OpenR66ProtocolBusinessException(&quot;Unsupported Encoding&quot;);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestBandwidthR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestBandwidthR66Handler.html#63">63</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestConfigR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestConfigR66Handler.html#67">67</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestInformationR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestInformationR66Handler.html#68">68</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestLogR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestLogR66Handler.html#68">68</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        setIntersectionMethods(methods, METHOD.GET, METHOD.PUT);
    }

    @Override
    public void endParsingRequest(HttpRestHandler handler, RestArgument arguments, RestArgument result, Object body)
            throws HttpIncorrectRequestException, HttpInvalidAuthenticationException {
        logger.debug(&quot;debug: {} ### {}&quot;, arguments, result);
        if (body != null) {
            logger.debug(&quot;Obj: {}&quot;, body);
        }
        handler.setWillClose(false);
        ServerActions serverHandler = ((HttpRestR66Handler) handler).getServerHandler();
        // now action according to body
        JsonPacket json = (JsonPacket) body;
        if (json == null) {
            result.setDetail(&quot;not enough information&quot;);
            setError(handler, result, HttpResponseStatus.BAD_REQUEST);
            return;
        }
        result.getAnswer().put(AbstractDbData.JSON_MODEL, RESTHANDLERS.Bandwidth.name());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\localhandler\ServerActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/ServerActions.html#467">467</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\localhandler\ServerActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/ServerActions.html#1177">1177</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            case LocalPacketFactory.CONFIMPORTPACKET: {
                session.newState(VALIDOTHER);
                // Authentication must be the local server or CONFIGADMIN authorization
                try {
                    if (!session.getAuth().getUser().equals(
                            Configuration.configuration.getHostId(session.getAuth().isSsl())) &amp;&amp;
                            !session.getAuth().isValidRole(ROLE.CONFIGADMIN)) {
                        throw new OpenR66ProtocolNotAuthenticatedException(
                                &quot;Not correctly authenticated&quot;);
                    }
                } catch (OpenR66ProtocolNoSslException e1) {
                    throw new OpenR66ProtocolNotAuthenticatedException(
                            &quot;Not correctly authenticated since SSL is not supported&quot;, e1);
                }
                if (Configuration.configuration.getR66Mib() != null) {
                    Configuration.configuration.getR66Mib().notifyWarning(
                            &quot;Import Configuration Order received&quot;, session.getAuth().getUser());
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\server\ChangeBandwidthLimits.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/ChangeBandwidthLimits.html#150">150</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\server\LogExport.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/server/LogExport.html#146">146</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        try {
            ChannelUtils.writeAbstractLocalPacket(localChannelReference, valid, false);
        } catch (OpenR66ProtocolPacketException e) {
            logger.error(&quot;Bad Protocol&quot;, e);
            localChannelReference.getLocalChannel().close();
            localChannelReference = null;
            host = null;
            valid = null;
            future.setResult(new R66Result(e, null, true,
                    ErrorCode.TransferError, null));
            future.setFailure(e);
            return;
        }
        host = null;
        future.awaitUninterruptibly();
        logger.info(&quot;Request done with &quot; + (future.isSuccess() ? &quot;success&quot; : &quot;error&quot;));
        localChannelReference.getLocalChannel().close();
        localChannelReference = null;
    }

    protected static long swriteGlobalLimit = -1;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpReponsiveSslInitializer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpReponsiveSslInitializer.html#38">38</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslInitializer.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslInitializer.html#38">38</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>    public HttpReponsiveSslInitializer(boolean useHttpCompression) {
        this.useHttpCompression = useHttpCompression;
    }

    @Override
    protected void initChannel(SocketChannel ch) throws Exception {
        final ChannelPipeline pipeline = ch.pipeline();
        // Add SSL handler first to encrypt and decrypt everything.
        SslHandler sslhandler = Configuration.getWaarpSslContextFactory().initInitializer(true, false);
        pipeline.addLast(&quot;ssl&quot;, sslhandler);

        pipeline.addLast(&quot;decoder&quot;, new HttpServerCodec());
        pipeline.addLast(&quot;aggregator&quot;, new HttpObjectAggregator(1048576));
        pipeline.addLast(&quot;streamer&quot;, new ChunkedWriteHandler());
        if (useHttpCompression) {
            pipeline.addLast(&quot;deflater&quot;, new HttpContentCompressor());
        }
        pipeline.addLast(&quot;handler&quot;, new HttpResponsiveSslHandler());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#468">468</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#585">585</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                            continue;
                        }
                    }
                    preparedStatement.realClose();
                    body = builder.toString();
                } catch (WaarpDatabaseException e) {
                    if (preparedStatement != null) {
                        preparedStatement.realClose();
                    }
                    logger.warn(&quot;OpenR66 Web Error {}&quot;, e.getMessage());
                }
                head = resetOptionTransfer(head, startid == null ? (idstart != null ? idstart.toString() : &quot;&quot;)
                        : startid,
                        stopid == null ? &quot;&quot; : stopid, start, stop,
                        rule == null ? &quot;&quot; : rule, req == null ? &quot;&quot; : req,
                        pending, transfer, error, done, all);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#97">97</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#100">100</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#100">100</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#101">101</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#118">118</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        } catch (WaarpDatabaseException e1) {
            e1.printStackTrace();
        }

        // Configuration
        action = createTableH2 + DbConfiguration.table + &quot;(&quot;;
        DbConfiguration.Columns[] ccolumns = DbConfiguration.Columns
                .values();
        for (int i = 0; i &lt; ccolumns.length - 1; i++) {
            action += ccolumns[i].name() +
                    DBType.getType(DbConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += ccolumns[ccolumns.length - 1].name() +
                DBType.getType(DbConfiguration.dbTypes[ccolumns.length - 1]) +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#945">945</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1058">1058</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                head = setDbHostAuthJsonData(head, errorText, host, addr, ssl, isactive);
            } else if (&quot;Update&quot;.equalsIgnoreCase(parm)) {
                String host = getTrimValue(&quot;host&quot;);
                String addr = getTrimValue(&quot;address&quot;);
                String port = getTrimValue(&quot;port&quot;);
                String key = getTrimValue(&quot;hostkey&quot;);
                boolean ssl, admin, isclient, isactive, isproxified;
                ssl = params.containsKey(&quot;ssl&quot;);
                admin = params.containsKey(&quot;admin&quot;);
                isclient = params.containsKey(&quot;isclient&quot;);
                isactive = params.containsKey(&quot;isactive&quot;);
                isproxified = params.containsKey(&quot;isproxified&quot;);
                if (host == null || addr == null || port == null || key == null) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#128">128</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#330">330</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#131">131</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#362">362</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#131">131</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#362">362</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#149">149</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#343">343</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
        DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                .values();
        for (int i = 0; i &lt; chcolumns.length - 1; i++) {
            action += chcolumns[i].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += chcolumns[chcolumns.length - 1].name() +
                DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +
                primaryKey + &quot;)&quot;;
        System.out.println(action);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#224">224</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#227">227</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#227">227</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#232">232</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#245">245</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        action = &quot;CREATE INDEX IF NOT EXISTS IDX_RUNNER ON &quot; + DbTaskRunner.table + &quot;(&quot;;
        DbTaskRunner.Columns[] icolumns = DbTaskRunner.indexes;
        for (int i = 0; i &lt; icolumns.length - 1; i++) {
            action += icolumns[i].name() + &quot;, &quot;;
        }
        action += icolumns[icolumns.length - 1].name() + &quot;)&quot;;
        System.out.println(action);
        try {
            request.query(action);
        } catch (WaarpDatabaseNoConnectionException e) {
            e.printStackTrace();
            return;
        } catch (WaarpDatabaseSqlException e) {
            // XXX FIX no return;
        } finally {
            request.close();
        }

        // cptrunner
        action = &quot;CREATE SEQUENCE IF NOT EXISTS &quot; + DbTaskRunner.fieldseq +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#668">668</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#773">773</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#817">817</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                    String tstart = taskRunner.getStart().toString();
                    tstart = tstart.substring(0, tstart.length());
                    String tstop = taskRunner.getStop().toString();
                    tstop = tstop.substring(0, tstop.length());
                    head = resetOptionTransfer(head, (taskRunner.getSpecialId() - 1) + &quot;&quot;,
                            (taskRunner.getSpecialId() + 1) + &quot;&quot;, tstart, tstop,
                            taskRunner.getRuleId(), taskRunner.getRequested(),
                            false, false, false, false, true);
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#702">702</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#772">772</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#816">816</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                    comment = (String) finalResult.getOther();
                    String tstart = taskRunner.getStart().toString();
                    tstart = tstart.substring(0, tstart.length());
                    String tstop = taskRunner.getStop().toString();
                    tstop = tstop.substring(0, tstop.length());
                    head = resetOptionTransfer(head, (taskRunner.getSpecialId() - 1) + &quot;&quot;,
                            (taskRunner.getSpecialId() + 1) + &quot;&quot;, tstart, tstop,
                            taskRunner.getRuleId(), taskRunner.getRequested(),
                            false, false, false, false, true);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#668">668</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#703">703</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                    String tstart = taskRunner.getStart().toString();
                    tstart = tstart.substring(0, tstart.length());
                    String tstop = taskRunner.getStop().toString();
                    tstop = tstop.substring(0, tstop.length());
                    head = resetOptionTransfer(head, (taskRunner.getSpecialId() - 1) + &quot;&quot;,
                            (taskRunner.getSpecialId() + 1) + &quot;&quot;, tstart, tstop,
                            taskRunner.getRuleId(), taskRunner.getRequested(),
                            false, false, false, false, true);</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#2218">2218</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#2238">2238</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\HttpFormattedHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/HttpFormattedHandler.html#730">730</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                    } else if (cookie.name().equalsIgnoreCase(I18NEXT)) {
                        i18nextFound = true;
                        cookie.setValue(lang);
                        response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(cookie));
                    } else {
                        response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(cookie));
                    }
                }
                if (!i18nextFound) {
                    Cookie cookie = new DefaultCookie(I18NEXT, lang);
                    response.headers().add(HttpHeaderNames.SET_COOKIE, ServerCookieEncoder.LAX.encode(cookie));
                }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\gateway\kernel\exec\JavaExecutorWaarpFtp4jClient.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/gateway/kernel/exec/JavaExecutorWaarpFtp4jClient.html#220">220</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\context\task\FtpTransferTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/FtpTransferTask.html#237">237</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            logger.error(ftpClient.getResult());
            return;
        }
        try {
            if (cwd != null &amp;&amp; !ftpClient.changeDir(cwd)) {
                ftpClient.makeDir(cwd);
                if (!ftpClient.changeDir(cwd)) {
                    logger.warn(&quot;Cannot change od directory: &quot; + cwd);
                }
            }
            if (preArgs != null) {
                String[] result = ftpClient.executeCommand(preArgs);
                for (String string : result) {
                    logger.debug(&quot;PRE: &quot; + string);
                }
            }
            if (!ftpClient.transferFile(filepath, filename, codeCommand)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\context\task\RescheduleTransferTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/RescheduleTransferTask.html#307">307</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\context\task\RescheduleTransferTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/RescheduleTransferTask.html#354">354</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                String[] elmts = args[i].split(&quot;;&quot;);
                boolean startModified = false;
                String[] values = elmts[0].split(&quot;:&quot;);
                Calendar start = getCalendar(values);
                if (start != null) {
                    startModified = true;
                } else {
                    start = Calendar.getInstance();
                }
                boolean stopModified = false;
                values = elmts[1].split(&quot;:&quot;);
                Calendar stop = getCalendar(values);
                if (stop != null) {
                    stopModified = true;
                } else {
                    stop = Calendar.getInstance();
                }
                logger.debug(&quot;Dates before check: Not between &quot; + start.getTime() + &quot; and &quot;</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#123">123</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#126">126</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#126">126</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#128">128</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#144">144</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        } finally {
            request.close();
        }

        // HostConfiguration
        action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
        DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                .values();
        for (int i = 0; i &lt; chcolumns.length - 1; i++) {
            action += chcolumns[i].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                    &quot;, &quot;;
        }
        action += chcolumns[chcolumns.length - 1].name() +
                DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#326">326</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#358">358</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#358">358</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#324">324</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#339">339</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            String primaryKey = &quot; PRIMARY KEY &quot;;
            String notNull = &quot; NOT NULL &quot;;

            // HostConfiguration
            String action = createTableH2 + DbHostConfiguration.table + &quot;(&quot;;
            DbHostConfiguration.Columns[] chcolumns = DbHostConfiguration.Columns
                    .values();
            for (int i = 0; i &lt; chcolumns.length - 1; i++) {
                action += chcolumns[i].name() +
                        DBType.getType(DbHostConfiguration.dbTypes[i]) + notNull +
                        &quot;, &quot;;
            }
            action += chcolumns[chcolumns.length - 1].name() +
                    DBType.getType(DbHostConfiguration.dbTypes[chcolumns.length - 1]) +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1443">1443</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1544">1544</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        String spooled = REQUEST.Spooled.read(this);
        String uri = null;
        if (detailed) {
            uri = &quot;SpooledDetailed.html&quot;;
        } else {
            uri = &quot;Spooled.html&quot;;
        }
        QueryStringDecoder queryStringDecoder = new QueryStringDecoder(request.uri());
        params = queryStringDecoder.parameters();
        String name = null;
        if (params.containsKey(&quot;name&quot;)) {
            name = getTrimValue(&quot;name&quot;);
        }
        int istatus = 0;
        if (params.containsKey(&quot;status&quot;)) {
            String status = getTrimValue(&quot;status&quot;);
            try {
                istatus = Integer.parseInt(status);
            } catch (NumberFormatException e1) {
                istatus = 0;
            }
        }
        if (spooled.contains(&quot;XXXSPOOLEDXXX&quot;)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\DbConfigurationR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbConfigurationR66RestMethodHandler.html#103">103</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\DbHostAuthR66RestMethodHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/DbHostAuthR66RestMethodHandler.html#105">105</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>            return new DbConfiguration(handler.getDbSession(), arg);
        } catch (WaarpDatabaseException e) {
            throw new HttpIncorrectRequestException(&quot;Issue while inserting into database&quot;, e);
        }
    }

    @Override
    protected DbPreparedStatement getPreparedStatement(HttpRestHandler handler,
            RestArgument arguments, RestArgument result, Object body)
            throws HttpIncorrectRequestException, HttpInvalidAuthenticationException {
        ObjectNode arg = arguments.getUriArgs().deepCopy();
        arg.setAll(arguments.getBody());
        String host = arg.path(FILTER_ARGS.HOSTID.name()).asText();
        if (host == null || host.isEmpty()) {
            host = null;
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\localhandler\ServerActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/ServerActions.html#625">625</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\localhandler\ServerActions.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/localhandler/ServerActions.html#1017">1017</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>                localChannelReference.validateRequest(result);
                try {
                    ChannelUtils.writeAbstractLocalPacket(localChannelReference,
                            valid, true);
                } catch (OpenR66ProtocolPacketException e) {
                }
                channel.close();
                break;
            }
            case LocalPacketFactory.TESTPACKET: {
                session.newState(VALIDOTHER);
                logger.info(&quot;Valid TEST MESSAGE: &quot; + packet.toString());
                R66Result resulttest = new R66Result(session, true,
                        ErrorCode.CompleteOk, null);
                resulttest.setOther(packet);
                localChannelReference.validateRequest(resulttest);
                channel.close();
                break;
            }
            default:
                logger.info(&quot;Validation is ignored: &quot; + packet.getTypeValid());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\client\Message.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/Message.html#78">78</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\client\RequestInformation.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/client/RequestInformation.html#86">86</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>        _INFO_ARGS = Messages.getString(&quot;Message.0&quot;) + Messages.getString(&quot;Message.OutputFormat&quot;); //$NON-NLS-1$
        if (args.length &lt; 5) {
            logger
                    .error(_INFO_ARGS);
            return false;
        }
        if (!FileBasedConfiguration
                .setClientConfigurationFromXml(Configuration.configuration, args[0])) {
            logger
                    .error(Messages.getString(&quot;Configuration.NeedCorrectConfig&quot;)); //$NON-NLS-1$
            return false;
        }
        for (int i = 1; i &lt; args.length; i++) {
            if (args[i].equalsIgnoreCase(&quot;-to&quot;)) {
                i++;
                srequested = args[i];
            } else if (args[i].equalsIgnoreCase(&quot;-msg&quot;)) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="b">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelH2.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelH2.html#171">171</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelMariadb.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMariadb.html#174">174</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelMysql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelMysql.html#174">174</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\database\model\DbModelOracle.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelOracle.html#179">179</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\model\DbModelPostgresql.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/model/DbModelPostgresql.html#192">192</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        } finally {
            request.close();
        }

        // rules
        action = createTableH2 + DbRule.table + &quot;(&quot;;
        DbRule.Columns[] rcolumns = DbRule.Columns.values();
        for (int i = 0; i &lt; rcolumns.length - 1; i++) {
            action += rcolumns[i].name() +
                    DBType.getType(DbRule.dbTypes[i]) + &quot;, &quot;;
        }
        action += rcolumns[rcolumns.length - 1].name() +
                DBType.getType(DbRule.dbTypes[rcolumns.length - 1]) +</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbConfiguration.html#433">433</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\data\DbHostConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbHostConfiguration.html#771">771</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            }
        }
        if (condition != null) {
            preparedStatement.createPrepareStatement(request + condition +
                    &quot; ORDER BY &quot; + Columns.HOSTID.name());
        } else {
            preparedStatement.createPrepareStatement(request +
                    &quot; ORDER BY &quot; + Columns.HOSTID.name());
        }
        return preparedStatement;
    }

    @Override
    public void changeUpdatedInfo(UpdatedInfo info) {
        if (updatedInfo != info.ordinal()) {
            updatedInfo = info.ordinal();
            allFields[Columns.UPDATEDINFO.ordinal()].setValue(updatedInfo);
            isSaved = false;
        }
    }

    /**
     * Update configuration according to new value of limits
     */
    public void updateConfiguration() {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#946">946</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#984">984</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            } else if (&quot;Update&quot;.equalsIgnoreCase(parm)) {
                String host = getTrimValue(&quot;host&quot;);
                String addr = getTrimValue(&quot;address&quot;);
                String port = getTrimValue(&quot;port&quot;);
                String key = getTrimValue(&quot;hostkey&quot;);
                boolean ssl, admin, isclient, isactive, isproxified;
                ssl = params.containsKey(&quot;ssl&quot;);
                admin = params.containsKey(&quot;admin&quot;);
                isclient = params.containsKey(&quot;isclient&quot;);
                isactive = params.containsKey(&quot;isactive&quot;);
                isproxified = params.containsKey(&quot;isproxified&quot;);
                if (host == null || addr == null || port == null || key == null) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\context\R66Session.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/R66Session.html#191">191</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\context\R66Session.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/R66Session.html#232">232</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>    public void clear() {
        // First check if a transfer was on going
        if (runner != null &amp;&amp; (!runner.isFinished()) &amp;&amp; (!runner.continueTransfer())) {
            if (localChannelReference != null) {
                if (!localChannelReference.getFutureRequest().isDone()) {
                    R66Result result = new R66Result(new OpenR66RunnerErrorException(
                            &quot;Close before ending&quot;), this, true,
                            ErrorCode.Disconnection, runner);// True since called from closed
                    result.setRunner(runner);
                    try {
                        setFinalizeTransfer(false, result);
                    } catch (OpenR66RunnerErrorException e) {
                    } catch (OpenR66ProtocolSystemException e) {
                    }
                }
            }
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\database\data\DbHostConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbHostConfiguration.html#1003">1003</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\database\data\DbHostConfiguration.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/database/data/DbHostConfiguration.html#1035">1035</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                String[] oldAlias = config.getReverseAliases().get(entry.getKey());
                int size = oldAlias == null ? 0 : oldAlias.length;
                String[] alias = new String[entry.getValue().size() + size];
                int i = 0;
                for (; i &lt; size; i++) {
                    alias[i] = oldAlias[i];
                }
                for (String namealias : entry.getValue()) {
                    config.getAliases().put(namealias, entry.getKey());</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#1466">1466</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#1566">1566</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>            if (name != null &amp;&amp; !name.isEmpty()) {
                // name is specified
                uri = request.uri();
                if (istatus != 0) {
                    uri += &quot;&amp;status=&quot; + istatus;
                }
                StringBuilder builder = SpooledInformTask.buildSpooledUniqueTable(uri, name);
                return spooled.replace(&quot;XXXSPOOLEDXXX&quot;, builder.toString());
            } else {
                if (istatus != 0) {
                    uri += &quot;&amp;status=&quot; + istatus;
                }
                StringBuilder builder = SpooledInformTask.buildSpooledTable(detailed, istatus, uri);
                return spooled.replace(&quot;XXXSPOOLEDXXX&quot;, builder.toString());
            }
        }</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\adminssl\HttpResponsiveSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpResponsiveSslHandler.html#610">610</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\adminssl\HttpSslHandler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/adminssl/HttpSslHandler.html#701">701</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>                head = head.replace(XXXDATAJSONXXX, builder.toString());
            } else if (&quot;Cancel&quot;.equalsIgnoreCase(parm) || &quot;CancelClean&quot;.equalsIgnoreCase(parm)
                    || &quot;Stop&quot;.equalsIgnoreCase(parm)) {
                // Cancel or Stop
                boolean stop = &quot;Stop&quot;.equalsIgnoreCase(parm);
                String specid = getValue(&quot;specid&quot;);
                String reqd = getValue(&quot;reqd&quot;);
                String reqr = getValue(&quot;reqr&quot;);
                LocalChannelReference lcr =
                        Configuration.configuration.getLocalTransaction().
                                getFromRequest(reqd + &quot; &quot; + reqr + &quot; &quot; + specid);
                // stop the current transfer
                ErrorCode result;
                long lspecid;
                try {
                    lspecid = Long.parseLong(specid);
                } catch (NumberFormatException e) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\context\task\ExecMoveTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecMoveTask.html#141">141</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\context\task\ExecOutputTask.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/context/task/ExecOutputTask.html#146">146</a></td></tr>
<tr class="b"><td colspan='3'>
<div>
<pre>        Thread thread = new Thread(lastLineReader, &quot;ExecRename&quot;
                + session.getRunner().getSpecialId());
        thread.setDaemon(true);
        Configuration.configuration.getExecutorService().execute(thread);
        int status = -1;
        try {
            status = defaultExecutor.execute(commandLine);
        } catch (ExecuteException e) {
            if (e.getExitValue() == -559038737) {
                // Cannot run immediately so retry once
                try {
                    Thread.sleep(Configuration.RETRYINMS);
                } catch (InterruptedException e1) {
                }
                try {
                    status = defaultExecutor.execute(commandLine);
                } catch (ExecuteException e1) {</pre></div></td></tr></table>
<table border="0" class="bodyTable">
<tr class="a">
<th>File</th>
<th>Project</th>
<th>Line</th></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestBandwidthR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestBandwidthR66Handler.html#61">61</a></td></tr>
<tr class="a">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestConfigR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestConfigR66Handler.html#65">65</a></td></tr>
<tr class="b">
<td>org\waarp\openr66\protocol\http\rest\handler\HttpRestServerR66Handler.java</td>
<td>Waarp OpenR66</td>
<td><a href="./xref/org/waarp/openr66/protocol/http/rest/handler/HttpRestServerR66Handler.html#68">68</a></td></tr>
<tr class="a"><td colspan='3'>
<div>
<pre>    public HttpRestBandwidthR66Handler(RestConfiguration config, METHOD... methods) {
        super(BASEURI, config, METHOD.OPTIONS);
        setIntersectionMethods(methods, METHOD.GET, METHOD.PUT);
    }

    @Override
    public void endParsingRequest(HttpRestHandler handler, RestArgument arguments, RestArgument result, Object body)
            throws HttpIncorrectRequestException, HttpInvalidAuthenticationException {
        logger.debug(&quot;debug: {} ### {}&quot;, arguments, result);
        if (body != null) {
            logger.debug(&quot;Obj: {}&quot;, body);
        }
        handler.setWillClose(false);
        ServerActions serverHandler = ((HttpRestR66Handler) handler).getServerHandler();</pre></div></td></tr></table></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
              Copyright &#169;                    2009-2016
                        <a href="http://www.waarp.it">Waarp</a>.
            All Rights Reserved.      
                    
                  </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
